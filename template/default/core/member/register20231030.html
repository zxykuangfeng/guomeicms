<!--{php168}-->
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1"/>
<title>{$P8LANG['member_register']}_{$core.CONFIG['site_name']}</title>
<link type="text/css" rel="stylesheet" href="{$SKIN}member/register.css" />
<link type="text/css" rel="stylesheet" href="{$RESOURCE}/skin/member/default/cms/category_selector.css" />
<script type="text/javascript" src="{$RESOURCE}/js/config.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/util.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/member_common.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/lang/core/{$core.CONFIG['lang']}.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/recursive_dept.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/jq_validator.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/upload.js"></script>
<script type="text/javascript">
<!--{template_init_js}-->
</script>
</head>
<body>
<!--页头-->
<script type="text/javascript">
$(function(){
	$('#form').validate({
		rules: {
			
			username: {
				required: true,
				rangelength: [2, 20],
				valid_username: true,
				remote: {
					url: '$this_router-verify',
					cache: false,
					data: {name: 'username', data: function(){return $('#username').val();}},
					beforeSend: function(){
						ajaxing({});
					},
					complete: function(){
						ajaxing({action: 'hide'});
					}
				}
			},
			
			password: {
				required: true,
				rangelength: [8, 20],
				valid_passwd: true
			},
			
			confirm_password: {
				required: true,
				equalTo: '#password'
			},
			rid: {
				required: true,				
			},
			email: {
				required: true,
				valid_email: true,
				remote: {
					url: '$this_router-verify',
					cache: false,
					data: {name: 'email', data: function(){return $('#email').val();}},
					beforeSend: function(){
						ajaxing({});
					},
					complete: function(){
						ajaxing({action: 'hide'});
					}
				}
			},
			<!--{if $cell_phone_not_null && $cell_phone_show}-->
			cell_phone: {
				required: true,
				number: true,
				maxlength: 11
			},
			<!--{/if}-->
			<!--{if $dept2_not_null && $dept2_show}-->
			dept2: {
				required: true,
			},
			<!--{/if}-->
			<!--{if isset($question)}-->
			register_question: {
				required: true,
				remote: {
					url: '$this_router-verify',
					cache: false,
					data: {name: 'register_question', data: function(){return $('#register_question').val();}},
					beforeSend: function(){
						ajaxing({});
					},
					complete: function(){
						ajaxing({action: 'hide'});
					}
				}
			},
			<!--{/if}-->
			
			agree: {
				required: true
			}
		},
		
		messages: {
			username: {
				required: '$P8LANG[username_required]',
				valid_username: '$P8LANG[username_invalid]',
				rangelength: '$P8LANG[username_length_range]',
				remote: '$P8LANG[username_exists_or_denied]'
			},
			
			password: {
				required: '$P8LANG[password_required]',
				valid_passwd: '$P8LANG[password_strong]',
				rangelength: '$P8LANG[password_length_range]'
			},
			
			confirm_password: {
				required: '$P8LANG[password_required]',
				equalTo: '$P8LANG[password_not_match]'
			},
			rid: {
				required: '$P8LANG[role_required]',				
			},
			email: {
				required: '$P8LANG[email_required]',
				valid_email: '$P8LANG[email_invalid]',
				remote: '$P8LANG[email_registerd]'
			},
			
			cell_phone: {
				required: '$P8LANG[cell_phone_required]',
				number: '$P8LANG[phone_invalid]',
				maxlength: '$P8LANG[phone_too_long]'
			},
			<!--{if isset($question)}-->
			register_question: {
				required: '$P8LANG[verify_question_required]',
				remote: '$P8LANG[verify_question_incorrect]'
			},
			<!--{/if}-->
			
			agree: {
				required: function(){alert('$P8LANG[agreement_required]');}
			}
		},
		
		errorPlacement: function(error, element) {
			if(element.attr('name') == 'register_question'){
				error.appendTo(element.parent().parent().next().empty());
			}else if(element.attr('name') == 'agree'){
				//
			}else{
				error.appendTo(element.parent().next().empty());
			}
		},
		
		success: function(e){
			e.html('&nbsp;').removeClass('no').addClass('yes');
		},
		
		validClass: 'yes',
		errorClass: 'no',
		
		onkeyup: false
		
	});
});
</script>
<div class="regmain">
	<div class="regbox">
		<div class="reghead"></div>
		<div class="regmodule clear">
			<div class="regside">
				<h3>欢迎注册！</h3>
				<p>已经是会员？ <a style="color: #ba0600" href="{$core.U_controller}">立即登录</a></p>
			</div>
			<div class="regform">
				<form method="post" id="form" action="$this_url" >
					<!--{if empty($gid)}-->
					<div class="chose">
						<h3>{$P8LANG['choose_role_group']}：</span></h3>
						<p><!--{foreach $groups $id $v}-->
						<!--{php if(!$v['registrable']) continue;}-->
						<a href="$this_url?gid=$v[id]&{$_SERVER['QUERY_STRING']}">$v[name]</a> &nbsp;
						<!--{/foreach}--></p>
					</div>
					<!--{else}-->
					<div class="formrow">
						<div class="name">{$P8LANG['username']} <span class="start">*</span></div>
						<div class="input"><input type="text" name="username" id="username" class="textinput" onfocus="checkUsername(this);"/></div>
						<div class="tishi">
							<div id="username_hint" class="hint" style="display:none;line-height:18px;font-size:12px; color:#0066CC">
								{$P8LANG['username_hint']}
							</div>
						</div>
					</div>
					<div class="formrow">
						<div class="name">{$P8LANG['password']} <span class="start">*</span></div>
						<div class="input"><input name="password" autocomplete="new-password" type="password" id="password" class="textinput" onfocus="$('#password_hint').show();" /></div>
						<div class="tishi">
							<div id="password_hint" class="hint" style="display: none;line-height:18px;font-size:12px; color:#0066CC">
								{$P8LANG['password_strong']}
							</div>
						</div>
					</div>
					<div class="formrow">
						<div class="name">{$P8LANG['confirm_password']} <span class="start">*</span></div>
						<div class="input"><input type="password" name="confirm_password" id="confirm_password" class="textinput" /></div>
						<div class="tishi"></div>
					</div>
					<div class="formrow">
						<div class="name">{$P8LANG['email']} <span class="start">*</span></div>
						<div class="input"><input type="text" name="email" id="email" class="textinput" /></div>
						<div class="tishi"></div>
					</div>
					<div class="formrow">
						<div class="name">{$P8LANG['role_register']} <span class="start">*</span></div>
						<div class="input">
							<select name="rid" id="rid">
								<option value="">{$P8LANG['role_select']}</option>
								<!--{if !empty($roles['system'])}-->
									<!--{foreach $roles['system'] $v}-->
										<option value="$v[id]"{if $rid == $v['id']} selected{/if}>$v[name]</option>
									<!--{/foreach}-->
								<!--{/if}-->								
								<!--{if !empty($roles['normal'])}-->
									<!--{foreach $roles['normal'] $id $v}-->
										<option value="$v[id]"{if $rid == $v['id']} selected{/if}>$v[name]</option>
									<!--{/foreach}-->
								<!--{/if}-->
							</select>
						</div>
						<div class="tishi">
							<div id="rid_hint" class="hint" style="display: none;line-height:18px;font-size:12px; color:#0066CC">
								{$P8LANG['role_required']}
							</div>
						</div>
					</div>
					<!--{if $question_show}-->
					<div class="formrow">
						<div class="name">{$P8LANG['question']}1 </div>
						<div class="input">
							<select name="find_pwd[1][order]">
								<option value="">请选择密保问题</option>
								<!--{foreach $questions $order $question}-->
								<option value="{$order}">{$question}</option>
								<!--{/foreach}-->
							</select>
							答案：<input type="text" name="find_pwd[1][ans]" size="10" value="" class="textinput" style="width:80px;"/>
						</div>
						<div class="tishi"></div>
					</div>
					<div class="formrow">
						<div class="name">{$P8LANG['question']}2 </div>
						<div class="input"><select name="find_pwd[2][order]">
								<option value="">请选择密保问题</option>
								<!--{foreach $questions $order $question}-->
								<option value="{$order}">{$question}</option>
								<!--{/foreach}-->
							</select>
							答案：<input type="text" name="find_pwd[2][ans]" size="10" value="" class="textinput"  style="width:80px;"/></div>
						<div class="tishi"></div>
					</div>
					<div class="formrow">
						<div class="name">{$P8LANG['question']}3 </div>
						<div class="input"><select name="find_pwd[3][order]">
								<option value="">请选择密保问题</option>
								<!--{foreach $questions $order $question}-->
								<option value="{$order}">{$question}</option>
								<!--{/foreach}-->
							</select>
							答案：<input type="text" name="find_pwd[3][ans]" size="10" value="" class="textinput"  style="width:80px;"/></div>
						<div class="tishi"></div>
					</div>
					<!--{/if}-->
					<!--{if $dept2_show}-->
					<div class="formrow">
						<div class="name">{$P8LANG['role_gname2']} {if $dept2_not_null}<span class="start">*</span>{/if}</div>
						<div class="input">
							<span id="dept2_path"></span>
							<input type="hidden" name="#field_dept2_posted" />
							<input type="hidden" id="dept2" name="dept2" value="{if isset($data[dept2])}$data[dept2]{/if}" />
							<input type="button" value="{$P8LANG['select_dept']}" id="dept2_button" />
							<script type="text/javascript">
							$(function(){
								var dialog = new P8_Dialog({
									title_text: '{$P8LANG['select_dept']}',
									width: 700,
									height: 300,
									button: true,
									show: function(){
										selector.init();
									},
									ok: function(){
										var v = selector.get_value();
										
										$('#dept2').val(v);
										
										path(v);
									}
								});
								
								var selector;
								include_once('{$RESOURCE}/js/recursive_dept.js', function(){
									selector = new Recursive_Selector({
										dialog: dialog,
										sub_property: 'depts',
										input: $('input[name="#field_dept2_posted"]'),
										value: $('#dept2').val(),
										url: P8CONFIG.url +'/api/dept.php',
										item_callback: function(dept, item){
											
											if(dept.depts){
												item.addClass('sub_category');
											}
										},
										init_callback: function(){
											var id = this.get_value();
											
											path(id);
										}
									});
									
									if($('#dept2').val()){
										selector.init();
									}
								});
								
								function path(id){
									if(id == 0){
										$('#dept2_path').html('');
										return;
									}										
									var tmp = selector.get_by_id(id);
									var html = '';										
									while(true){
										html = tmp.name +' &gt; '+ html;
										if(tmp.parent == 0) break;
										
										tmp = selector.get_by_id(tmp.parent);
									}
									
									$('#dept2_path').html(html);
								}
								
								$('#dept2_button').click(function(){
									dialog.show();
								});									
							});
							</script>									
							</div>
						<div class="tishi"></div>
					</div>
					<!--{/if}-->
					<!--{if $cell_phone_show}-->
					<div class="formrow">
						<div class="name">{$P8LANG['cell_phone']} {if $cell_phone_not_null}<span class="start">*</span>{/if}</div>
						<div class="input"><input type="text" name="cell_phone" id="cell_phone" class="textinput" onfocus="$('#cell_phone_hint').show();"/></div>
						<div class="tishi">
							<div id="cell_phone_hint" class="hint" style="display: none;line-height:18px;font-size:12px; color:#0066CC">
								{$P8LANG['cell_phone_hint']}
							</div>
						</div>
					</div>
					<!--{/if}-->
					<!--{foreach $this_model['fields'] $field $field_data}-->
					<div class="formrow">
						<div class="name">$field_data[alias]{if $field_data['not_null']} <span class="start">*</span>{/if}</div>
						<div class="input">
							<!--{php include template($core, 'widget/'. $field_data['widget'], 'default');}-->
							<!--{if $field_data['not_null']}-->
							<script type="text/javascript">
								$(function(){
									$('#form *[name="field#[$field]"]').rules('add', {
										required: true,
										messages: { required: '{$P8LANG['role_group_field_required']}'}
									});
								});
							</script>
							<!--{/if}-->
						</div>
						<div class="tishi"></div>
					</div>
					<!--{/foreach}-->
					<!--{if isset($question)}-->
					<div class="formrow">
						<div class="name">{$P8LANG['verify_question']}<font color="#FF0000" size="2">*</font></div>
						<div class="input">
							<div style="position: relative;">
								<input type="text" name="register_question" id="register_question" onfocus="$('#question').show()" onclick="$('#question').show('slow')" onblur="$('#question').fadeOut()" class="input" /> <span class="question" style="display: none;" id="question">$question</span>
							</div>
						</div>
						<div class="tishi"></div>
					</div>
					<!--{/if}-->
					<!--{if !empty($this_module->CONFIG['register']['captcha'])}-->
					<div class="formrow">
						<div class="name">{$P8LANG['captcha']}<font color="#FF0000" size="2">*</font></div>
						<div class="captcha"><input type="text" name="captcha"/></div>
						<div class="tishi" style="width:auto;">
							<div id="captcha"></div>
						</div>
						<script type="text/javascript">
							captcha($('#captcha'), $('#form input[name="captcha"]'));
						</script>
					</div>
					<!--{/if}-->
					<div class="formrow">
						<div class="input" style="margin-left:170px;">
						<input type="checkbox" name="agree" id="agree" value="1" onclick="_agree(this.checked)"/> <label for="agree">{$P8LANG['accept_argument']}</label> <a href="{$core.controller}/core/page-view-id-2" target="_blank">{$P8LANG['view']}</a></div>
					</div>
					<div class="formrow">
						<div class="name"></div>
						<div class="submit"><input type="submit" value="{$P8LANG['submit']}"/></div>
					</div>
					<!--{/if}-->
					<input type="hidden" name="gid" value="$gid" />
					<input type="hidden" name="token" value="{$token}" />
					<input type="hidden" name="forward" value="{if isset($_GET['forward'])}$_GET[forward]{/if}" />
					<input type="hidden" name="_referer" value="{if isset($_GET['forward'])}$_GET[forward]{/if}" />
				</form>
			</div>
		</div>
	</div>
</div>
<div class="footbar">
	<div class="footer">
		<div class="copyright">
			<ul>
				<li>{$core.CONFIG['copyright']}</li>
			</ul>
		</div>
	</div>
</div>
<script type="text/javascript">
function checkUsername(obj){
	if(!/^[A-Za-z]\w{2,}/.test(obj.value)){
		$("#username_hint").css("display","block");
	}else{
		$("#username_hint").css("display","none");
	}
}

function _agree(checked){
	if(checked){
		$('\x3c\x69\x6e\x70\x75\x74 \x74\x79\x70\x65\x3d\x22\x68\x69\x64\x64\x65\x6e\x22 \x69\x64\x3d\x22\x5f\x5f\x61\x67\x72\x65\x65\x22 \x6e\x61\x6d\x65\x3d\x22\x5f\x5f\x61\x67\x72\x65\x65\x6d\x65\x6e\x74\x22 \x76\x61\x6c\x75\x65\x3d\x22\x31\x22 \x2f\x3e')['\x61\x70\x70\x65\x6e\x64\x54\x6f']($('\x23\x66\x6f\x72\x6d'));
	}else{
		$('\x23\x5f\x5f\x61\x67\x72\x65\x65')['\x72\x65\x6d\x6f\x76\x65']();
	}
}

$.validator.addMethod('valid_username', function(value, element){
	//return /^[A-Za-z]\w{2,}/.test(value);
	return !/{$this_module.username_reg}/.test(value);
});

$.validator.addMethod('valid_email', function(value, element){
	return value.length > 3 && /^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/.test(value);
});
$.validator.addMethod('valid_passwd', function(value, element){
	return /^(?=.*?[a-z])(?=.*?[A-Z])(?=.*?\d)(?=.*?[!#@*&.])[a-zA-Z\d!#@*&.]*$/.test(value);
});


$('#username').focus();
</script>
</body>
</html>
<!--{/php168}-->