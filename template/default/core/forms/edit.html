<!--{php168}-->
<!--{template $core header}-->
<link rel="stylesheet" type="text/css" href="{$RESOURCE}/skin/default/core/css/style.css" />
<link rel="stylesheet" type="text/css" href="{$RESOURCE}/images/category_selector.css" />
<script type="text/javascript" src="{$RESOURCE}/js/jq_validator.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/upload.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/core/label/label.js"></script>
<script type="text/javascript">
var MODEL = '$MODEL';
var attachment_hash = '$attachment_hash';
var form_submit = false;
{if !empty($this_model['CONFIG']['content_thumb_width'])}P8CONFIG.cthumb_width = {$this_model['CONFIG']['content_thumb_width']};{/if}
{if !empty($this_model['CONFIG']['content_thumb_height'])}P8CONFIG.cthumb_height = {$this_model['CONFIG']['content_thumb_height']};{/if}

window.onbeforeunload = function(){
	P8_Upload.del(form_submit);
};
$(function(){

$.validator.addMethod('jsreg',function(value, element, params){
	return this.optional(element) || params.test(value);
});

$('#form').validate({
	rules: { },
	messages: { },
	
	errorPlacement: function(error, element) {
			element.siblings(".jsregmsg").html(error);	
	},
	submitHandler: function(form){
		form_submit = true;		
		form.submit();
	},		
	onkeyup: false
});

});
var p8_window = new function () {
	this.width = 494;
	this.height = 152;
	this.close = function () {
        $('.p8_win_layer iframe').remove();
        $('.p8_win_layer').remove();
    };

    function messageBox(html,message) {
        p8_window.close();
        let jq = $(html);
        jq.find(".p8_win_panel").height(p8_window.height).width(p8_window.width).css("margin-left", -p8_window.width / 2).css("margin-top", -p8_window.height / 2);
        //jq.find(".title-panel").height(p8_window.height);
        jq.find(".title").find(":header").html(P8LANG.system_box_title);
        jq.find(".body-panel").height(p8_window.height - 30);
        jq.find(".content").html(message.replace('\r\n', '<br/>'));
        jq.appendTo('body').show();
        $(".p8_win_layer .w-btn:first").focus();
    }

    this.confirm = function (message,selected) {
        this._close = function (r) {
            this.close();
			if ($.isFunction(selected)) selected(r);
        };
		let html = '<div class="p8_win_layer"><div class="p8_mask_layer"></div><div class="p8_win_panel"><iframe class="title-panel" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe><div class="body-panel"><div class="title"><h3></h3></div><p class="content"></p><p class="btns"><button class="ok" tabindex="1" onclick="p8_window._close(true);">确定</button><button class="cancel" onclick="p8_window._close(false);">取消</button></p></div></div></div>';	
        messageBox(html, message);
    };

    this.alert = function (message, closed) {
        this._close = function () {
            this.close();
            if ($.isFunction(closed)) closed();
        };
		let html = '<div class="p8_win_layer"><div class="p8_mask_layer"></div><div class="p8_win_panel"><iframe class="title-panel" frameborder="0" marginheight="0" marginwidth="0" scrolling="no"></iframe><div class="body-panel"><div class="title"><h3></h3></div><p class="content"></p><p class="btns"><button class="ok" tabindex="1" onclick="p8_window._close();">关闭</button></p></div></div></div>';
        messageBox(html, message);
    }
};
</script>
<div class="breadbanner delmag">
	<div class="fluid">
		<div class="bigbanner">
			$label[bigbanner_daohan_gg]
		</div>
	</div>
</div>
<div class="breadnav">
	<div class="container">
		<div class="row">
			<div class="col-md-12 col-sm-12 col-xs-12">
				<div class="position fr">
					<a href="{$core.controller}">首页</a>
					&gt; $this_model[alias]
				</div>
			</div>
		</div>
	</div>
</div>
<div class="maincon">
	<div class="container">
		<div class="row">
			<div class="col-md-12 col-sm-12 col-xs-12">
				<div class="forms_div">
					<div class="forms_summary">{$this_model[CONFIG][summary]}</div>
					<div class="forms_head">$this_model[alias]</div>
					<div class="forms_main">
						<form name="form" id="form" action="$this_url" method="post">
							<table width="100%" cellpadding="5" cellspacing="0" class="pop_table">
								<!--{if empty($this_model['CONFIG']['parts'])}-->
								<!--简单布局开始-->
								<!--{foreach $this_model['fields'] $field $field_data}-->
								<!--{php
									if(!$field_data['editable']) continue;
									
									$__name = '';
									
									switch($field_data['widget']){
									
									case 'checkbox': case 'multi_select':case 'linkage':
										$__name = '[]';
									break;
									case 'uploader': case 'image_uploader':
										$__name = '[url]';
									break;
									case 'multi_uploader':
										$__name = '[url][]';
									break;
									
									}
								}-->
								<tr>
									<td class="tdL" valign="top">{$field_data['alias']}:
										<!--{if $field_data['not_null']}-->
										<font color="red">*</font>
										<!--{/if}-->
									</td>
									<td class="tdR">
										<!--{php include template($core, 'widget/'. $field_data['widget'], 'default');}-->
										<!--{if !empty($field_data['units'])}-->
										$field_data[units]
										<!--{/if}-->
										<!--{if !empty($field_data['description'])}-->
										<span class="description">$field_data[description]</span>
										<!--{/if}-->
										<span class="jsregmsg"></span>
									</td>
								</tr>
									<!--{if $field_data['not_null']}-->
									<script type="text/javascript">
									$(document).ready(function(){
										$('#form *[name="field#[$field]$__name"]').rules('add', {
											required: true,
											messages: { required: "{$P8LANG['forms_field_required']}"}
										});
									});
									</script>
									<!--{/if}-->
									<!--{if $field_data['jsreg']}-->
									<script type="text/javascript">
										$(document).ready(function(){
											$('#form *[name="field#[$field]$__name"]').rules('add', {
												jsreg: {$field_data['jsreg']},
												messages: {jsreg:'{$field_data['jsregmsg']}'}
											});
										});
										</script>
									<!--{/if}-->
								<!--{/foreach}-->
								<!--{if $this_model['CONFIG']['mobile_post_captcha']}-->
								<tr>
									<td class="tdL">手机验证：</td>
									<td>
										<input type="text" class="txt2 left" style="width:100px" id="checkphone" size="10" value="" name="phone" onfocus="if (value =='输入手机号'){value =''}" onblur="if (value ==''){value='输入手机号'}"/> <span><img id="p8_sendsms" style="height:25px;" src="{$RESOURCE}/images/dtyzm.gif" /></span><br/>
										<script type="text/javascript">
											$(document).ready(function(){
											  $("#p8_sendsms").click(function(){
												var checkphone = $('#checkphone').val();			
												if(checkphone.length == 11){
													$.ajax({
														url: '{$this_router}-checksms',
														type: 'post',
														dataType: 'json',
														cache: false,
														data: ajax_parameters({phone: checkphone}),
														beforeSend: function(){
															ajaxing({});
														},
														success: function(json){
															ajaxing({action: 'hide'});
															if(json=='OK')
																p8_window.alert('手机短信发送成功！');
															else
																p8_window.alert('发送失败！'+json);
														}
													});
												}else{
													p8_window.alert('请正确输入手机号！');
												}
											  })
											})
										</script>
									</td>
								</tr>
								<tr>
									<td class="tdL">手机验证码：</td>
									<td><input type="text" class="txt2 left" id="checkcode" size="5" value="" name="checkcode"/></td>
								</tr>
								<!--{/if}-->
								<!--{if $this_model['CONFIG']['captcha']}-->
								<tr>
									<td class="tdL">
									验证码：
									</td>
									<td><input type="text" name="captcha" style="width:60px;border: 1px solid #eee;" /> <span id="captcha"></span><span class="jsregmsg">（点击左框显示或刷新验证码）</span>
									<script type="text/javascript">
									captcha($('#captcha'), $('#form input[name="captcha"]'));
									</script>
									
									</td>
								</tr>
								<!--{/if}-->
								<!--{else}-->
								
								<!--复杂布局开始-->
								<!--{foreach $this_model['CONFIG']['parts'] $pk $pd}-->
								<tr>
									<td><b class="part_name">$pd[name]</b></td>
								</tr>
								<tr>
									<td>
										<table width="100%"  cellpadding="0" cellspacing="0">
											<tr>
												<!--{php $tdwidth = 100/$pd['row'].'%'; for($i=1;$i<=$pd['row'];$i++){ $tdid = "$pk-$i";}-->
												<td id="$pk-$i" width="$tdwidth" valign="top">
													<table width="100%" border="0"  cellpadding="5" cellspacing="0">
														<!--{foreach $this_model['parts'][$tdid] $fid $field}-->
														<!--{php
															$field_data = $this_model['fields'][$field];
															
															if(!$field_data['editable']) continue;
															
															$__name = '';
															
															switch($field_data['widget']){
															
															case 'checkbox': case 'multi_select':
																$__name = '[]';
															break;
															case 'uploader': case 'image_uploader':
																$__name = '[url]';
															break;
															case 'multi_uploader':
																$__name = '[url][]';
															break;
															
															}
														}-->
														<tr>
															<td class="tdL">{$field_data['alias']}:
																<!--{if $field_data['not_null']}-->
																<font color="red">*</font>
																<!--{/if}-->
																</td>
															<td class="tdR">
																<!--{php include template($core, 'widget/'. $field_data['widget'], 'default');}-->
																<!--{if !empty($field_data['units'])}-->
																$field_data[units]
																<!--{/if}-->
																<!--{if !empty($field_data['description'])}-->
																<span class="description">$field_data[description]</span>
																<!--{/if}-->
																<span class="jsregmsg"></span>
															</td>
														</tr>
														
														<!--{if $field_data['not_null']}-->
														<script type="text/javascript">
															$(document).ready(function(){
																$('#form *[name="field#[$field]$__name"]').rules('add', {
																	required: true,
																	messages: { required: "{$P8LANG['forms_field_required']}"}
																});
															});
															</script>
														<!--{/if}-->
														<!--{if $field_data['jsreg']}-->
														<script type="text/javascript">
															$(document).ready(function(){
																$('#form *[name="field#[$field]$__name"]').rules('add', {
																	jsreg: {$field_data['jsreg']},
																	messages: {jsreg:'{$field_data['jsregmsg']}'}
																});
															});
															</script>
														<!--{/if}-->
														<!--{/foreach}-->
													</table>
												</td>
												<!--{php }}-->
											</tr>
										</table>
									</td>
								</tr>
								<!--{/foreach}-->
								<!--{if $this_model['CONFIG']['mobile_post_captcha']}-->
								<tr>
									<td>
										<table>
											<tr>
												<td class="tdL">手机验证：</td>
												<td>
													<input type="text" class="txt2 left" style="width:100px" id="checkphone" size="10" value="" name="phone" onfocus="if (value =='输入手机号'){value =''}" onblur="if (value ==''){value='输入手机号'}"/> <span><img id="p8_sendsms" style="height:25px;" src="{$RESOURCE}/images/dtyzm.gif" /></span>
													<script type="text/javascript">
														$(document).ready(function(){
														  $("#p8_sendsms").click(function(){
															var checkphone = $('#checkphone').val();		
															if(checkphone.length == 11){
																if(!(/^1[3456789]\d{9}$/.test(checkphone))){ 
																	p8_window.alert('请正确输入手机号！');
																}else{
																	$.ajax({
																		url: '{$this_router}-checksms',
																		type: 'post',
																		dataType: 'json',
																		cache: false,
																		data: ajax_parameters({phone:checkphone}),
																		beforeSend: function(){
																			ajaxing({});
																		},
																		success: function(json){
																			ajaxing({action: 'hide'});
																			if(json=='OK')
																				p8_window.alert('手机短信发送成功！');
																			else
																				p8_window.alert('发送失败！'+json);
																		}
																	});
																}
															}else{
																p8_window.alert('请正确输入手机号！');
															}
														  })
														})
													</script>
												</td>
											</tr>
											<tr>
												<td class="tdL">手机校验码：</td>
												<td>
													<input type="text" class="txt2 left" id="checkcode" size="5" value="" name="checkcode"/><span id="sms_msg">请输入您收到的手机验证码</span>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<!--{/if}-->
								<!--{if $this_model['CONFIG']['captcha']}-->
								<tr>
									<td>
										<table>
											<tr>
												<td class="tdL">
											验证码：
												</td>
												<td><input type="text" name="captcha" style="width:60px;border: 1px solid #eee;" /> <span id="captcha"></span><span class="jsregmsg">（点击左框显示或刷新验证码）</span>
												<script type="text/javascript">
												captcha($('#captcha'), $('#form input[name="captcha"]'));
												</script>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<!--{/if}-->
								<!--{/if}-->								
							</table>
							<div style="padding-left:100px">
									<input type="submit" name="" class="forms_btn" value="提 交" />
									<input type="reset" name="" class="forms_btn" value="取 消" />
									<input type="hidden" name="mid" value="$mid" />
									<input type="hidden" name="token" value="{$token}" />
									<input type="hidden" name="id" value="{if !empty($id)}$id{/if}" />
									<input type="hidden" name="attachment_hash" value="{$attachment_hash}" />
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">

$(function(){
	<!--{if empty($this_model['CONFIG']['parts'])}-->	   
	$('.pop_table tr:even').addClass('pop_tr');	
	<!--{/if}-->
})

</script>
<!--{template $core footer}-->
<!--{/php168}-->
