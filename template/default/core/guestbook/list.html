<!--{php168}-->
<!--{php 
$TITLE=$this_module->CONFIG['name'].' -- '.$core->CONFIG['site_name'];
$SEO_KEYWORDS = $core->CONFIG['site_key_word'];
$SEO_DESCRIPTION = $core->CONFIG['site_description'];
}-->
<!--{template $core header}-->
<script type="text/javascript" src="{$RESOURCE}/js/jq_validator.js"></script>
<link rel="stylesheet" type="text/css" href="{$RESOURCE}/skin/default/core/common/style.css">
<style type="text/css">
.breadnav{border-bottom:2px solid #184849;padding:0 20px 9px 45px;margin-bottom:20px;background: url({$RESOURCE}/skin/default/core/guestbook/arr4.png) 10px 5px no-repeat;}
.position{font-size:16px;color:#656565;letter-spacing: 5px;}
.position a{color: #656565;letter-spacing: 1px;padding-right: 5px;}
.guestbook-top-nav{margin-bottom:15px;}
.guestbook-top-nav .eachcid{background:url({$RESOURCE}/skin/default/core/guestbook/005.gif) no-repeat left center; padding-left:25px;display:inline-block;margin:0 10px;}
.guestbook-top-nav .eachcid a{ color:#000000;font-weight:bold}
.guestbook-top-nav .over a{ color:#990000;font-weight:bold}
.guestbook-box{border:1px solid #C0CADA;font-size:12px;margin-bottom:15px;}
.guestbook-box .head{ background-color:#f1f1f1;padding:5px 10px;line-height:30px;font-size:12px;}
.guestbook-box .head .user{color:#990000; font-weight:bold; font-size:12px;background:url(by.gif) no-repeat left 1px; padding-left:15px; float:left}
.guestbook-box .head .title{padding-left:10px;float:left;font-weight:bold}
.guestbook-box .main{ padding:15px;}
.guestbook-box .main p{margin-bottom:10px;}
.guestbook-box .buttom{line-height:30px;padding:0 10px}
.guestbook-box .buttom .datatime{float:right; color:#333;margin:0 15px; }
.guestbook-box .buttom .status{float:right; background:url({$RESOURCE}/skin/default/core/guestbook/status.gif) no-repeat left center; padding-left:18px; margin:0 15px; color:#F6760C; font-weight:bold}
.guestbook-text{ border:1px solid #FC0; padding:5px 10px 3px 10px;font-size:12px;}
.guestbook-text .replyer{color:#008000; margin-top:10px}
.guestbook-page{text-align:center;}
.guestbook{border:1px solid #cccccc; background-color:#F7FCFF; padding:10px; font-size:12px}
.guestbook-form table td{padding:5px;}
.guestbook-form .txt{height:28px;line-height:28px;padding:0 5px;border:1px solid #c1c1c1;background: #fff;}
.guestbook-form .textarea{border:1px solid #c1c1c1;padding:5px;background: #fff;}
.guestbook-form .submit{color:#fff;background:#184849;border:1px solid #184849;padding:0 10px;border-radius:5px;}
.pages a, .pages span {display: inline-block;margin:0px 2px;padding:2px 8px;font-size: 1rem;color: #555;border: 1px solid #d9d9d9;border-radius: 3px;background: #fff;}
.pages a.on, .pages a.s2, .pages a.on:hover, .pages a.s2:hover{background: #184849;border: 1px solid #184849;color: #fff;}
/**对话框**/
.php168_dialog { position: absolute; border: 5px solid #8CB8EA; background-color: #ffffff; width: 400px; height: 200px; }
.php168_dialog .title_bar { padding: 5px; background-color: #f1f7fd; cursor: move; }
.php168_dialog .title { color:#3A7494;font-weight:bold;}
.php168_dialog .close { float: right; cursor: pointer; width: 18px; height: 18px; background: url({$RESOURCE}/skin/default/core/close.gif) no-repeat 0px -18px; }
.php168_dialog .close  span{ display: none; }
.php168_dialog .content_container { width: 100%; }
.php168_dialog .content { padding: 5px; }
.php168_dialog .content table td{padding:4px;}
.php168_dialog .content .txt{height:28px;line-height:28px;padding:0 5px;border:1px solid #c1c1c1;background: #fff;}
.php168_dialog .content textarea{border:1px solid #c1c1c1;padding:5px;background: #fff;}
.php168_dialog .chosebar input{padding:2px 5px;margin:0 6px;}
.php168_dialog .chosebar .active{border:0;background:url({$RESOURCE}/skin/default/core/active.png) repeat-x;color:#fff;height: 24px;padding-left:7px;padding-right: 7px;}
.php168_dialog .button_bar { clear: left; }
.php168_dialog .button_bar .cancel{width:89px;height:32px;background:url({$RESOURCE}/skin/default/core/cancel.jpg) no-repeat; color:#333; border:none; margin:0 5px; margin-bottom:2px;  cursor:pointer;letter-spacing:1px;}
.php168_dialog .button_bar .ok{display:block;float:left;border:none;background:url({$RESOURCE}/skin/default/core/yes.jpg) no-repeat;color:#333;width:89px;height:32px; margin:0 5px; margin-bottom:2px;  cursor:pointer}
</style>
<div class="container">
	<div class="layout">
		<div class="breadnav clearfix">
			<div class="position fl"><a href="{$core.controller}">首页</a>/<a href="{$this_module.controller}">{$this_module.CONFIG['name']} </a></div>
		</div>
		<div class="maincon clearfix">
			<div class="guestbook-main">
			<div class="guestbook-top-nav">
				<!--{foreach $category $k $v}-->
				<span class="eachcid"><a href="{$v['url']}">$v[name]</a></span>
				<!--{/foreach}-->
			</div>
			<div id="maincontent">
			<!--{foreach $list $key $val}-->
			<div class="guestbook-box" id="gbs_$val[id]">
				<p class="head clearfix"><span class="user">
					<!--{if !empty($val['username'])}-->
					$val[username] :
					<!--{else}-->
					$val[sip] :
					<!--{/if}-->
					</span><span class="title">$val[title]</span>
					<!--{if $reply}-->
					<!--{/if}-->
					<span class="fright"> 发表时间：
					<!--{php echo date("y-m-d H:i",$val['posttime']);}--> 
					</span>
				</p>
				<div class="main" >
					<p class="content">$val[content] </p>
					<span id="reply_$val[id]">
						<!--{if !empty($val['reply'])}-->
						<div class="guestbook-text mtop">
							$val[reply]
							<p class="replyer">回复人：$val[replyer] &nbsp;回复时间：
								<!--{php echo date("y-m-d H:i",$val['replytime']);}-->
							</p>
						</div>
						<!--{/if}-->
					</span>
				</div>
				<div class="buttom clearfix">
					<span class="status">状态：
					<!--{if !empty($val['reply'])}-->
					已回复
					<!--{else}-->
					未回复
					<!--{/if}-->
					</span>
					<!--{if $delete}-->
					<a href="javascript:void(0)" class="fright" onclick="_delete_guestbook($val[id])">删除&nbsp; </a>
					<!--{/if}-->
					<!--{if $edit || $UID && $UID == $val['uid']}-->
					<a href="javascript:void(0)" class="fright" onclick="_edit_guestbook($val[id])">修改&nbsp;</a>
					<!--{/if}-->
					<!--{if $reply}-->
					<!--<a href="javascript:void(0)" class="fright" style="color:" onclick="message.send($val[uid])"><img src="{$RESOURCE}/skin/default/core/guestbook/qyfa.gif">&nbsp; </a>-->
					<a href="javascript:void(0)" class="fright" style="color:blue" onclick="_reply_guestbook($val[id])">回复&nbsp; </a>
					<!--{/if}-->
					<!--{if $verify && !$val['verified']}-->
					<a href="javascript:void(0)" class="fright" onclick="_verify_guestbook($val[id])">审核&nbsp; </a>
					<!--{/if}-->
					<a class="fright" href="javascript:void(0)" onclick="_digg($val[id],2)">反对[<span id="digg_trample_$val[id]" class="digg">$val[trample]</span>]&nbsp; </a> 
					<a class="fright" href="javascript:void(0)" onclick="_digg($val[id],1)">支持[<span id="digg_digg_$val[id]"  class="digg">$val[digg]</span>]&nbsp; </a>
				</div>
			</div>
			<!--{/foreach}-->
			</div>
			<div class="guestbook-page pages">
				$pages
			</div>

			<script type="text/javascript">
			var edit_dialog = new P8_Dialog({
				title_text: '回复留言',
				width: 560,
				height: 330
			});
			var message = new Message();
			var DIGG=[];
			function _reply_guestbook(id){
				edit_dialog.show();
				edit_dialog.set_title('回复留言');
				edit_dialog.content.load('{$this_router}-reply?id='+id+'&rand='+Math.random());
				
				return false;
			}
			function _edit_guestbook(id){
				edit_dialog.show();
				edit_dialog.set_title('编辑留言');
				edit_dialog.content.load('{$this_router}-edit?id='+id+'&rand='+Math.random());
				
				return false;
			}
			function _delete_guestbook(id){
				if(confirm('确定要删除么,不可逆转的哦?')){
					$.ajax({
						type:'POST',
						url:'{$this_router}-delete',
						data:'id='+id,
						beforeSend:function(){ajaxing({'text':'正在删除'});},
						success:function(rid){
							if(rid){
								$('#gbs_'+rid).remove();
								 ajaxing({'text':'删除成功',action: 'hide'});
							}else{ ajaxing({'text':'删除失败',action: 'hide'});}
						}
				});
					
					return false;
				}
				return false;
			}
			function _verify_guestbook(id){
				if(confirm('确定通过审核么?')){
					$.ajax({
						type:'POST',
						url:'{$this_router}-verify',
						data:'id='+id,
						beforeSend:function(){ajaxing({'text':'正在操作'});},
						success:function(rid){
							if(rid){
								$('#gbs_'+rid).find("a").eq(3).remove();
								 ajaxing({'text':'审核成功',action: 'hide'});
							}else{ ajaxing({'text':'审核失败',action: 'hide'});}
						}
				});
					
					return false;
				}
				return false;
				
			}
			function _digg(id,status){
				if(!check_digg(id)){
					alert('你已表过态了');return;
				};
				$.ajax({
						type:'POST',
						url:'{$this_router}-digg',
						data:'id='+id+'&status='+status,
						dataType:'json',
						success:function(json){
							$('#digg_digg_'+id).html(json.digg);
							$('#digg_trample_'+id).html(json.trample);
						}
				});
				
			}
			function check_digg(id){
				if(!get_cookie(id)){
					set_cookie(id,1,3600);
					return true;
				}
				return false
			}
			</script>
			<!--{template $this_module post}-->
			</div>
		</div>
	</div>
</div>
<div class="clear"></div>
<!--{template $core footer}-->
<!--{/php168}-->