<!--{php168}-->
<!--{template $core header admin}-->
<script type="text/javascript" src="{$RESOURCE}/js/rcalendar.js"></script>
<style>
.box { padding:2px; border:1px solid #cccccc; }
.head{ background-color:#eeeeee}
.formtable .title{ color:#FFF}
#showimgbox{ display:none; width:305px; height:105px; position:absolute;  border:1px solid #cccccc}
</style>

<div class="mainbox mainborder">
	<div class="section">
		<table class="formtable">
			<tr>
				<td class="title">{$P8LANG['operation']}</td>
			</tr>
			<tr>
				<td class="headerbtn_list">
					<ul>
						<li><a href="{$this_url}?plugin=schedul&job=config"><i class="fa fa-cogs"></i>排班配置</a></li>
						<li class="active"><a href="{$this_url}?plugin=schedul"><i class="fa fa-calendar"></i>查看排班</a></li>
						<li><a href="{$this_url}?plugin=schedul&job=add"><i class="fa fa-check-square-o"></i>增加排班</a></li>
						<li><a href="{$this_url}?plugin=schedul&job=import"><i class="fa fa-arrow-circle-o-right"></i>批量导入排班</a></li>
						<li><a href="{$RESOURCE}/plugin.php/schedul-detail" target="_blank"><i class="fa fa-wpforms"></i>排班效果查看</a></li>
						<li><a href="{$this_url}?plugin=schedul&job=cache"><i class="fa fa-refresh"></i>刷新缓存</a></li>
					</ul>
				</td>
			</tr>
		</table>
	</div>
</div>
<div class="mainbox mainborder">
	<div class="section">
		<table class="formtable">
			<tr>
				<td class="title">{$P8LANG['operation']}</td>
			</tr>
			<tr>
				<td class="headerbtn_list">
					<form name="form" action="{$this_url}"  method="get">
						时间：<input type="text" name="date" value="{if !empty($date)}$date{/if}" autocomplete="off" onclick="rcalendar(this, 'YYYY-MM-DD')"/> 
						时段：<select name="date_time">
						<option value="">请选择时段</option>
						<!--{foreach $config['date_time'] $v}-->
						<option value="$v[code]" {if $date_times==$v['code']}selected{/if}>$v[name]</option>
						<!--{/foreach}-->
						</select>
						部门：<select name="dcode">
						<option value="">请选择部门</option>
						<!--{foreach $config['department'] $v}-->
						<option value="$v[code]" {if $dcode==$v['code']}selected{/if}>$v[name]</option>
						<!--{/foreach}-->
						</select>						
						姓名：<input type="text" name="name" value="{if !empty($name)}$name{/if}"/>
						<input type="submit" value="搜索" class="submit"/>
						<input type="hidden" name="plugin" value="schedul"/>
					</form>
				</td>
			</tr>
		</table>
	</div>
</div>
<div class="mainbox mainborder">
	<div class="section">
		<form name="form1" action="{$this_url}"  onsubmit="return check();" method="post" id="form">
			<table class="columntable formtable hover_table click_changeable">
				<tr class="title">
					<td width="3%" align="center" class="title"><input type="checkbox" name="cl" onclick="check_all(this, 'id[]', $('#form'));init_tr($('#form'));" /></td>
					<td width="5%" align="center" class="title">ID</td>
					<td class="title">日期</td>
					<td class="title">时段</td>
					<td class="title">部门</td>
					<td class="title">姓名</td>
					<td class="title">职称/职务</td>
					<td class="title">电话</td>
					<td class="title">排序</td>
					<td class="title">操作</td>
				</tr>
				<!--{foreach $list $row}-->
				<tr>
					<td align="center"><input type="checkbox" name="id[]" value="$row[id]" /></td>
					<td align="center"><input type="hidden" name="listorder[]" value="$row[id]"/>$row[id]</td>
					<td>$row[date]</td>
					<td>{$date_time[$row[date_time]]}</td>
					<td>{$department[$row[dcode]]}</td>
					<td>$row[name]</td>
					<td>$row[level]</td>
					<td>$row[phone]</td>
					<td><a href="javascript:;" onclick="up(this)">↑</a><a href="javascript:;" onclick="down(this)">↓</a></td>
					<td align="center"><a id="delete_{$row[id]}" href="{$this_url}?plugin=schedul&job=edit&date=$row[date]&id=$row[id]"><img src="{$SKIN}/button_edit.gif" border="0" /></a> <a href="javascript:;" onclick="removeitem(this,$row[id])"><img src="{$SKIN}/del_icon2.gif" border="0" /></a></td>
				</tr>
				<!--{/foreach}-->
				<tr>
					<td colspan="5" >
					<a name="op"></a>
					<a href="javascript:void(0)" onclick="check_all(true, 'id[]');init_tr($('#form'));">全选</a> /
					<a href="javascript:void(0)" onclick="check_all(false, 'id[]');init_tr($('#form'));">反选</a>
					<input type="submit" class="submit_btn" value="保存排序" /><input type="hidden" name="do" value="order"/>
					<input type="button" value="删除内容" onclick="removeitems(checked_values('id[]', $('#form')))" class="edit_btn" />
					<input type="hidden" name="plugin" value="schedul"/></td><td class="pages" colspan="5">{$pages}</td>
				</tr>
			</table>
		</form>
	</div>
</div>
<div class="mainbox mainborder">
	<div class="section">
		<table class="formtable">
			<tr>
				<td class="title">{$P8LANG['help_about']}</td>
			</tr>
			<tr>
				<td class="headerbtn_list">
					<button onclick="show_msg_win()">查看调用本插件的代码</button>
				</td>
			</tr>
		</table>
	</div>
</div>
<div id="showimgbox"><img src="" id="showimg" width="300" height="100" /></div>
<script type="text/javascript">
function removeitem(obj,id){
	if(confirm('确定要删除？'))$.post('{$this_url}','plugin=schedul&do=delete&id='+id, function(){ $(obj).parent().parent().remove(); alert('操作成功');})
}
function removeitems(ids){
	if(!confirm('$P8LANG[confirm_to_delete]')) return;
	var id = [];
	$.each(ids, function(k, v){
		id.push(v.replace(/[^0-9]/g, ''));
	});
	$.ajax({
		url: '{$this_url}?plugin=schedul',
		type: 'POST',
		dataType: 'json',
		data: ajax_parameters({do: 'deleteitems', id: id}),
		cache: false,
		beforeSend: function(){
			ajaxing({});
		},
		success: function(json){
			ajaxing({action: 'hide'});
			
			for(var i in json){
				$('#delete_'+ json[i]).parent().parent().remove();
			}
			location.reload();
		}
	});
}
function up(obj){
	var pre = $(obj).parent().parent().prev();
	pre.before($(obj).parent().parent());
}

function down(obj){
	var ne = $(obj).parent().parent().next();
	ne.after($(obj).parent().parent());
}
var dialog = new P8_Dialog({
	title_text: '{$P8LANG['help_about']}',
	width: 480,
	height: 200
});
function show_msg_win(){
	dialog.show();
	var msg_win = "在当前模板的HTML文件中的适当位置添加调用代码：<br/><xmp>\$"+"plugin[schedul]</xmp>";
	dialog.content.html(msg_win);
}
</script>
<!--{/php168}-->
