<!--{php168}-->
<!--{template $this_system header admin}-->
<script type="text/javascript" src="{$RESOURCE}/js/jq_ui.core.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/jq_tabs.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/recursive_selector.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/upload.js"></script>
<link rel="stylesheet" href="{$SKIN}/{$SYSTEM}/category_selector.css" type="text/css" />
<style type="text/css">
body, html{overflow:inherit;}
.ui-widget.ui-widget-content{border:none;}
.ui-tabs .ui-tabs-nav{width:100%;border:none;padding:0;background:transparent;border-radius:0 !important;}
.ui-tabs .ui-tabs-nav li { float: left;height:32px;line-height:32px;margin-right:12px;background:#e8ebf3;border:none;border-top-left-radius:4px;border-top-right-radius: 4px;}
.ui-tabs .ui-tabs-nav li a {color:#757575;padding:0 10px;border-top-left-radius:4px;border-top-right-radius: 4px;display: -ms-flexbox;display: flex;-ms-flex-pack: justify;justify-content: flex-start;-ms-flex-align: center;align-items: center;}
.ui-tabs .ui-tabs-nav li span {display:block;}
.ui-tabs .ui-tabs-nav li.ui-state-active { background:#0079bd;}
.ui-tabs .ui-tabs-nav li a, .ui-tabs.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-selected a,.ui-tabs .ui-tabs-nav li a:focus {cursor: pointer;outline:none;}
.ui-tabs .ui-tabs-nav li.ui-state-active a{color:#fff;;border:0;background:none;}
.ui-tabs .ui-tabs-panel { border:1px solid #EFEFEF; border-top:1px solid #6C9AD9; border-bottom:none; }
.ui-tabs .ui-tabs-hide { display: none !important; }
</style>
<div class="section">
	<table class="formtable" width="100%">
		<tr>
			<td class="headerbtn_list">
				<ul class="sites-top-menu">
					<li><a href="{$this_system.admin_controller}/item-list" target="main"><i class="fa fa fa-list-ul"></i>内容管理</a></li>
					<li><a href="{$this_system.admin_controller}/category-list" target="main"><i class="fa fa-cog"></i>栏目管理</a></li>
					<li><a href="{$this_system.admin_controller}/category-recycle_list" target="main"><i class="fa fa-line-chart"></i>信息回收站</a></li>
					<li style="float:right;background:#367fc1;border-radius:4px;height:30px;line-height:30px;"><a href="{if empty($site_info['ipordomain'])}{$core->CONFIG['url']}/s.php/{$site}{else}{$site_info['domain']}{/if}" style="color:#fff;border:none;box-shadow:none;height:30px;line-height:30px;" target="_blank"><i class="fa fa-map-marker"></i>当前站点：{$site_info['sitename']}</a></li>
				</ul>
			</td>
		</tr>
	</table>
</div>
<div class="mainbox mainborder">
	<div class="section">
		<form action="$this_url?site={$this_system->SITE}" method="post" id="form">
			<table width="100%" border="0" class="mainbox">
				<tbody>
					<tr>
						<td>
							<ul class="sites-down-menu">
								<li class="btn-color1"><a href="{$this_system.admin_controller}/category-add"><i class="icon icon-ico44"></i>添加栏目</a></li>
								<li class="btn-color2"><a href="#"><i class="icon icon-ico48"></i>复制栏目</a></li>
								<li class="btn-color3"><a href="#"><i class="icon icon-ico45"></i>编辑栏目</a></li>
								<li class="btn-color5"><a href="#"><i class="icon icon-ico46"></i>删除栏目</a></li>
								<li class="btn-color6"><a href="#"><i class="icon icon-ico49"></i>合并栏目</a></li>
								<li class="btn-color7"><a href="#"><i class="icon icon-ico45"></i>栏目可视化</a></li>
								<li class="btn-color8"><a href="#"><i class="icon icon-ico45"></i>内容页可视化</a></li>
								<li class="btn-color9"><a href="#"><i class="icon icon-ico51"></i>查看动态</a></li>
								<li class="btn-color10"><a href="#"><i class="icon icon-ico51"></i>查看静态</a></li>
							
							
							</ul>
						</td>
					</tr>
				</tbody>
			</table>
			<table width="100%" cellspacing="0" cellpadding="0" class="zq_list">
				<tbody>
					<tr>
						<td id="tabs">
							<ul>
								<li><a href="#tabs-1"> <span>基本配置</span> </a></li>
								<li><a href="#tabs-2"> <span>风格配置</span> </a></li>
								<li><a href="#tabs-3"> <span>权限配置</span> </a></li>
								<li><a href="#tabs-4"> <span>其他配置</span> </a></li>
							</ul>
							<div id="tabs-1">
								<table class="zq_list hover_table">
									<!--{if !empty($data['id'])}-->
									<tr>
										<td class="tdL">{$P8LANG['cid']}</td>
										<td class="tdR">{$data['id']}</td>
										<td class="tdR">{$P8LANG['cid']}</td>
									</tr>
									<!--{/if}-->
									<tr>
										<td class="tdL"><strong>栏目名称</strong></td>
										<td class="tdR">
											<!--{if $ACTION == 'update'}-->
												<input type="text" class="txt" id="name" name="name" value="{if isset($data['name'])}$data[name]{/if}" />
											<!--{else}-->
												<textarea id="name" name="name"  cols="30" rows="5"></textarea>
												
											<!--{/if}-->
										</td>
										<td class="tdR"><span>单个栏目添加： 一行输入一个栏目名称即可；<br/>批量栏目添加：每个栏目名称换一行即可；</span></td>
									</tr>
									<tr>
										<td class="tdL"><strong>类型</strong></td>
										<td class="tdR">
										<select name="type" onchange="showoutlink(this,'');change_model($('#model').val())" id="type">
											<option value="">请选择类型</option>
											<option value="1"{if !empty($data['type']) && $data['type'] == 1} selected{/if}>{$P8LANG['sites_category_type_1']}</option>
											<option value="2"{if !empty($data['type']) && $data['type'] == 2} selected{/if}>{$P8LANG['sites_category_type_2']}</option>
											<option value="3"{if !empty($data['type']) && $data['type'] == 3} selected{/if}>{$P8LANG['sites_category_type_3']}</option>
											<option value="4"{if !empty($data['type']) && $data['type'] == 4} selected{/if}>单网页</option>
										</select>
											
										</td>
										<td class="tdR"><br/>下面还有子栏目的就选“大分类” ；下面没有更小子栏目的就选“栏目”；<br/>如果一个栏目就是一篇内容就选“单网页”；如果点击栏目跳转到另外网址就选“外链”；</td>
									</tr>
									<tr>
										<td class="tdL"><strong>所属栏目</strong></td>
										<td class="tdR">
											<span id="parents"></span>
											<input type="button" value="选择栏目.." onclick="dialog.show()" />
											<input type="hidden" name="parent" value="{if isset($data['parent'])}$data[parent]{/if}" />
											<input type="hidden" id="parent" />
										</td>
										<td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">转向设置</td>
										<td class="tdR">                
											<span id="directid"></span>
											<input type="button" value="设置.." onclick="direct_category_dialog.show()" />
											<input type="text" size="5" id="direct_to_category_id" name="config[direct_to_category_id]" value="{if isset($config['direct_to_category_id'])}$config[direct_to_category_id]{/if}" />
										</td>
										<td class="tdR">直接转向子栏目的ID，外链地址优先级高于转向设置。</td>
									</tr>
									<tr id="category_outlink">
										<td class="tdL">外链地址</td>
										<td class="tdR">
											<input type="text" class="txt" name="url" id="outlink" value="{if !empty($data['url'])}$data[url]{/if}" size="50"/>
											打开窗口:
											<input type="radio" name="config[target]" id="_self" value="_self" {if !empty($config['target']) && $config['target']=='_self'} checked{/if}/> <label for="_self">本窗口</label>
											<input type="radio" name="config[target]" id="_blank" value="_blank" {if empty($config['target']) || $config['target']=='_blank'} checked{/if}/> <label for="_blank">新开窗口</label>
										</td>
										<td class="tdR">外链地址不为空时，则以外链地址为第一优先。</td>
									</tr>	
									<tr>
										<td class="tdL"><strong>模型</strong></td>
										<td class="tdR">
											<select name="model" id="model" onchange="change_model(this.value)">
												<option value="">请选择模型</option>
												<!--{foreach $models $mod $v}-->
												{if $v['enabled']}<option value="$mod"{if !empty($data['model']) && $data['model'] == $mod}selected{/if}>$v[alias]</option>{/if}
												<!--{/foreach}-->
											</select>
										</td>
										<td class="tdR">一般选择“文章”模型，可以发布文章图片视频和外链；若一个栏目一篇内容选择“单网页”；<br/>展示大图片切换效果的选“图片”模型；专门的视频效果页面选择“视频”模型；
										<a href="$this_system->admin_controller/model-list" target="_blank" style="color:blue;">模型配置</a>
										</td>
									</tr>
									<tr>
										<td class="tdL">{$P8LANG['htmlize']}</td>
										<td class="tdR">
											<input type="radio" name="htmlize" id="htmlize_1" value="1"{if !empty($data['htmlize']) && $data['htmlize'] == 1} checked{/if} /><label for="htmlize_1">全部静态</label>
											<input type="radio" name="htmlize" id="htmlize_2" value="2"{if !empty($data['htmlize']) && $data['htmlize'] == 2} checked{/if} /><label for="htmlize_2">仅内容页静态</label>
											<input type="radio" name="htmlize" id="htmlize_0" value="0"{if empty($data['htmlize'])} checked{/if} /><label for="htmlize_0">不静态</label>				
										</td>
										<td class="tdR">一般选择“全部静态”，方便动静态分离部署；或者至少也选择“仅内容页静态”；</td>
									</tr>	
									<tr id="all_model">
										<td class="tdL">列表页是否显示所有内容</td>
										<td class="tdR"><input type="radio"  name="list_all_model" value="0" {if empty($data['list_all_model'])}checked{/if}/> 否 <input type="radio"  name="list_all_model" value="1" {if !empty($data['list_all_model'])}checked{/if}/> 是
										</td>
										<td class="tdR"><span>实现大分类可分页，要配合模板使用</span></td>
									</tr>
									<tr>
										<td class="tdL">每页内容数量</td>
										<td class="tdR"><input type="text" class="txt" name="page_size"  value="{if !empty($data['page_size'])}{$data['page_size']}{else}30{/if}" size="4" /> 条
										</td>
										<td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">发布数量预警数</td>
										<td class="tdR">
										年度：<input type="text" class="txt" name="config[post_year]"  value="{if !empty($config['post_year'])}{$config['post_year']}{else}0{/if}" size="3" /> 条<br/>
										季度：<input type="text" class="txt" name="config[post_quarter]"  value="{if !empty($config['post_quarter'])}{$config['post_quarter']}{else}0{/if}" size="3" /> 条<br/>
										每月：<input type="text" class="txt" name="config[post_month]"  value="{if !empty($config['post_month'])}{$config['post_month']}{else}0{/if}" size="3" /> 条<br/>
										每周：<input type="text" class="txt" name="config[post_week]"  value="{if !empty($config['post_week'])}{$config['post_week']}{else}0{/if}" size="3" /> 条
										</td>
										<td class="tdR">为空或填0表示不限制</td>
									</tr>
									<tr>
										<td class="tdL">发布预警天数</td>
										<td class="tdR"><input type="text" class="txt" name="config[post_size]"  value="{if !empty($config['post_size'])}{$config['post_size']}{else}0{/if}" size="4" /> 天
										</td>
										<td class="tdR">为空或填0表示不预警，超过指定天数没在本栏目发新内容即在会员中心首页弹窗预警提示。</td>
									</tr>
									<tr>
										<td class="tdL">弹窗预警接收人</td>
										<td class="tdR">
											<input type="button" class="edit_btn" value="选择预警接收人" onclick="show_dialog('manager')"/><br/>
											<ul id="manager" class="manager_ids">
												<!--{foreach $managers $user}-->
												<li>{$user['username']} / {$user['name']} / {$user['email']}<input type="hidden" name="config[manager][]" value="{$user['id']}"/> <span onclick="delete_manager(this)" class="delete_link">[X]</span></li>
												<!--{/foreach}-->
											</ul>
										</td>
										<td class="tdR">在会员会员中心首页时弹窗提示</td>
									</tr>
									<tr>
										<td class="tdL">列表页排序</td>
										<td class="tdR">
											<select name="config[orderby]">
												<!--{foreach $order_fields $name $v}-->
												<option value="$name"{if !empty($config['orderby']) && $config['orderby'] == $name} selected{/if}>$v</option>
												<!--{/foreach}-->
											</select>
											<input type="radio" name="config[orderby_desc]" id="orderby_desc_0" value="0"{if empty($config['orderby_desc'])} checked{/if} /><label for="orderby_desc_0">降序</label>
											<input type="radio" name="config[orderby_desc]" id="orderby_desc_1" value="1"{if !empty($config['orderby_desc'])} checked{/if} /><label for="orderby_desc_1">升序</label>
										</td>
										<td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">位置排序</td>
										<td class="tdR"><input type="text" class="txt" name="display_order"  value="{if !empty($data['display_order'])}{$data['display_order']}{else}0{/if}" size="4" /> 
										</td>
										<td class="tdR"><span>数字越大，排得靠前</span></td>
									</tr>
									<tr>
										<td class="tdL">栏目列表标题长度</td>
										<td class="tdR">
											<input type="text" class="txt" name="config[list_title_length]" value="{if !empty($config['list_title_length'])}$config[list_title_length]{else}120{/if}" size="5" />
										</td>
										 <td class="tdR"></td>
									</tr>
								</table>
							</div>
							<div id="tabs-2">
								<table class="zq_list hover_table">
									<tr>
										<th class="tdL">&nbsp;&nbsp;项目</th>
										<th class="tdR" style="width:40%">个人电脑</th>
										<th class="tdR" style="width:40%"></th>
									</tr>
									<tr>
										<td class="tdL">栏目列表页模板</td>
										<td class="tdR" >
											<input type="text" class="txt" name="list_template" id="lt" value="{if !empty($data['list_template'])}$data[list_template]{/if}" size="30" />
											<input type="button" value="{$P8LANG['select_template']}" onclick="list_template_dialog.show()" />
										</td>
										 <td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">栏目内容页模板</td>
										<td class="tdR">
											<input type="text" class="txt" name="view_template" id="vt" value="{if !empty($data['view_template'])}$data[view_template]{/if}" size="30" />
											<input type="button" value="{$P8LANG['select_template']}" onclick="view_template_dialog.show()" />
										</td>
										 <td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">栏目列表显示样式</td>
										<td class="tdR">
											<input type="text" class="txt" name="item_template" id="it" value="{if !empty($data['item_template'])}$data[item_template]{/if}" size="30" />
											<input type="button" value="{$P8LANG['select_template']}" onclick="item_template_dialog.show()" />
										</td>
										 <td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">标题超过字数是否用省略号表示</td>
										<td class="tdR">
											<input type="radio" name="config[list_title_length_dot]" value="1" {if !empty($config['list_title_length_dot'])}checked{/if}/>{$P8LANG['Y']}
											<input type="radio" name="config[list_title_length_dot]" value="0" {if empty($config['list_title_length_dot'])}checked{/if}/>{$P8LANG['N']}
										</td>
										<td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">母站同步对接</td>
										<td class="tdR">
											<span id="matrix_cid"></span>
											<input type="button" value="选择栏目.." onclick="matrix_dialog.show()" />
											<input type="hidden" name="matrix" value="{if isset($data['matrix'])}$data[matrix]{/if}" />
											<input type="hidden" id="matrix" />
										</td>
										<td class="tdR">对接后，此栏目所发之内容会自动发布到母站与之对接之栏目中。</td>
									</tr>
								   
									<tr>
										<td class="tdL">栏目列表页分页模板</td>
										<td class="tdR">
											<input type="text" class="txt" name="config[list_pages_template]" value="{if !empty($config['list_pages_template'])}$config[list_pages_template]{/if}" size="30" />
											
										</td>
										 <td class="tdR"><span>{$P8LANG['sites_category_pages_template_note']}</span></td>
									</tr>
									
									<tr>
										<td class="tdL">栏目内容页分页模板</td>
										<td class="tdR">
											<input type="text" class="txt" name="config[view_pages_template]" value="{if !empty($config['view_pages_template'])}$config[view_pages_template]{else}base_page_template{/if}" size="30" />
											
										</td>
										 <td class="tdR"><span>{$P8LANG['sites_category_pages_template_note']}</span></td>
									</tr>
									
									<tr>
										<td class="tdL">封面图片</td>
										<td class="tdR" >
											<input type="text" class="txt" name="frame" id="frame"  value="{if !empty($data['frame'])}{$data['frame']}{/if}" size="50" />
											<input type="button" onclick="uploader.choseup();" value="上传缩略图" />
											<input type="button" onclick="uploader_init.choseup();" value="上传原始图" />
											<input type="button" id="frame_toggle" onclick="" value="" style="display: none;" />
											<a href="###" onclick="uploader.image_cut()">[$P8LANG[image_cut]]</a><br />
											
											<script type="text/javascript">
											var uploader;
											var uploader_init;
											$(function(){
												uploader = new P8_Upload({
													element: {
														src: $('#frame'),
														attribute: 'value'
													},
													param: {
														return_thumb: true<!--{if !empty($this_model['CONFIG']['frame_thumb_width']) && !empty($this_model['CONFIG']['frame_thumb_height'])}-->,
														thumb_width: {$this_model['CONFIG']['frame_thumb_width']},
														thumb_height: {$this_model['CONFIG']['frame_thumb_height']}
														<!--{/if}-->
													}
												});
												uploader_init = new P8_Upload({
													element: {
														src: $('#frame'),
														attribute: 'value'
													},
													param: {}
												});
											});
											</script>
										</td>
										 <td class="tdR"></td>
									</tr>
									<tbody id="more_option" style="display:none">  
										<tr>
											<td class="tdL">栏目导航HTML</td>
											<td class="tdR">
												<textarea name="config[navigation]" cols="90" rows="5">
													{if isset($config[navigation])}{$config['navigation']}{/if}
												</textarea>				
											</td>
											<td class="tdR">调用示例：{\$CAT['CONFIG']['navigation']}</td>
										</tr>
										<tr>
											<td class="tdL">栏目简介</td>
											<td class="tdR">
												<textarea name="config[summary]" cols="90" rows="5">
													{if isset($config[summary])}{$config['summary']}{/if}
												</textarea>
											</td>
											<td class="tdR"></td>
										</tr>
										<tr>
											<td class="tdL">栏目底部版权HTML</td>
											<td class="tdR">
												<textarea name="config[copyright]" cols="90" rows="5">
													{if isset($config[copyright])}{$config['copyright']}{/if}
												</textarea>				
											</td>
											<td class="tdR">调用示例：{\$CAT['CONFIG']['copyright']}</td>
										</tr>
										<tr>
											<td class="tdL">栏目简介链接</td>
											<td class="tdR"><input type="text" class="txt" name="config[linkurl]"  value="{$config['linkurl']}" size="50" /> 调用示例：{\$CAT['CONFIG']['linkurl']}
											</td>
											<td class="tdR"></td>
										</tr>
										<tr>
											<td colspan="3" class="text-center"><a href="javascript:;" onclick="javascript:$('#more_option').css('display','none');$('#more_but').show()">↑收起更多</a></td>
										</tr>
									</tbody>				
									<tbody>
										<tr id="more_but">
											<td colspan="3" class="text-center"><a href="javascript:;" onclick="javascript:$('#more_option').css('display','');$(this).parent().parent().hide()">↓更多选项....</a></td>
										</tr>
									</tbody>
								</table>
							</div>
							<div id="tabs-3">
								<table class="zq_list hover_table">
									<tr>
										<td class="tdL">栏目是否启用登录后访问</td>
										<td class="tdR"><input type="radio" name="config[need_login]" value="0" {if empty($config['need_login'])}checked{/if}/> 否 <input type="radio"  name="config[need_login]" value="1" {if !empty($config['need_login'])}checked{/if}/> 是
										</td>
										<td class="tdR">默认不启用。</td>
									</tr>
									<tr>
										<td class="tdL">栏目是否启用密码访问</td>
										<td class="tdR"><input type="radio" name="need_password" value="0" {if empty($data['need_password'])}checked{/if}/> 否 <input type="radio"  name="need_password" value="1" {if !empty($data['need_password'])}checked{/if}/> 是
											<input type="checkbox" name="password_rule_apply_category" value="1" />{$P8LANG['cms_category_apply_to_sub_categories']}
											<span class="help">默认不启用。</span>
										</td>
										<td class="tdR">建议勾选"应用到子分类"选项，设置子分类应用相同设置和密码。<br />一旦启用，则访问分类和子分类时，仅需一次密码验证。
										<br />如果网站中有设置不同分类使用不同密码的，则访问不同分类时，都必须输入一次密码。</td>
									</tr>
									<tr>
										<td class="tdL">栏目访问密码</td>
										<td class="tdR"><input type="text" class="txt" name="category_password"  value="{$data['category_password']}" size="30" /> <span class="help">启用栏目密码访问时的访问密码，不启用则设置无效</span>
										</td>
										<td class="tdR">默认不填。</td>
									</tr>
									 <tr>
									<td class="tdL">审核流程</td>
									<td class="tdR">
										<select name="config[auditflow]">
											<option value="0">--请选择--</option>
											<!--{foreach $auditFlowSteps $auid $auval}-->
											<option value="$auid" {if $config[auditflow]==$auid}selected{/if}>$auval</option>
											<!--{/foreach}-->
										</select>
										<a href="{$core.admin_controller}/core/auditflow-list?module=sites" target="_blank" style="color:blue;">审核流配置</a>
										<input type="checkbox" name="allow_auditflow_apply_category" value="1" />{$P8LANG['sites_category_apply_to_sub_categories']}				
							
                                        <span class="help">选择了此项后，原来的初审终审失效</span>
									</td>
								</tr>
									<tr>
										<td class="tdL">授权浏览用户</td>
										<td class="tdR">
										 <ul id="authority_viewer" class="manager_ids">
										<!--{foreach $authority_viewer $user}-->
										<li>{$user['username']}<input type="hidden" name="config[authority_viewer][]" value="{$user['id']}"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>
										<!--{/foreach}-->
										</ul><input type="button" value="选择" onclick="show_role_dialog()"/>	
										</td>
										<td class="tdR">功能状态：{if $item_config['authority']}开启{else}关闭{/if}，<a href="{$this_system.admin_controller}/item-config#authority" target="_blank" style="color:blue;">设置角色浏览控制</a></td>
									</tr>
									<tr>
										<td class="tdL">授权浏览角色组</td>
										<td class="tdR">
											<input type="checkbox" name="config[authority][]" id="authority0" value="0" {if in_array('0',$authority)}checked="checked"{/if} />
											<label for="authority0">不限</label>
											<!--{foreach $core->roles $yid $v}-->
											<!--{if $v['gid'] != 1}-->
											<input type="checkbox" name="config[authority][]" value="{$yid}" id="authority{$yid}" {if in_array($yid,$authority)}checked="checked"{/if} />
											<label for="authority{$yid}">{$v['name']}</label>
											<!--{/if}-->
											<!--{/foreach}-->
											<span class="help">全选和不选都表示不限制</span>
										</td>
										<td class="tdR">功能状态：{if $item_config['authority']}开启{else}关闭{/if}，<a href="{$this_system.admin_controller}/item-config#authority" target="_blank" style="color:blue;">设置角色浏览控制</a></td>
									</tr>
									<script type="text/javascript">							
										function delete_manager(obj){
											$(obj).parent().remove();	
										}
										function member_single_select_callback(checked, json){
											$('#authority_viewer').find("input[value="+json.id+"]").parent().remove();
											if(checked)	$('#authority_viewer').append('<li>'+json.username+'<input type="hidden" name="config[authority_viewer][]" value="'+json.id+'"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>');
										}
										var role_dialog = new P8_Dialog({
											title_text:'选择用户',
											width: 600,
											height: 440,
											button: true
										});
										role_dialog.content.append($('<iframe width="100%" height="360" frameborder="0" border="0" marginwidth="0" marginheight="0"></iframe>'));

										function show_role_dialog(){
											role_dialog.show();
											var ifr = role_dialog.content.find('iframe');
											var check_uids = {};
											$('#authority_viewer').find('input').each( function(){ check_uids[$(this).val()]=$(this).val(); } );
											ifr.attr('src', '{$core.U_controller}/core/member-selectuser?'+ajax_parameters({'checked_ids': check_uids}));
										}
									</script>
									<tr>
										<td class="tdL">是否启用IP允许</td>
										<td class="tdR">
											<input type="radio" name="config[allow_ip][enabled]" id="allow_ip_enabled_0" value="0" {if empty($config['allow_ip']['enabled'])} checked{/if}/><label for="allow_ip_enabled_0">不开启</label>
											<input type="radio" name="config[allow_ip][enabled]" id="allow_ip_enabled_2" value="2" {if !empty($config['allow_ip']['enabled']) && $config['allow_ip']['enabled']==2} checked{/if}/><label for="allow_ip_enabled_2">启用仅限局域网访问</label>
											<input type="radio" name="config[allow_ip][enabled]" id="allow_ip_enabled_1" value="1" {if !empty($config['allow_ip']['enabled']) && $config['allow_ip']['enabled']==1} checked{/if}/><label for="allow_ip_enabled_1">开启</label>
											<input type="checkbox" name="allow_ip_apply_category" value="1" />{$P8LANG['sites_category_apply_to_sub_categories']}				
										</td>
										<td class="tdR">设置“启用仅限局域网访问”则栏目和栏目下的内容将使用主站域名且使用动态URL访问！<br/>选开启时下面的IP设置才有效，IP检测顺序：全站IP->栏目IP</td>
									</tr>
									<tr>
										<td class="tdL">允许IP</td>
										<td class="tdR">
											<textarea cols="30" rows="8" name="config[allow_ip][collectip]" style="float:left;width:208px;margin-right:10px;">
											<!-- {if !empty($config['allow_ip']['collectip'])} -->
												<!-- {foreach $config['allow_ip']['collectip'] $key $value} -->
													{$value}
												<!-- {/foreach} -->
											<!-- {/if} -->
											</textarea><div style="float;margin-left:10px;">访问的客户端必须是固定IP或者在固定的IP段内<br/>
											否则很有可能导致客户端无法正常访问<br/>
											书写格式每行一个IP，示例如下：<br/>
											12.*.*.*<br/>
											12.34.56.79</div>					
										</td>
										<td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">允许IP段</td>
										<td class="tdR">
											<input name="config[allow_ip][beginip]" type="text" class="txt" id="" value="{if !empty($config['allow_ip']['beginip'])}{$config['allow_ip']['beginip']}{/if}" size="33" />							
											 -- <input id="" type="text" class="txt" name="config[allow_ip][endip]" value="{if !empty($config['allow_ip']['endip'])}{$config['allow_ip']['endip']}{/if}" /> 
											<span class="point">例如：192.168.0.2-192.168.0.111</span>
										</td>
										<td class="tdR"></td>
									</tr>
									<tr>
										<td class="tdL">允许IP段内例外IP</td>
										<td class="tdR">
											<textarea cols="30" rows="6" name="config[allow_ip][ruleoutip]" style="float:left;width:208px;margin-right:10px;">
											<!-- {if !empty($config['allow_ip']['ruleoutip'])} -->
												<!-- {foreach $config['allow_ip']['ruleoutip'] $key $value} -->
													{$value}
												<!-- {/foreach} -->
											<!-- {/if} -->
											</textarea>
											<div style="float;margin-left:10px;">在允许IP段内，可以限制例外的IP地址<br/>
											书写格式每行一个IP，示例如下：<br/>
											12.*.*.*<br/>
											12.34.56.79</div>															
										</td>
										<td class="tdR"></td>
									</tr>
								</table>
							</div>
							<div id="tabs-4">
								<table class="zq_list hover_table">
									<!--{if $ACTION == 'update'}-->
									<tr style="display:none">
										<td class="tdL">绑定域名</td>
										<td class="tdR">
											<input type="text" class="txt" name="domain"  value="{if !empty($data['domain'])}{$data['domain']}{/if}" size="60" />
											
										</td>
										 <td class="tdR"><span>{$P8LANG['sites_category_domain_note']}</span></td>
									</tr>
									
									<tr>
										<td class="tdL">静态化</td>
										<td class="tdR">
											<input type="radio" name="htmlize" id="htmlize_1" value="1"{if !empty($data['htmlize']) && $data['htmlize'] == 1} checked{/if} /><label for="htmlize_1">全部静态</label>
											<input type="radio" name="htmlize" id="htmlize_2" value="2"{if !empty($data['htmlize']) && $data['htmlize'] == 2} checked{/if} /><label for="htmlize_2">仅内容页静态</label>
											<input type="radio" name="htmlize" id="htmlize_0" value="0"{if empty($data['htmlize'])} checked{/if} /><label for="htmlize_0">不静态</label>
											<input type="checkbox" name="htmlize_apply_category" value="1" id="apply" /><label for="apply">{$P8LANG['sites_category_apply_to_sub_categories']}</label>
										</td>
										 <td class="tdR"></td>
									</tr>
									
									<tr>
										<td class="tdL">静态页存放路径</td>
										<td class="tdR"><!--{if !empty($data['path'])}-->
											<input type="text" class="txt" name="path"  value="<!--{php echo basename($data['path']);}-->" size="60" /> 
											{\$DOCUMENT_ROOT}<!--{php echo str_replace(PHP168_PATH, '', $this_system->path .$this_system->SITE.'/'. $data['path']);}-->
											<!--{else}-->
											<input type="text" class="txt" name="path"  value="" size="60" />
											<!--{/if}-->
											
										</td>
										 <td class="tdR"><span>如果静态列表、内容页规则不使用{\$category_url}的话这所填之参数将不起作用</span></td>
									</tr>
									
									<tr>
										<td class="tdL">静态列表页URL规则</td>
										<td class="tdR">
										   <input type="text" class="txt" name="html_list_url_rule"  value="{if !empty($data['html_list_url_rule'])}{$data['html_list_url_rule']}{else}{\$category_url}/#list-{\$page}.html#{/if}" size="60" />
											<input type="checkbox" name="list_rule_apply_category" value="1" />{$P8LANG['sites_category_apply_to_sub_categories']}
											
										</td>
										 <td class="tdR">
											{\$system_url}: 本分站绑定之域名<br/>
											{\$category_url}静态页存放路径<br/>
											{\$id}: 当前分类的ID。<br/>
											{\$page}: 页码。<br/>
											##包围部分表示页码大于1才会使用
										 </td>
									</tr>
									
									<tr>
										<td class="tdL">静态内容页URL规则</td>
										<td class="tdR">
											<input type="text" class="txt" name="html_view_url_rule"  value="{if !empty($data['html_view_url_rule'])}{$data['html_view_url_rule']}{else}{\$category_url}/{\$Y}_{\$m}/{\$d}_{\$H}/content-{\$id}#-{\$page}#.html{/if}" size="60" />
											<input type="checkbox" name="view_rule_apply_category" value="1" />{$P8LANG['sites_category_apply_to_sub_categories']}
											
										</td>
										 <td class="tdR">
										{\$system_url}: 本分站绑定之域名<br/>
										{\$category_url}静态页存放路径<br/>
										{\$id}: 当前内容的ID<br/>
										{\$Y}: 年份,如2010<br/>
										{\$m}: 月份,如01,11<br/>
										{\$d}: 天,如01,11<br/>
										{\$H}: 小时,如01,11<br/>
										{\$page}: 页码
										##包围部分表示页码大于1才会使用
										 </td>
									</tr>
									
									<tr style="display:none">
										<td class="tdL">栏目收费</td>
										<td class="tdR">
											<input type="radio" name="config[fee][credit_type]" id="credit_0" value="0" /><label for="credit_0">不收费</label>
											<!--{foreach $core->credits $ccid $v}-->
											<input type="radio" name="config[fee][credit_type]" id="credit_$ccid" value="$ccid"{if !empty($config['fee']['credit_type']) && $config['fee']['credit_type'] == $ccid} checked{/if} /><label for="credit_$ccid">$v[name]</label>
											<!--{/foreach}-->
											<input type="text" name="config[fee][credit]" size="4" value="{if !empty($config['fee']['credit'])}{$config['fee']['credit']}{/if}" />
											<br />
											忽略收费的会员组: 
											<!--{foreach $core->roles $uid $v}-->
											<!--{php if($v['gid'] == $core->CONFIG['administrator_role_group']) continue;}-->
											<input type="checkbox" name="config[fee][ignore_roles][$uid]" id="gid_$uid" value="1"{if !empty($config['fee']['ignore_roles'][$uid])} checked{/if} /><label for="gid_$uid">$v[name]</label>
											<!--{/foreach}-->
										</td>
										 <td class="tdR"></td>
									</tr>
									<!--{/if}-->
									<tr>
										<td class="tdL">SEO关键词</td>
										<td class="tdR">
											<input type="text" name="seo_keywords" class="txt" value="{if !empty($data['seo_keywords'])}$data[seo_keywords]{/if}" size="60" />
										</td>
										 <td class="tdR"></td>
									</tr>
									
									<tr>
										<td class="tdL">SEO描述</td>
										<td class="tdR">
											<input type="text" name="seo_description" class="txt" value="{if !empty($data['seo_description'])}$data[seo_description]{/if}" size="60" />
										</td>
										 <td class="tdR"></td>
									</tr>
									
									<tr>
										<td class="tdL">标题样式</td>
										<td class="tdR">
											<input type="radio" name="config[title_style]" id="tt_1" value="1"{if !empty($config['title_style']) && $config['title_style'] == 1}checked{/if} /><label for="tt_1">标题_网站名称</label><br />
											<input type="radio" name="config[title_style]" id="tt_2" value="2"{if !empty($config['title_style']) && $config['title_style'] == 2}checked{/if} /><label for="tt_2">标题_栏目名称</label><br />
											<input type="radio" name="config[title_style]" id="tt_3" value="3"{if !empty($config['title_style']) && $config['title_style'] == 3}checked{/if} /><label for="tt_3">标题_栏目名称_网站名称</label>
										</td>
										 <td class="tdR"></td>
									</tr>
									
									<tr>
										<td class="tdL">独立标签后缀</td>
										<td class="tdR">
											<input type="text" name="label_postfix" value="{if !empty($data['label_postfix'])}$data[label_postfix]{/if}" size="15" />
											<!--{if $ACTION == 'update'}--><input type="button" value="填充后缀" onclick="$(this).prev().val('category_$data[id]')" />
											<!--{else}-->
											<input type="button" value="填充后缀" onclick="get_auto_label_postfix(this)" />
											<input type="hidden" id="auto_label_postfix" name="auto_label_postfix" value="0"/>
											<!--{/if}-->
											
										</td>
										 <td class="tdR"><span>{$P8LANG['sites_category_label_postfix_note']}</span></td>
									</tr>
								</table>
							</div>
						</td>
					</tr>
					<tr>
						<td class="text-center"><input type="submit" value="{$P8LANG['submit']}" class="submit_btn"/></td>
					</tr>
							 
					
				</tbody>
			</table>
			<input type="hidden" name="id" value="{if !empty($id)}$id{/if}" />
			<input type="hidden" name="suv" value="{$this_system.suv}" />
		</form>
	</div>
</div>
<script type="text/javascript">

function change_model(name){
	var f = $('select[name=type]').val();
	var lt = f==1?'big_list':'list';
	$('#lt').val(name ? name +'/'+lt : lt);
	$('#vt').val(name ? name +'/view' : 'view');
}
function delete_manager(obj){
$(obj).parent().remove();	
}
var cutten_item = null;
function member_single_select_callback(checked, json){
	$('#'+cutten_item).find("input[value="+json.id+"]").parent().remove();
	if(checked)	$('#'+cutten_item).append('<li>'+json.username+' / '+json.name+' / '+json.email+'<input type="hidden" name="config[manager][]" value="'+json.id+'"/> <span onclick="delete_manager(this)" class="delete_link">[X]</span></li>');
}
var selectuser_dialog = new P8_Dialog({
	title_text:'选择弹窗接收人',
	width: 700,
	height: 500,
	button: true
});
selectuser_dialog.content.append($('<iframe width="100%" height="360" frameborder="0" border="0" marginwidth="0" marginheight="0"></iframe>'));

function show_dialog(item){
	selectuser_dialog.show();
	cutten_item = item;
	var ifr = selectuser_dialog.content.find('iframe');
	var check_uids = {};
	$('#'+cutten_item).find('input').each( function(){ check_uids[$(this).val()]=$(this).val(); } );
	ifr.attr('src', '{$core.U_controller}/core/member-selectuser?'+ajax_parameters({'checked_ids': check_uids}));
}
$('#form').validate({
	rules: {
		type: {
			required: true
		},
		model: {
			required: true
		},
		name: {
			required: true
		}<!--{if $ACTION == 'update'}-->,
		
		parent: {
			remote: {
				url: '$this_router-verify',
				data: {
					data: 'parent',
					id: function(){return $('#form input[name=id]').val();},
					parent: function(){return $('#form input[name=parent]').val();}
				},
				beforeSend: function(){
					ajaxing({});
				},
				complete: function(){
					ajaxing({action: 'hide'});
				}
			}
		},
		path: {
			required: function(){return parseInt($('#form input[name=htmlize]:checked').val()) ? true : false},
			remote: {
				url: '$this_router-verify',
				data: {
					id: $('#form input[name=id]').val(),
					data: 'path',
					parent: function(){return $('#form input[name=parent]').val();},
					path: function(){return $('#form input[name=path]').val();}
				},
				beforeSend: function(){
					ajaxing({});
				},
				complete: function(){
					ajaxing({action: 'hide'});
				}
			}
		}
		<!--{/if}-->

	},
	
	messages: {
		model: {
			required: '{$P8LANG['sites_category_model_can_not_be_empty']}'
		},
		type: {
			required: '{$P8LANG['sites_category_type_can_not_be_empty']}'
		},
		name: {
			required: '{$P8LANG['sites_category_name_can_not_be_empty']}'
		},
		parent: {
			remote: '{$P8LANG['sites_parent_category_error']}'
		},
		path: {
			required: 'path',
			remote: '{$P8LANG['sites_category_html_path_exists']}'
		}
	},
	
	errorPlacement: function(error, element) {
		error.wrap('<div></div>').appendTo(element.parent().prev());
	},
	wrapper: 'div',
	
	onkeyup: false
});

$('#name').focus();

var dialog = new P8_Dialog({
	title_text: '{$P8LANG['select_parent_category']}',
	button: true,
	width: 700,
	height: 500,
	ok: function(){
		var id = cs.get_value();
		$('#form input[name=parent]').val(id);
		parent_path(id);
	},
	show: function(){
		cs.init();
	}
});

var cs = new Recursive_Selector({
	input: $('#parent'),
	dialog: dialog,
	sub_property: 'categories',
	url: '{$this_system.siteurl}/category-json',
	value: $('#form input[name=parent]').val(),
	init_callback: function(){
		parent_path(this.get_value());
	},
	item_callback: function(cat, item){
		if(cat.type == 1)
			item.find('span').addClass('frame_category');
		
		if(cat.categories)
			item.addClass('sub_category');
	}
});

function parent_path(cid){
	if(cid == 0){
		$('#parents').html('');
		return;
	}
	
	var tmp = cs.get_by_id(cid);
	var html = '';
	
	while(true){
		html = tmp.name +' &gt; '+ html;
		if(tmp.parent == 0) break;
		
		tmp = cs.get_by_id(tmp.parent);
	}
	
	$('#parents').html(html);
}

var direct_category_dialog = new P8_Dialog({
	title_text: '选择转向栏目',
	button: true,
	width: 890,
	height: 500,
	ok: function(){
		var id = direct_category_cs.get_value();
		$('#form input[id=direct_to_category_id]').val(id);
		//matrix_parent_path(id);
	},
	show: function(){
		direct_category_cs.init();
	}
});

var direct_category_cs = new Recursive_Selector({
	input: $('#directid'),
	dialog: direct_category_dialog,
	sub_property: 'categories',
	url: '{$this_system.siteurl}/category-json',
	value: $('#form input[name=parent]').val(),
	init_callback: function(){
		//matrix_parent_path(this.get_value());
	},
	item_callback: function(cat, item){
		if(cat.type == 1)
			item.find('span').addClass('frame_category');
		
		if(cat.categories)
			item.addClass('sub_category');
	}
});

var matrix_dialog = new P8_Dialog({
	title_text: '选择母站对接栏目',
	button: true,
	width: 890,
	height: 500,
	ok: function(){
		var id = matrix_cs.get_value();
		$('#form input[name=matrix]').val(id);
		matrix_parent_path(id);
	},
	show: function(){
		matrix_cs.init();
	}
});

var matrix_cs = new Recursive_Selector({
	input: $('#parent'),
	dialog: matrix_dialog,
	sub_property: 'categories',
	url: '{$cms_system.controller}/category-json',
	value: $('#form input[name=matrix]').val(),
	init_callback: function(){
		matrix_parent_path(this.get_value());
	},
	item_callback: function(cat, item){
		if(cat.type == 1)
			item.find('span').addClass('frame_category');
		
		if(cat.categories)
			item.addClass('sub_category');
	}
});

function matrix_parent_path(cid){
	if(cid == 0){
		$('#matrix_cid').html('');
		return;
	}
	
	var tmp = matrix_cs.get_by_id(cid);
	var html = '';
	
	while(true){
		html = tmp.name +' &gt; '+ html;
		if(tmp.parent == 0) break;
		
		tmp = matrix_cs.get_by_id(tmp.parent);
	}
	
	$('#matrix_cid').html(html);
}


function showoutlink(obj,type){	
	f = $(obj).val() ? $(obj).val() : type;
	
	if(f=='3'){
		$('#category_outlink').show(); $('#category_model').hide();
		$('#all_model').hide();
		$('#form *[name="model"]').rules('remove', {
			required: true,
			messages: { required: '{$P8LANG['sites_category_model_can_not_be_empty']}'}
		});
	}else{
		$('#category_outlink').hide(); $('#category_model').show();
		$('#form *[name="model"]').rules('add', {
			required: true,
			messages: { required: '{$P8LANG['sites_category_model_can_not_be_empty']}'}
		});
		if(f=='2')
			$('#all_model').hide();
		else
			$('#all_model').show();
	}
}

var list_template_dialog = new P8_Dialog({
	title_text: '{$P8LANG['select_template']}',
	button: true,
	width: 700,
	height: 500,
	zIndex: 20003,
	ok: function(){
		$('#lt').val(list_template_selector.value);
	},
	show: function(){
		list_template_selector.init();
	}
});
var list_template_selector = new Template_Selector({
	base_dir: '{$this_system.name}/{$this_system.site['template']}/{$this_system.name}/item/',
	selected: $('#lt').val(),
	template_dir: '{$core.CONFIG['template_dir']}',
	dialog: list_template_dialog
});

var view_template_dialog = new P8_Dialog({
	title_text: '{$P8LANG['select_template']}',
	button: true,
	width: 700,
	height: 500,
	zIndex: 20003,
	ok: function(){
		$('#vt').val(view_template_selector.value);
	},
	show: function(){
		view_template_selector.init();
	}
});
var view_template_selector = new Template_Selector({
	base_dir: '{$this_system.name}/{$this_system.site['template']}/{$this_system.name}/item/',
	selected: $('#vt').val(),
	template_dir: '{$core.CONFIG['template_dir']}',
	dialog: view_template_dialog
});

var item_template_dialog = new P8_Dialog({
	base_dir: 'label/',
	title_text: '{$P8LANG['select_template']}',
	button: true,
	width: 700,
	height: 500,
	zIndex: 20003,
	ok: function(){
		$('#it').val(item_template_selector.value);
	},
	show: function(){
		item_template_selector.init();
	}
});
var item_template_selector = new Template_Selector({
	base_dir: 'label/',
	selected: $('#it').val(),
	template_dir: '{$core.CONFIG['template_dir']}',
	dialog: item_template_dialog
});

//-----------

var list_template_dialog_mobile = new P8_Dialog({
	title_text: '{$P8LANG['select_template']}',
	button: true,
	width: 700,
	height: 500,
	zIndex: 20003,
	ok: function(){
		$('#ltm').val(list_template_selector_mobile.value);
	},
	show: function(){
		list_template_selector_mobile.init();
	}
});
var list_template_selector_mobile = new Template_Selector({
	base_dir: '{$this_system.name}/{$this_system.site['template']}/{$this_system.name}/item/',
	selected: $('#ltm').val(),
	dialog: list_template_dialog_mobile
});

var view_template_dialog_mobile = new P8_Dialog({
	title_text: '{$P8LANG['select_template']}',
	button: true,
	width: 700,
	height: 500,
	zIndex: 20003,
	ok: function(){
		$('#vtm').val(view_template_selector_mobile.value);
	},
	show: function(){
		view_template_selector_mobile.init();
	}
});
var view_template_selector_mobile = new Template_Selector({
	base_dir: '{$this_system.name}/{$this_system.site['template']}/{$this_system.name}/item/',
	selected: $('#vtm').val(),
	dialog: view_template_dialog_mobile
});

var item_template_dialog_mobile = new P8_Dialog({
	title_text: '{$P8LANG['select_template']}',
	button: true,
	width: 700,
	height: 500,
	zIndex: 20003,
	ok: function(){
		$('#itm').val(item_template_selector_mobile.value);
	},
	show: function(){
		item_template_selector_mobile.init();
	}
});
var item_template_selector_mobile = new Template_Selector({
	base_dir: 'label/',
	selected: $('#itm').val(),
	template_dir: '{$core.CONFIG['template_dir']}',
	dialog: item_template_dialog_mobile
});

//----------
function get_auto_label_postfix(obj){
	$.get('{$this_router}-auto_label_postfix',function(result){ $(obj).prev().val('category_'+result); $(obj).next().val(1) });
}
$(function() {
	$("#tabs").tabs();
	
	showoutlink(null,'{$data['type']}');
	
	cs.init();
	matrix_cs.init();
});

</script>
<!--{template $this_system footer admin}-->
<!--{/php168}-->