<!--{php168}-->

<div id="attributes">
<div class="fleft">
<form id="att_form" method="post" action="$this_router-attribute" target="attr_poster">
	<label style="color:#024f96;">请选择所需属性：</label>
	<!--{if !empty($allow_attribute)}-->
	<!--{foreach $this_module->attributes $aid $v}-->
		<!--{if ($aid < 9 || $aid >13) && !$this_module->CONFIG['attributes_show'][$aid]}--><input type="checkbox" name="attribute[$aid]" id="attribute[$aid]" value="$aid" /><label for="attribute[$aid]">{if $this_module->CONFIG['attributes'][$aid]}{$this_module->CONFIG['attributes'][$aid]}{else}{$P8LANG['sites_item']['attribute'][$aid]}{/if}</label><!--{/if}-->
	<!--{/foreach}-->
	&nbsp;
	<input type="button" value="{$P8LANG['sites_item']['set_attribute']}" onclick="set_attribute()" class="setbtn" />
	<input type="button" value="{$P8LANG['sites_item']['delete_attribute']}" onclick="delete_attribute()" class="delbtn" />
	<!--{/if}-->
	<div id="attr_ids"></div>
	<input type="hidden" name="act" />
</form>
</div>
</div>

<iframe name="attr_poster" style="display: none;"></iframe>

<script type="text/javascript">
	function set_attribute(){
		//no item or attribute selected
		var ids = collect_attribute_ids();
		if(!ids.length || !$('#attributes input[type=checkbox][id^=attribute]:checked').length){
			p8_window.alert('{$P8LANG[sites_item_select]}');
			return;
		}
		//if(!confirm('$P8LANG[confirm_to_do]')) return;
		p8_window.confirm('{$P8LANG['confirm_to_do']}', function (r) {
			if(r){
				ajaxing({});
				$('#att_form input[name=act]').val('set');
				$('#att_form').get(0).submit();
			}else{
				return;
			}
		});		
	}
	
	function delete_attribute(){
		//no item or attribute selected
		var ids = collect_attribute_ids();
		if(!ids.length || !$('#attributes input[type=checkbox][id^=attribute]:checked').length){
			p8_window.alert('{$P8LANG[sites_item_select]}');
			return;
		}
		
		//if(!confirm('$P8LANG[confirm_to_delete]')) return;
		p8_window.confirm('{$P8LANG['confirm_to_delete']}', function (r) {
			if(r){
				ajaxing({});
				$('#att_form input[name=act]').val('delete');
				$('#att_form').get(0).submit();
			}else{
				return;
			}
		});		
	}
	
	function collect_attribute_ids(){
		var ids = $('#form input[type=checkbox]:checked');
		$('#attr_ids').empty();
		ids.each(function(){
			$('<input type="hidden" name="id[]" />').val(this.value).appendTo($('#attr_ids'));
		});
		
		return ids;
	}
	
</script>
<!--{/php168}-->