<!--{php168}-->
<!--{template $this_system header admin}-->
<style type="text/css">
.manager_ids li{float:left; display:inline-block; margin-right:30px}
.delete_link{color:red; cursor:pointer}
.role_span{margin-right:30px;float:left; display:inline-block; width:100px; margin-bottom:10px}
</style>
<script type="text/javascript" src="{$RESOURCE}/js/upload.js"></script>
<style type="text/css">
body, html{overflow:inherit;}
</style>
<div class="section">
	<table class="formtable" width="100%">
		<tr>
			<td class="headerbtn_list">
				<ul class="sites-top-menu">
					<li><a href="{$this_system.admin_controller}/farm-list"><i class="fa fa-cog"></i>站点列表</a></li>
					<li><a href="{$this_system.admin_controller}-index?frame=/sites/farm-add"><i class="fa fa-cog"></i>本站点设置</a></li>
					<li><a href="{$this_system.admin_controller}/category-list"><i class="fa fa-cog"></i>栏目管理</a></li>
					<li><a href="{$this_system.admin_controller}/farm-menu_list"><i class="fa fa-cog"></i>菜单管理</a></li>
					<li><a href="{$this_system.admin_controller}-Visualization"><i class="fa fa-refresh"></i>页面可视化</a></li>
					<li><a href="{$this_system.admin_controller}-publishing"><i class="fa fa-refresh"></i>站点发布</a></li>
					<li style="float:right;background:#367fc1;border-radius:4px;height:30px;line-height:30px;"><a href="{if empty($site_info['ipordomain'])}{$core->CONFIG['url']}/s.php/{$site}{else}{$site_info['domain']}{/if}" style="color:#fff;border:none;box-shadow:none;height:30px;line-height:30px;" target="_blank"><i class="fa fa-map-marker"></i>当前站点：{$site_info['sitename']}</a></li>				
				</ul>
			</td>
		</tr>
	</table>
</div>
<form action="$this_url" method="post" id="form">
	<div class="mainbox mainborder">
		<div class="section">
			<table width="100%" cellspacing="0" cellpadding="0" class="zq_list hover_table">
				<tr class="title fix_head">
					<td width="15%"  class="list_top">{$P8LANG['config']}</td > <td width="45%" class="list_top">参数</td><td width="40%" class="list_top">备注<div class="course pull-right"><a href="{$RESOURCE}/attachment/jiaocheng/zizhanquanxain.pdf" target="_blank" style="color:#c00;"><img src="{$RESOURCE}/skin/admin/help_icon.gif" class="helpicon" style="margin-right:5px;">子站权限设置教程>></a></div></td>
				</tr>
				<!--{if $manager}-->
				<!--{if $admin}-->
				<tr>
					<td class="tdL">独立设置审核权限</td>
					<td class="tdR">
						<input type="radio" name="independent_verify" value="1"{if !empty($site_info['config']['independent_verify'])} checked{/if} />启用
						<input type="radio" name="independent_verify" value="0"{if empty($site_info['config']['independent_verify'])} checked{/if} />关闭(只要是管理员就有审核权限)
					</td>
					<td class="tdR">默认“管理员”拥有分站管理的所有权限，如设置为“启用”，则需要给管理员的角色组或个人额外设置“审核”权限才拥有审核权限</td>
				</tr>
				<!--{if $IS_FOUNDER || $site_info['parent']}-->
				<tr>
					<td class="tdL">管理员</td>
					<td class="tdR">
					
					<ul id="manager" class="manager_ids">
					<!--{foreach $managers $user}-->
					<li>{$user['username']}{if $user['name']} | {$user['name']}{/if}<input type="hidden" name="manager[]" value="{$user['id']}"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>
					<!--{/foreach}-->
					</ul><input type="button" value="选择管理员" onclick="show_dialog('manager')"/></td>
					<td class="tdR">能管理此站点的用户，所选之人需在会员管理内勾上"管理员"，让此人可登录后台。</td>
				</tr>
				<!--{/if}-->
				<tr>
					<td class="tdL">内容审核员</td>
					<td class="tdR"><a href="{$core.admin_controller}/core/member-list" target="_blank">设置栏目管理权限>></a></td>
					<td class="tdR">点击设置后，搜索到对应账号然后点击设置分站权限</td>
				</tr>
				<tr>
					<td class="tdL">投稿角色</td>
					<td class="tdR"> 
					<ul class="manager_ids" id="role_list">
					 <!--{foreach $manager_roles $rid}-->
					 <!--{if $rid}-->
					<li>{$roles[$rid]['name']}<input type="hidden" name="role[]" value="{$rid}"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>
					<!--{/if}-->
					<!--{/foreach}-->
					</ul><input type="button" value="选择角色" onclick="dialog_role.show()"/>
					</td>
					<td class="tdR">这些被设置的角色下的用户，都具备本站的投稿权限。 <font color="red">此处一般不做选择</font></td>
				</tr>
				<!--{/if}-->
				<tr>
					<td class="tdL">投稿人</td>
					<td class="tdR"> 
					 <ul id="poster" class="manager_ids">
					<!--{foreach $poster $user}-->
					<li>{$user['username']}{if $user['name']} | {$user['name']}{/if}<input type="hidden" name="poster[]" value="{$user['id']}"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>
					<!--{/foreach}-->
					</ul><input type="button" value="选择投稿人" onclick="show_dialog('poster')"/></td>
					</td>
					<td class="tdR">允许投稿的人</td>
				</tr>
				<!--{/if}-->
				<tr>
					<td colspan="3" class="text-center"><input type="submit" value=" {$P8LANG['submit']} " class="submit_btn"/></td>
				</tr>
			</table>
			<input type="hidden" name="alias" value="{if !empty($alias)}$alias{/if}" />
		</div>
	</div>
</form>

<script type="text/javascript">
var role_json = $role_json;
var dialog_role = new P8_Dialog({
	title_text:'选择角色组',
	width: 550,
	height: 330,
	button: true,
	show: function(){
		
		var check_roles = {};
		$('#role_list').find('input').each( function(){ check_roles[$(this).val()]=$(this).val(); } );
		
		var shtml = '';
		for(var i in role_json){
			shtml+= '<span class="role_span" style="display:inline-block;margin:4px 6px;"><input type="checkbox" name="role[]" value="'+role_json[i].id+'" '+(check_roles[role_json[i].id]?'checked':'')+'/>'+role_json[i].name+'</span>';
		}
		dialog_role.content.html(shtml);
		
	},
	ok: function(){
		$('#role_list').html('');
		dialog_role.content.find('input:checked').each(function(){
				j = $(this).val();
				$('#role_list').append('<li>'+role_json[j].name+'<input type="hidden" name="role[]" value="'+j+'"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>');
		});
														
	}
});

function delete_manager(obj){
$(obj).parent().remove();	
}
var cutten_item = null;
function member_single_select_callback(checked, json){
	var u_name = '';
	$('#'+cutten_item).find("input[value="+json.id+"]").parent().remove();
	if(checked){
		if (json.name && json.name != 'undefined') u_name = json.name;
		$('#'+cutten_item).append('<li>'+json.username + (u_name ? ' | '+u_name :'')+'<input type="hidden" name="'+cutten_item+'[]" value="'+json.id+'"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>');
	}
}



function show_dialog(item){	
	var dialog = new P8_Dialog({
		title_text:'选择管理员',
		width: 700,
		height: 500,
		button: true
	});
	dialog.content.append($('<iframe width="100%" height="380" frameborder="0" border="0" marginwidth="0" marginheight="0"></iframe>'));
	dialog.show();
	cutten_item = item;
	var ifr = dialog.content.find('iframe');
	var check_uids = {};
	$('#'+cutten_item).find('input').each( function(){ check_uids[$(this).val()]=$(this).val(); } );
	ifr.attr('src', '{$core.U_controller}/core/member-selectuser?'+ajax_parameters({'checked_ids': check_uids}));
}
</script>

<!--{template $this_system footer admin}-->
<!--{/php168}-->