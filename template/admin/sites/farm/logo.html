<!--{php168}-->
<!--{template $this_system header admin}-->
<script type="text/javascript" src="{$RESOURCE}/js/upload.js"></script>
<style type="text/css">
body, html{overflow:inherit;}
</style>
<div class="section">
	<table class="formtable" width="100%">
		<tr>
			<td class="headerbtn_list">
				<ul class="sites-top-menu">
				
					<li><a href="{$this_system.admin_controller}/farm-list"><i class="fa fa-cog"></i>站点列表</a></li>
					<li><a href="{$this_system.admin_controller}/farm-config"><i class="fa fa-cog"></i>本站点设置</a></li>
					<li><a href="{$this_system.admin_controller}/category-list"><i class="fa fa-cog"></i>栏目管理</a></li>
					<li><a href="{$this_system.admin_controller}/farm-menu_list"><i class="fa fa-cog"></i>菜单管理</a></li>
					<li><a href="{$this_system.admin_controller}/farm-logo"><i class="fa fa-ravelry"></i>站点LOGO</a></li>
					<li><a href="{$this_system.admin_controller}/farm-acls"><i class="fa fa-user-circle-o"></i>站点授权</a></li>
					<li><a href="{$this_system.admin_controller}/farm-template"><i class="fa fa-tree"></i>站点模板</a></li>
					<li><a href="{$this_system.admin_controller}-Visualization" target="_blank"><i class="fa fa-refresh"></i>页面可视化</a></li>
					<li><a href="{$this_system.admin_controller}-publishing" target="_blank"><i class="fa fa-refresh"></i>站点发布</a></li>
					<li style="float:right;background:#367fc1;border-radius:4px;height:30px;line-height:30px;"><a href="{if empty($site_info['ipordomain'])}{$core->CONFIG['url']}/s.php/{$site}{else}{$site_info['domain']}{/if}" style="color:#fff;border:none;box-shadow:none;height:30px;line-height:30px;" target="_blank"><i class="fa fa-map-marker"></i>当前站点：{$site_info['sitename']}</a></li>
				</ul>
			</td>
		</tr>
	</table>
</div>
<div class="section">
	<form action="$this_router-cache" method="post" id="form">
		<table width="100%" border="0" class="mainbox">
			<tbody>
			<tr>
				<td>
					<ul class="sites-down-menu">
						<li class="btn-color1"><a href="{$this_system.admin_controller}/farm-add"><i class="icon icon-ico10"></i>站点基本设置</a></li>
						<li class="btn-color2"><a href="{$this_system.admin_controller}/farm-logo"><i class="icon icon-ico11"></i>站点logo管理</a></li>
						<li class="btn-color4"><a href="{$this_system.admin_controller}/farm-acls"><i class="icon icon-ico12"></i>站点授权</a></li>
						<li class="btn-color3"><a href="{$this_system.admin_controller}/farm-template"><i class="icon icon-ico11"></i>站点模板</a></li>
						<li class="btn-color9"><a href="{$this_system.admin_controller}/farm-add" target="_blank"><i class="icon icon-ico44"></i>新增站点</a></li>
						<li class="course pull-right"><a href="{$RESOURCE}/attachment/jiaocheng/zhandianlogo.pdf" target="_blank" style="color:#c00;"><img src="{$RESOURCE}/skin/admin/help_icon.gif" class="helpicon"> 站点logo管理教程>></a></li>
					</ul>
				</td>
			</tr>
			</tbody>
		</table>
		<table width="100%" cellspacing="0" cellpadding="0" class="zq_list hover_table" align="center">
			<tr class="title">
				<td width="3%" align="center" class="list_top title"><input type="checkbox" name="cl" onclick="check_all(this, 'id[]', $('#form'));init_tr($('#form'));" /></td>
				<td width="9%" class="list_top list_left">【站点】名称</td>
				<td width="6%" class="list_top">【站点】别名</td>
				<td width="20%" class="list_top">【站点】域名</td>
				<td width="2%" class="list_top">状态</td>
				<td width="*" class="list_top">{$P8LANG['logo']}</td>
				<td width="30%" align="center" class="list_top">操作</td>
			</tr>
			<!--{foreach $list $value}-->
			<tr id="sites_{$value['alias']}">
				<td class="list_title" align="center"><input type="checkbox" name="id[]" value="{$value['alias']}" /></td>
				<td class="list_left list_ico">{$value['sitename']} {if $value['authentication_mark']} <i class="fa fa-flag-checkered" style="color:green;font-size:20px;"></i>{/if}</td>
				<td class="list_title"><strong>{$value['alias']}</strong></td>
				<td class="list_title"><a href="{if empty($value['ipordomain'])}{$core->CONFIG['url']}/s.php/{$value['alias']}/{else}{$value['domain']}{/if}" target="_blank">
				<!--{if empty($value['ipordomain'])}-->
				{$core->CONFIG['url']}/s.php/{$value['alias']}/
				<!--{else}-->
				{$value['domain']}
				<!--{/if}-->
				</a>
				</td>
				<td id="sites_{$value['alias']}"><img src="$_SKIN/status_{$value['status']}.gif" /></td>
				<td>
					{$P8LANG['logo']} 
					<input type="text" class="txt" id="logo_img_{$value['id']}" name="logo[{$value['alias']}]" value="{$value['logo']}" size="28"  />
					<input type="button" onclick="imgupload_{$value['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_{$value['id']} = new P8_Upload({
							element: {
								src: $('#logo_img_{$value['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
					<br/>
					{$P8LANG['logo_motto']} 
					<input type="text" class="txt" id="logo_motto_img_{$value['id']}" name="logo_motto[{$value['alias']}]" value="{$value['logo_motto']}" size="28"  />
					<input type="button" onclick="imgupload_logo_motto_{$value['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_logo_motto_{$value['id']} = new P8_Upload({
							element: {
								src: $('#logo_motto_img_{$value['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
					
					<br/>
					{$P8LANG['logo_header']} 
					<input type="text" class="txt" id="logo_header_img_{$value['id']}" name="logo_header[{$value['alias']}]" value="{$value['logo_header']}" size="28"  />
					<input type="button" onclick="imgupload_logo_header_{$value['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_logo_header_{$value['id']} = new P8_Upload({
							element: {
								src: $('#logo_header_img_{$value['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
					<br/>
					{$P8LANG['logo_footer']} 
					<input type="text" class="txt" id="logo_footer_img_{$value['id']}" name="logo_footer[{$value['alias']}]" value="{$value['logo_footer']}" size="28"  />
					<input type="button" onclick="imgupload_logo_footer_{$value['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_logo_footer_{$value['id']} = new P8_Upload({
							element: {
								src: $('#logo_footer_img_{$value['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
				</td>
				<td align="center" class="list_btn">
					<ul class="operation-nav">
						<li><!--{if $site_edit or in_array($value['alias'],$mysites)}--><a href="$this_router-update?alias={$value['alias']}" target="_blank" class="btn-color3"><span id="edit_{$value['alias']}">{$P8LANG['edit']}</span></a> <!--{/if}--></li>
						<li><a href="javascript:;" onclick="cache_all('{$value['alias']}')" class="btn-color12">缓存</a></li>
						<li><a href="javascript:;" onclick="html_index('{$value[alias]}');" class="btn-color10">静态首页</a></li>
						<li><a href="javascript:;" onclick="show_edit_label('{$value[alias]}');" class="btn-color11"><span id="sites_{$value[alias]}">可视化</span></a></li>
						<li><a href="{$this_module.admin_controller}-menu_list?site={$value[alias]}" target="_blank" class="btn-color2"><span id="sites_{$value[alias]}">菜单管理</span></a></li>
						<li><a href="{$this_system.admin_controller}/category-list?site={$value[alias]}" target="_blank" class="btn-color3"><span id="sites_{$value[alias]}">栏目管理</span></a></li>
						<li><a href="{$this_system.admin_controller}/item-list?site={$value[alias]}" target="_blank" class="btn-color1"><span id="sites_{$value[alias]}">内容管理</span></a></li>
						<li><a href="{$this_system.admin_controller}/item-add?site={$value[alias]}" target="_blank" class="btn-color9"><span id="sites_{$value[alias]}">发布内容</span></a></li>						
						<li class="dropdown">
							<a class="btn-color1">查看</a>
							<ul class="dropdown-menu">
								<li><a href="{if empty($value['ipordomain'])}{$core->CONFIG['url']}/s.php/{$value['alias']}/{else}{$value['domain']}{/if}" target="_blank" class="btn-color2"><i class="icon icon-ico55"></i><span id="site_s_{$value['alias']}">动态访问</span></a> </li>
								<li><a href="{$core->CONFIG['url']}/sites/html/{$value['alias']}" target="_blank" class="btn-color1"><i class="icon icon-ico55"></i><span id="site_shtml_{$value['alias']}">静态访问</span></a></li>								
							</ul>
						</li>
					</ul>
				</td>
			</tr>
			<!--{if $value['child']}-->
			<!--{php $last_key = end(array_keys($value['child']));}-->
			<!--{foreach $value['child'] $k=>$cvalue}-->
			<tr id="sites_{$cvalue['alias']}">
				<td class="list_title" align="center"><input type="checkbox" name="id[]" value="{$cvalue['alias']}" /></td>
				<td class="list_left">{if $last_key==$k}│&nbsp;└{else}│&nbsp;├{/if} {$cvalue['sitename']} {if $cvalue['authentication_mark']} <i class="fa fa-flag-checkered" style="color:green;font-size:20px;"></i>{/if}</td>
				<td class="list_title"><strong>{$cvalue['alias']}</strong><a href="{$this_system.admin_controller}/item-add?site={$cvalue[alias]}" class="btn3" target="main">+发布</a></td>
				<td class="list_title"><a href="{if empty($cvalue['ipordomain'])}{$core->CONFIG['url']}/s.php/{$cvalue['alias']}/{else}{$cvalue['domain']}{/if}" target="_blank">
					<!--{if empty($cvalue['ipordomain'])}-->
					{$core->CONFIG['url']}/s.php/{$cvalue['alias']}/
					<!--{else}-->
					{$cvalue['domain']}
					<!--{/if}-->					
				</a>
				</td>
				<td id="sites_{$cvalue['alias']}"><img src="$_SKIN/status_{$cvalue['status']}.gif" /></td>
				<td>
					{$P8LANG['logo']} 
					<input type="text" class="txt" id="logo_img_{$cvalue['id']}" name="logo[{$cvalue['alias']}]" value="{$cvalue['logo']}" size="28"  />
					<input type="button" onclick="imgupload_{$cvalue['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_{$cvalue['id']} = new P8_Upload({
							element: {
								src: $('#logo_img_{$cvalue['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
					<br/>
					{$P8LANG['logo_motto']} 
					<input type="text" class="txt" id="logo_motto_img_{$cvalue['id']}" name="logo_motto[{$cvalue['alias']}]" value="{$cvalue['logo_motto']}" size="28"  />
					<input type="button" onclick="imgupload_logo_motto_{$cvalue['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_logo_motto_{$cvalue['id']} = new P8_Upload({
							element: {
								src: $('#logo_motto_img_{$cvalue['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
					
					<br/>
					{$P8LANG['logo_header']} 
					<input type="text" class="txt" id="logo_header_img_{$cvalue['id']}" name="logo_header[{$cvalue['alias']}]" value="{$cvalue['logo_header']}" size="28"  />
					<input type="button" onclick="imgupload_logo_header_{$cvalue['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_logo_header_{$cvalue['id']} = new P8_Upload({
							element: {
								src: $('#logo_header_img_{$cvalue['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
					<br/>
					{$P8LANG['logo_footer']} 
					<input type="text" class="txt" id="logo_footer_img_{$cvalue['id']}" name="logo_footer[{$cvalue['alias']}]" value="{$cvalue['logo_footer']}" size="28"  />
					<input type="button" onclick="imgupload_logo_footer_{$cvalue['id']}.choseup()" value="{$P8LANG['upload']}" class="u" />
					<script>
						var imgupload_logo_footer_{$cvalue['id']} = new P8_Upload({
							element: {
								src: $('#logo_footer_img_{$cvalue['id']}'),
								attribute: 'value'
							},
							param: {
								filter: {
									gif: 1024000,
									jpg: 1024000,
									jpeg: 1024000,
									png: 1024000,
									bmp: 1024000
								}
							}
						});
					</script>
				</td>
				<td align="center" class="list_btn">
					<ul class="operation-nav">
						<li><!--{if $site_edit or in_array($cvalue['alias'],$mysites)}--><a href="$this_router-update?alias={$cvalue['alias']}" target="_blank" class="btn-color3"><span id="edit_{$cvalue['alias']}">{$P8LANG['edit']}</span></a> <!--{/if}--></li>
						<li><a href="javascript:;" onclick="cache_all('{$cvalue['alias']}')" class="btn-color12">缓存</a></li>
						<li><a href="javascript:;" onclick="html_index('{$cvalue[alias]}');" class="btn-color10">静态首页</a></li>
						<li><a href="javascript:;" onclick="show_edit_label('{$cvalue[alias]}');" class="btn-color11"><span id="sites_{$cvalue[alias]}">可视化</span></a></li>						
						<li class="dropdown">
							<a class="btn-color1">查看</a>
							<ul class="dropdown-menu">
								<li><a href="{$core->CONFIG['url']}/sites/html/{$value['alias']}" target="_blank" class="btn-color1"><i class="icon icon-ico55"></i><span id="site_shtml_{$value['alias']}">静态访问</span></a></li>
								<li><a href="{if empty($value['ipordomain'])}{$core->CONFIG['url']}/s.php/{$value['alias']}/{else}{$value['domain']}{/if}" target="_blank" class="btn-color2"><i class="icon icon-ico55"></i><span id="site_s_{$value['alias']}">动态访问</span></a> </li>
							</ul>
						</li>
					</ul>
				</td>
			</tr>
			<!--{/foreach}-->
			<!--{/if}-->
			<!--{/foreach}-->
		</table>
		<br/>
		<a name="op"></a>
		<a href="javascript:void(0)" onclick="check_all(true, 'id[]');init_tr($('#form'));">全选</a> /
		<a href="javascript:void(0)" onclick="check_all(false, 'id[]');init_tr($('#form'));">全不选</a>
		<input type="button" class="button" value=" 提交logo更新 " onclick="this.form.action='$this_url';this.form.submit();"/>
		<input type="button" class="button" value=" 提交静态首页 " onclick="sites_html_index(checked_values('id[]', $('#form')))"/>
		<input type="button" class="button" value=" 更新站群缓存 " name="cache" onclick="cache_base_sites()" class="edit_btn"  />
	</form>
	<form id="indexhtml" action="" target="_blank"></form>
</div>
<script type="text/javascript">
var url = window.location.href;
index = url.indexOf("flag");
if(index !=-1) html_index();
function show_edit_label(){
	thisSite = $('#this_site').val();
	if(!thisSite)return false;
	url = '{$core->url}/s.php/'+thisSite+'/main?edit_label=1';
	window.open(url);
}
function site_reflash(site){
	//更新标签缓存  更新魔板缓存   静态首页   静态最近10天的内容
	var cache_data = ['template','label'];
	$.ajax({
		url: '{$this_system.admin_controller}/farm-cacheall',
		type: 'POST',
		dataType: 'json',
		data: {cache:cache_data,site:site},
		beforeSend: function(){
			ajaxing({'text':'更新中…'});
		},
		success: function(){
			ajaxing({action: 'hide'});
			//静态首页
			html_index();
			//静态最近10天的内容
			view_to_html(10);
			html_dialog.hide();
			p8_window.alert('操作成功');
		}
	});	
}
function cache_site(site){
	var cache_data = ['farm','template','label','manu','model','category','menu_custom'];
	$.ajax({
		url: '{$this_system.admin_controller}/farm-cacheall',
		type: 'POST',
		dataType: 'json',
		data: {cache:cache_data,site:site},
		beforeSend: function(){
			ajaxing({'text':'处理中…'});
		},
		success: function(){
			ajaxing({action: 'hide'});
			p8_window.alert('操作成功');
		}
	});
}
var html_dialog = new P8_Dialog({
	width: 700,
	height: 500,
	overlay: false,
	cancel: function(){
		this.content.find('iframe').attr('src', 'about:blank');
	}
});
html_dialog.content.append($('#status'));
function label_view(ids){
	if(Array.isArray(ids)){
		if(ids.length<1) {
			p8_window.alert('{$P8LANG[sites_site_select]}');
			return;
		}
	}
	for(var i in ids){
		show_edit_label(ids[i]);
	}
}
function show_edit_label(thisSite){
	if(!thisSite)return false;
	url = '{$core->url}/s.php/'+thisSite+'/main?edit_label=1';
	window.open(url);
}
function sites_acl(ids){
	if(Array.isArray(ids)){
		if(ids.length<1) {
			p8_window.alert('{$P8LANG[sites_site_select]}');
			return;
		}
	}
	for(var i in ids){
		$('#acl_'+ids[i]).click();
	}
}
function sites_domain(ids){
	if(Array.isArray(ids)){
		if(ids.length<1) {
			p8_window.alert('{$P8LANG[sites_site_select]}');
			return;
		}
	}
	for(var i in ids){
		$('#site_s_'+ids[i]).click();
	}
}
function sites_shtml_domain(ids){
	if(Array.isArray(ids)){
		if(ids.length<1) {
			p8_window.alert('{$P8LANG[sites_site_select]}');
			return;
		}
	}
	for(var i in ids){
		$('#site_shtml_'+ids[i]).click();
	}
}
function sites_update(ids){
	if(Array.isArray(ids)){
		if(ids.length<1) {
			p8_window.alert('{$P8LANG[sites_site_select]}');
			return;
		}
	}
	for(var i in ids){
		$('#edit_'+ids[i]).click();
	}
}

function sites_html_index(ids){
	if(Array.isArray(ids)){
		if(ids.length<1) {
			p8_window.alert('{$P8LANG[sites_site_select]}');
			return;
		}
	}
	$("#form").attr("action", "{$this_system.admin_controller}-index_to_html");
	$('#form').submit();
}

function html_index(thisSite){
	if(!thisSite)return false;
	$.ajax({
		   url:'{$this_system.admin_controller}-index_to_html',
		   type: 'post',
		   dataType: 'json',
		   data: ajax_parameters({site:thisSite}),
		   cache: false,
		   success: function(msg){
			   if(msg==-1){
			   		p8_window.alert('此站没有绑定域名，不可静态');
				}else if(msg==-2){
					p8_window.alert('静态首页锁定中，请10秒后操作！');
				}else{
					p8_window.alert('静态成功！');
					window.open(msg);
				}
		   }
	})	
}


var cache_dialog =  new P8_Dialog({
	title_text:'选择缓存项目',
	width: 246,
	height: 260,
	button: true,
	ok:function(){
		if(!$('#cache_form').find('input:checked').length)return;
		ajaxing({});
		$.ajax({
			url: '{$this_router}-cacheall',
			type: 'POST',
			dataType: 'json',
			data: $('#cache_form').serialize(),
			success: function(){
				ajaxing({action: 'hide'});
				p8_window.alert('操作成功');
			}
		})
	}
});

function cache_all(site){
	cache_dialog.content.html('<form id="cache_form"><input type="hidden" name="site" value="'+site+'"/>\
	<input type="checkbox" onchange="change_cache()" checked="checked" id="check_all_cache"/>全选<br/>\
	<input type="checkbox" name="cache[]" checked="checked" value="farm"/>站点信息<br/>\
	<input type="checkbox" name="cache[]" checked="checked" value="template"/>模板缓存<br/>\
	<input type="checkbox" name="cache[]" checked="checked" value="label"/>标签缓存 <br/>\
	<input type="checkbox" name="cache[]" checked="checked" value="manu"/>导航缓存 <br/>\
	<input type="checkbox" name="cache[]" checked="checked" value="model"/>模型缓存 <br/>\
	<input type="checkbox" name="cache[]" checked="checked" value="category"/>栏目缓存\
	</form>');
	cache_dialog.show();
	
}

function cache_base_sites(){
	p8_window.confirm('{$P8LANG['confirm_to_do']}', function (r) {
		if(r){
			$.ajax({
				url:'{$this_system.admin_controller}/farm-cache',
				type: 'post',
				dataType: 'html',
				data: {},
				cache: false,
				beforeSend: function(){
					ajaxing({text:'缓存中…'});
				},
				success: function(msg){
					ajaxing({text:'操作成功！',action: 'hide'});
				}
			});
		}else{
			return false;
		}
	});	
}
</script>
</body>
</html>
<!--{/php168}-->