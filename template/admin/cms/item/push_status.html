<!--{php168}-->
<!--{template $core header admin}-->
<!--{template $this_system menu_bar admin}-->
	<div class="mainbox mainborder">
		<div class="section">
			<table class="formtable">
				<tr>
					<td class="headerbtn_list">
						<div class="fright">
							<form id="attr_request" method="get" action="$this_router-attribute"{if $ACTION != 'attribute'} target="_blank"{/if}>
							<select name="attribute" onchange="if(this.value) {if $ACTION == 'attribute'}this.form.cid.value = 0;$('#cids').empty();request_item(1);{else}this.form.submit();{/if}">
								<option value="">--文章属性筛选--</option>
								<!--{foreach $this_module->attributes $aid $v}-->
								<!--{if $aid != 9}-->
								<option value="$aid"{if !(empty($attribute)) && $attribute == $aid} selected{/if}>{if $this_module->CONFIG['attributes'][$aid]}{$this_module->CONFIG['attributes'][$aid]}{else}{$P8LANG['cms_item']['attribute'][$aid]}{/if}</option>
								<!--{/if}-->
								<!--{/foreach}-->
							</select>&nbsp;
							<!--{if $ACTION == 'attribute'}-->
							<span id="cids"></span>
							<input type="hidden" name="cid" id="cid" />
							<input type="button" value="按分类筛选" onclick="dialog.show()" />
							<!--{/if}-->
							</form>
						</div>
						<form action="$this_url" method="get" id="request" onsubmit="request_item(1);return false;">
							<div class="screen-title mr20 fleft">
								<span id="cids"></span>
								<input type="button" value="{$P8LANG['cms_item']['filter_by_category']}" class="screenbtn" onclick="category_dialog.show()" />
								<input type="hidden" id="cid" name="cid" value="$cid" />
							</div>
							<div class="screen-tab mr20 fleft">
								<input type="radio" name="verified" value="1" id="verified1"{if $verified == 1} checked{/if} /><label for="verified1">已终审</label>
								<input type="radio" name="verified" value="2" id="verified2"{if $verified == 2} checked{/if} /><label for="verified2">已初审</label>
								<input type="radio" name="verified" value="3" id="verified3"{if $verified == 3} checked{/if} /><label for="verified3">需直接审核</label>
								<input type="radio" name="verified" value="66" id="verified66"{if $verified == 66} checked{/if} /><label for="verified66">{$P8LANG['cms_item']['create_time_release']}</label>
								<input type="radio" name="verified" value="-99" id="verified-99"{if $verified == -99} checked{/if} /><label for="verified-99">{$P8LANG['cms_item']['rejected']}</label>
								<input type="radio" name="verified" value="88" id="verified88"{if $verified == 88} checked{/if} /><label for="verified88">{$P8LANG['cms_item']['recycle']}</label>
								<input type="radio" name="verified" value="0" id="verified0"{if $verified == 0} checked{/if} /><label for="verified0">{$P8LANG['cms_item']['all_unverified']}</label>
								<!--input type="checkbox" name="mine" value="1" id="mine"{if $mine} checked{/if} /><label for="mine">{$P8LANG['cms_item']['my_item']}</label-->
							</div>
							
							<div class="fleft">
								<select name="model" id="model" onchange="MODEL = this.value">
									<option value="">{$P8LANG['cms_model']}</option>
									<!--{foreach $models $name $v}-->
									<option value="$name"{if $MODEL == $name} selected{/if}>$v[alias]</option>
									<!--{/foreach}-->
								</select>
								<select name="order">
									<option value="0" selected="selected">降序</option>
									<option value="1">升序</option>
									<option value="2">权重</option>
								</select>
								<select name="key_type" id="selected_type">
									<option value="keyword">{$P8LANG['cms_item']['search_by_keyword']}</option>
									<option value="id"{if !empty($id)} selected{/if}>{$P8LANG['cms_item']['search_by_id']}</option>
									<option value="username"{if !empty($username)} selected{/if}>按发布人</option>
									<option value="author"{if !empty($author)} selected{/if}>按作者</option>
									<option value="verifier">按审核人</option>
									<option value="source">按来源</option>
									<option value="allitem">按全文</option>
									<option value="regexp_mobile">手机号码</option>
									<option value="regexp_id">身份证号</option>
								</select>
								<input type="text" class="txt" id="cond" size="15" name="key_word" value="$key_word"/>
								<input type="submit" value="{$P8LANG['search']}" class="submit btn-color1"/>
								<input type="button" value="{$P8LANG['refresh']}" class="refreshbtn" onclick="request_item(PAGE)" />
							</div>
						</form>
					</td>
				</tr>
			</table>
		
		
			<!--<table class="formtable">
				<tr>
					<td class="headerbtn_list">
						<form action="$this_url" method="get" id="request">
							<label for="to_site_alias">目标站点:</label>
							<select name="to_site_alias" id="to_site_alias">
								<option value="">不限</option>
								{foreach $allsites $site_tmp}
								<option value="{$site_tmp['alias']}" {if $to_site_alias==$site_tmp['alias']}selected{/if}>{$site_tmp['sitename']}</option>
								{/foreach}	
							</select>						
							<select onchange="$('#cond').attr('name', this.value);">
								<option value="keyword">{$P8LANG['sites_item']['search_by_keyword']}</option>
								<option value="username"{if !empty($username)} selected{/if}>按推送人</option>							
							</select>
							<input type="text" class="txt" id="cond" size="20" {if !empty($keyword)} name="word" value="$keyword"{elseif !empty($id)}name="id" value="{implode(',', $id)}"{elseif !empty($username)}name="username" value="$username"{else} name="word"{/if} />
							<input type="submit" value="{$P8LANG['search']}" class="submit"/>
						</form>						
					</td>
				</tr>
			</table>-->
		</div>
	</div>
	<div class="mainbox mainborder">
		<div class="section">
			<table width="100%" border="0"  class="mainbox">
				<tr>
					<td>
						<ul class="boxmenu">
							<li id="verified_1" class="btn-color1"><a href="$this_url?cid=$cid" class="bm_l"><i class="icon icon-ico1"></i>{$P8LANG['cms_item']['verified']}</a></li>							
							<!--li id="verified_mine"><a class="bm_l" href="###" onclick="$('#mine').prop('checked', true);request_item(1);" href="$this_url?mine=1">{$P8LANG['cms_item']['my_item']}</a></li-->
							<!--{if $allow_verify_first}-->							
							<li id="verified_0" class="btn-color2"><a class="bm_l" href="###" onclick="verified=0;$('#verified0').prop('checked', true);request_item(1);"><i class="icon icon-ico2"></i>{$P8LANG['cms_item']['unverified_first']}</a></li>
							<!--{/if}-->
							<!--{if $allow_verify}-->
							<li id="verified_2" class="btn-color2"><a class="bm_l" href="###" onclick="verified=2;$('#verified2').prop('checked', true);request_item(1);"><i class="icon icon-ico2"></i>{$P8LANG['cms_item']['unverified']}</a></li>
							<!--{/if}-->
							<li id="verified_3" class="btn-color2"><a class="bm_l" href="###" onclick="verified=3;$('#verified3').prop('checked', true);request_item(1);"><i class="icon icon-ico2"></i>需直接审核</a></li>
							<li id="verified_-99" class="btn-color4"><a class="bm_l" href="###" onclick="verified=-99;$('#verified-99').prop('checked', true);request_item(1);"><i class="icon icon-ico3"></i>{$P8LANG['cms_item']['rejected']}</a></li>
							<li id="verified_88" class="btn-color4"><a class="bm_l" href="###" onclick="verified=88;$('#verified88').prop('checked', true);request_item(1);"><i class="icon icon-ico4"></i>{$P8LANG['cms_item']['recycle']}</a></li>
							<li id="verified_66" class="btn-color7"><a class="bm_l" href="###" onclick="verified=66;$('#verified66').prop('checked', true);request_item(1);"><i class="icon icon-ico7"></i>{$P8LANG['cms_item']['create_time_release']}</a></li>

							<li id="my_push" class="btn-color5"><a class="bm_l" href="{$this_router}-push_status"><i class="icon icon-ico5"></i>{$P8LANG['cms_item']['push_status']}</a></li>
							<li id="my_push" class="btn-color6"><a class="bm_l" href="{$this_router}-push_status?sc=c"><i class="icon icon-ico6"></i>{$P8LANG['cms_item']['receive_status']}</a></li>
							<li class="btn-color10"><a href="javascript:;" onclick="update_item(checked_values('id[]', $('#form')))"><i class="icon icon-ico45"></i>编辑内容</a></li>
							<li class="btn-color11"><a href="javascript:;" onclick="recycle_items(checked_values('id[]', $('#form')), verified)"><i class="icon icon-ico46"></i>删除内容</a></li>							
							<li class="btn-color9 dropdown">
								<a class="dropdown-toggle" href="{$core.admin_controller}/$SYSTEM/item-add"><i class="icon icon-ico9"></i>发布内容</a>
								<ul class="dropdown-menu">
									<!--{php $count=1;}-->
									<!--{foreach $this_system->models $model $value}-->
									<!--{if $value['enabled']}-->
									<li class="btn-color{$count}"><a href="{$core.admin_controller}/$SYSTEM/item-add?model={$model}"><i class="icon icon-ico55"></i>{$value[alias]}</a></li>
									<!--{php $count++;}-->
									<!--{/if}-->
									<!--{/foreach}-->
								</ul>
							</li>
						</ul>
					</td>
				</tr>
			</table>
			<form action="" method="post" id="form">
				<table width="100%" class="columntable formtable hover_table click_changeable">				
					<tr class="title fix_head">
						<td width="3%" align="center" class="title"><input type="checkbox" name="cl" onclick="check_all(this, 'id[]', $('#form'));init_tr($('#form'));" /></td>
						<td width="3%" align="center" class="title">ID</td>
						<td width="5%" class="title">分类</td>
						<td width="20%" align="center" class="title">标题</td>
						<td width="10%" align="center" class="title">推送时间</td>
						<td width="10%" align="center" class="title">推送人</td>
						<td width="10%" align="center" class="title">发布人</td>
						<td width="6%" align="center" class="title">推送方向</td>
						<td width="6%" align="center" class="title">{if $sc=="s"}目标{else}来源{/if}站点</td>
						<td width="5%" align="center" class="title">状态</td>						
						<td width="10%" align="center" class="title">操作</td>						
					</tr>				
					<tbody id="list">
					<!--{foreach $list $data}-->
					<tr id="list_{$data['id']}">
					<td align="center"><input type="checkbox" name="id[]" value="{$data['id']}" id="id_{$data['id']}" /></td>
					<td align="center">$data[id]</td>
					<td align="center"><a href="{$this_url}?sc={$sc}&cid={$data['cid']}">$data[cname]>></a></td>
					<td class="al">
					<!--{if $sc=='s'}-->
					<a href="{if $data['link']}{$data['link']}{else}{$this_module.controller}-view-id-{$data['item_id']}{/if}" title="{if $data['status']!=1 && $data['push_back_reason']}原因:{$data[push_back_reason]}{/if}" target="_blank">$data[title]</a>{if $data['status']!=1 && $data['push_back_reason']}<img src="{$SKIN}../fk.gif" title="原因:{$data[push_back_reason]}" style="margin-left: 10px;margin-bottom: -4px;"/>{/if}
					<!--{else}-->
					<a href="{if $data[to_url]}{$data[to_url]}{else}#{/if}" title="{if $data['status']!=1 && $data['push_back_reason']}原因:{$data[push_back_reason]}{/if}" target="_blank">$data[title]</a>{if $data['status']!=1 && $data['push_back_reason']}<img src="{$SKIN}../fk.gif" title="原因:{$data[push_back_reason]}" style="margin-left: 10px;margin-bottom: -4px;"/>{/if}
					<!--{/if}-->
					<td align="center">{date('Y-m-d H:i',$data['timestamp'])}</td>
					<td align="center"><a href="{$this_url}?sc={$sc}&cid={$cid}&username={$data[push_username]}">{$data[push_username]}{if $member_info[$data['push_username16']]['name']} | {$member_info[$data['push_username16']]['name']}{/if}</a></td>
					<td align="center">{$data[username]}{if $member_info[$data['username16']]['name']} | {$member_info[$data['username16']]['name']}{/if}</td>
					<td align="center">{if $sc=="s"}推送给分站{else}推送给总站{/if}</td>
					<td align="center">
						{if $sc=="s"}
							<a href="{$this_url}?sc={$sc}&cid={$cid}&to_site_alias={$data['site_status']}">{$data['to_sites']}>></a>
						{else}
							<a href="{$this_url}?sc={$sc}&cid={$cid}&to_site_alias={$data['site']}">{$data['to_sites']}>>
						{/if}
					</td>
					<td align="center">
						<!--{if $data['status']==-99}-->被退稿<!--{/if}-->			
						<!--{if $data['status']==1}--><span style="color:#000;font-weight:bold;">已接收(终审)</span><!--{/if}-->
						<!--{if $data['status']==2}--><span style="color:#000;font-weight:bold;">已接收(初审)</span><!--{/if}-->			
						<!--{if $data['status']==88}--><span style="color:#000;font-weight:bold;">已接收(回收站)</span><!--{/if}-->
						<!--{if $data['status']==0}--><span style="color:#c00;font-weight:bold;">未接收(待审)</span><!--{/if}-->				
					</td>
					<td align="center" class="list_btn2">
					<!--{if $sc=='s'}-->
					<a href="{if $data['link']}{$data['link']}{else}{$this_module.controller}-view-id-{$data['item_id']}{/if}"  target="_blank">源网址</a> / 
					{if $data['to_url']}<a href="{$data[to_url]}{if $data['status']!=1}?verified=0{/if}"  class="seebtn" target="_blank">推送预览</a> / {/if}
					<a href="{$this_router}-update?model=$data[model]&id={$data['item_id']}&verified=1" target="_blank">修改</a> / 
					<!--{else}-->					
					{if $data['to_url']}<a href="{$data[to_url]}"  class="seebtn" target="_blank">源网址</a> / {/if}
					<a href="{if $data['link']}{$data['link']}{else}{$this_module.controller}-view-id-{$data['new_id']}{if $data['status']!=1}?verified=0{/if}{/if}"  target="_blank">推送预览</a> / 
					<a href="{$core.admin_controller}/sites-index?frame=/sites/item-update?model=$data[model]&id={$data['item_id']}&verified=1&site={$data['site']}" target="_blank">修改</a> /
					<!--{/if}-->
					<a href="{$this_router}-delete_push&id={$data['id']}" id="delete_{$data['id']}" class="debtn" title="此删除只删推送状态，不会删除内容本身" onclick="return delete_item([this.id])">{$P8LANG['delete']}</a>
					</td>
					</tr>
					<!--{/foreach}-->
					</tbody>
				</table>
			</form>
				<table width="100%" class="columntable formtable">
					<tr>
						<td align="center" id="pages" class="pages">$pages</td>
					</tr>
				</table>
				<table width="100%" border="0" cellpadding="0" cellspacing="0" class="foot_btn">
					<tr>
						<td>
							<a name="op"></a>
							<a href="javascript:void(0)" onclick="check_all(true, 'id[]');init_tr($('#form'));">全选</a> /
							<a href="javascript:void(0)" onclick="check_all(false, 'id[]');init_tr($('#form'));">全不选</a>					
							<input type="button" onclick="delete_item(checked_values('id[]', $('#form')))" value=" 删除 " title="此删除只删推送状态，不会删除内容本身" class="edit_btn" />												
							<input type="button" class="edit_btn" value="{$P8LANG['cms_item']['download']}" onclick="$('#download').submit();">
						</td>				
					</tr>
				</table>
		</div>
	</div>
<form action="$this_router-push_download" id="download" method="post">
<input type="hidden" name="sc" value="{$sc}" />
</form>
<script type="text/javascript">
$(".headerbtn_list li:first-child").addClass("active");

function delete_item(obj){
	var id = [];
	$.each(obj, function(k, v){
		id.push(v.replace(/[^0-9]/g, ''));
	});
	if(!id.length) return;
	
	//if(!confirm('$P8LANG[confirm_to_delete]')) return false;
	p8_window.confirm('{$P8LANG['confirm_to_delete']}', function (r) {
		if(r){		
			$.ajax({
				url: '{$this_router}-delete_push',
				type: 'POST',
				cache: false,
				dataType: 'json',
				data: ajax_parameters({action: 'delete', id: id}),
				beforeSend: function(){
					ajaxing({});
				},
				success: function(json){
					ajaxing({action: 'hide'});
					
					for(var i in json){
						$('#delete_'+ json[i]).parent().parent().remove();
					}
					p8_window.alert('操作成功');
				}
			});
			return false;
		}else{
			return;
		}
	});	
}
function request_item(page){
	$.ajax({
		url: '{$this_url}',
		type: 'GET',
		dataType: 'html',
		data: '',
		cache: false,
		success: function(json){
			window.open("{$this_url}?cid={$cid}&sc={$sc}&sc={$sc}&to_site_alias={$to_site_alias}&page="+page+"&word={$keyword}","_self");
		}
	});
}
</script>
<!--{template $core footer admin}-->
<!--{/php168}-->