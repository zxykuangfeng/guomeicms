<!--{php168}-->
<!--{template $core header admin}-->
<!--{template $this_module menu_bar admin}-->
<div class="mainbox mainborder">
		<div class="section">
			  <table width="100%" border="0"  class="mainbox">
				<tr>
					<td>
						<ul class="boxmenu" style="margin:0;">
							<li class="active"><a href="$this_url?type=image" class="bm_l">图片</a></li>
							<li><a href="$this_url?type=voice" class="bm_l">语音</a></li>
							<li><a href="$this_url?type=video" class="bm_l">视频</a></li>
							<li style="float:right;color:#fff;width:auto;background:none;padding-right:10px;font-weight:600;">
								<a href="$this_router-addmaterial?type={$type}" class="edit_btn" style="color:#fff;padding-top:2px;padding-bottom:2px;"> + 新增素材</a></li>
						</ul>
					</td>				
				</tr>
			</table>
			<table width="100%" class="columntable formtable hover_table click_changeable">				
				<tr class="title fix_head">
				  <td width="10%" align="center" class="title">素材id</td>
				  <td width="10%" align="center" class="title">文件名</td>
				  <td width="10%" align="center" class="title">上传时间</td>
				  <td width="10%" align="center" class="title">url</td>
				  <td width="10%" align="center" class="title">操作</td>
				</tr>
				</thead>
				<tbody id="list">
				</tbody>
				<tfoot>
				</tfoot>
			  </table>
	</div>
</div>
<script type="text/javascript">
$(document).ready(function(){
	$(".boxmenu li").each(function (index) {
		$(this).click(function(){
			$('.boxmenu li').removeClass('active');
			$(this).addClass('active');
		});
	});
});
</script>
{if $type=='voice'}
<script type="text/javascript">
	$('.boxmenu li').removeClass('active');
	$(".boxmenu li:nth-child(2)").addClass("active");
</script>
{/if}
{if $type=='video'}
<script type="text/javascript">
	$('.boxmenu li').removeClass('active');
	$(".boxmenu li:nth-child(3)").addClass("active");
</script>
{/if}
<script>
    function formatUnixtimestamp (unixtimestamp){
        var unixtimestamp = new Date(unixtimestamp*1000);
        var year = 1900 + unixtimestamp.getYear();
        var month = "0" + (unixtimestamp.getMonth() + 1);
        var date = "0" + unixtimestamp.getDate();
        var hour = "0" + unixtimestamp.getHours();
        var minute = "0" + unixtimestamp.getMinutes();
        var second = "0" + unixtimestamp.getSeconds();
        return year + "-" + month.substring(month.length-2, month.length)  + "-" + date.substring(date.length-2, date.length)
            + " " + hour.substring(hour.length-2, hour.length) + ":"
            + minute.substring(minute.length-2, minute.length) + ":"
            + second.substring(second.length-2, second.length);
    }

    function getMaterialList(page,type)
    {
        page = parseInt(page);
        var url = '$this_router-getmateriallist?page='+page+'&type='+type;
        $.getJSON(url,function (data) {
            if(data.code==1){
                $("#list").html('        <tr>\n' +
                    '            <td colspan="5" style="text-align: center;font-size: 20px;color:#f00">'+data.msg+'</td>\n' +
                    '        </tr>');
            }else{
                var item = data.item;
                var html = '';
                var i = 0;
                for(var i in item){
                    if(item[i].url===undefined || item[i].url=='') item[i].url='无';
                    else item[i].url='<a href="'+item[i].url+'" target="_blank">点击查看</a>';
                    html +='<tr>';
                    html +='<td><code>'+item[i].media_id+'</code></td>';
                    html +='<td><div style="max-width: 200px;overflow:hidden;" title="'+item[i].name+'">'+item[i].name+'</div></td>';
                    html +='<td style="min-width:150px;text-align: center">'+formatUnixtimestamp(item[i].update_time)+'</td>';
                    html +='<td style="max-width: 200px;word-wrap: break-word;">'+item[i].url+'</td>';
                    html +='<td style="min-width:120px;text-align: center"><a href="{$this_router}-getmaterial?id='+item[i].media_id+'&type='+type+'" target="_blank" class="edit_btn" style="padding-top:2px;padding-bottom:2px;" title="{$P8LANG['preview']}">预览</a> <a href="{$this_router}-delmaterial?id='+item[i].media_id+'" class="edit_btn btn-success" style="padding-top:2px;padding-bottom:2px;" title="{$P8LANG['delete']}" onclick="return confirm(\'确定要删除么？\')">删除</a></td>';
                    html +='</tr>';
                    i++;
                }
                if(i==0) html='<tr><td colspan="5" style="text-align: center;font-size: 20px;">无记录</tr>';
                $("#list").html(html);
                var pagehtml = '<tr><td colspan="10" style="text-align: center;font-size: 20px;">';
                var nextPage = '<input type="button" class="edit_btn" id="next-page" data-page="'+(page+1)+'" value="下一页" />';
                var prevPage = '';
                if(page>1){
                    prevPage = '<input type="button" class="edit_btn" id="next-page" data-page="'+(page-1)+'" value="上一页" />';
                }
                if(i<10){
                    nextPage = '';
                }
                pagehtml = pagehtml + prevPage + nextPage+'</td></tr>';
                $("tfoot").html(pagehtml);
            }
        });
    }
    

    $("#addnew a").click(function () {
        layer.open({
            type: 2,
            title: '增加素材',
            shadeClose: true,
            shade: 0.2,
            maxmin: false, //开启最大化最小化按钮
            area: ['80%', '80%'],
            content: '$this_router-material_add&type={$type}'
        });
        return false;
    });
$(function () {
        var type = '{$type}';
        getMaterialList(1,type);

        $(document).on('click','#next-page',function () {
            var page = $(this).data('page');
            getMaterialList(page,type);
        })
});
</script>
<!--{template $core footer admin}-->
<!--{/php168}-->