<!--{php168}-->
<!--{template $this_module header admin}-->
<div class="mainbox mainborder">
	<div class="section">
		<form name="form" id="searchFrom" action="" method="post">
			<table class="columntable formtable">
			<tr class="title fix_head">
				<td class="title">{$P8LANG['search']}</td>
			</tr>
			<tr>
				<td align="center">			
					信件来源： <select name="source">
					<option value="">全部</option>
					<option value="1" {if $source==1}selected{/if}>在线</option>
					<option value="2" {if $source==2}selected{/if}>邮箱</option>
					<option value="3" {if $source==3}selected{/if}>电话</option>
					</select>
					问题编号：<input name="number" value="$number" type="text" class="txt" /> 
					关键词：<input name="word" value="$word" type="text" class="txt" /> 
					解决人：<input name="solve_name" value="$solve_name" type="text" class="txt" /> 
					部门: <!--{if $select_size>=2}-->
							<!--{php
							for($i=0;$i<$select_size;$i++){
								$this_value = empty($data_field[$i])? '' : $data_field[$i];
								if($i==0){
									$selectdata = $select_data;
								}elseif($data_field){
									$selectdata = (empty($selectdata[$data_field[$i-1]])? array() : $selectdata[$data_field[$i-1]]['s']);
								}else{
									$selectdata = array();
								}
								$inputname = $select_size-1==$i?'department':'parent_department';
							}-->
							<select name="$inputname" id="department" onchange="department_select.change(this)">
								<option value="">--请选择--</option>
								<!--{foreach $selectdata $key $value}-->
								<option value="{$value['i']}" {if $this_value==$key}selected{/if}>{$value['n']}</option>
								<!--{/foreach}-->
							</select>
							<!--{php }}-->							
							<script type="text/javascript">
							var department_select = {
							CAT : <!--{$select_json_data}-->,
							change : function (obj){
								var shtml = dhtml = '<option value="">--请选择--</option>';
								var thisv = $(obj).val();
								$(obj).nextAll('select').html(dhtml);
								if(!thisv){
									return false;
								}
								var path = thisv.split('-');
								var temp = this.CAT;
								if(path.length==1)
									temp=this.CAT[path]['s'];
								else{
									for (var k in path)
										temp = temp[path[k]]['s'];
								}
								if(temp !=''){
									for(var j in temp)
										shtml += '<option value="'+temp[j]['i']+'">'+temp[j]['n']+'</option>';	
									$(obj).next().html(shtml);	
							}}}
							</script>
						<!--{else}-->
							<select name="department" id="department">
								<option value="">请选择</option>
								<!--{foreach $cates['department'] $key $row}-->
								<option value="{$row['id']}" {if !empty($data['department']) && $data['department']==$row['id']}selected{/if}>{$row['name']}</option>
								<!--{/foreach}-->   
							</select>
						<!--{/if}-->
						每页条数:
						<select name="page_size">
							<option value="20" {if $page_size == 20}selected{/if}>20</option>
							<option value="50" {if $page_size == 50}selected{/if}>50</option>
							<option value="100" {if $page_size == 100}selected{/if}>100</option>
							<option value="300" {if $page_size == 300}selected{/if}>300</option>
							<option value="500" {if $page_size == 500}selected{/if}>500</option>
						</select>
					<input type="hidden" name="act" value="search"/>
					<input type="submit" value="{$P8LANG['search']}" class="submit"/>
				</td>
			</tr>
			</table>
		</form>
	</div>
</div>
<div class="mainbox mainborder">
	<div class="section">	
		<table width="100%" border="0"  class="mainbox">
			<tr>
				<td>
					<ul class="boxmenu">
						<li id="status_0" class="$class[0] btn-color1"><a href="$this_router-list?status=0"><i class="icon icon-ico14"></i>待审核</a></li>
						<li id="status_0" class="$class[2] btn-color2"><a href="$this_router-list?status=2"><i class="icon icon-ico24"></i>已受理</a></li>
						<li id="status_0" class="$class[3] btn-color3"><a href="$this_router-list?status=3"><i class="icon icon-ico40"></i>处理完结</a></li>
						<li class="btn-color5"><a href="{$core.U_controller}/letter-manager" target="_blank"><i class="icon icon-ico35"></i>信件会员中心管理</a></li>
						<li class="course pull-right"><a href="{$RESOURCE}/attachment/jiaocheng/xinxiangshezhi.pdf" target="_blank" style="color:#c00;"><img src="{$RESOURCE}/skin/admin/help_icon.gif" class="helpicon"> 信箱管理教程>></a></li>
					</ul>
				</td>
			</tr>
		</table>
		<form name="forms" id="form" action="$this_url" method="post">
		<table class="columntable formtable hover_table click_changeable" width="100%" style="text-align:center" >
			<tr bgcolor="#eeeeee" class="title">
				<td width="2%"><input type="checkbox" name="check_all" onclick="check_item(this,'id[]', $('#form'))" /></td>
				<td width="8%">ID</td>
				<td width="8%">编号</td>
				<td width="7%">状态</td>
				<td width="7%">推荐</td>
				<td width="*">标题</td>
				<td width="8%">部门/类型</td>
				<td width="7%">显示标题</td>
				<td width="7%">公开内容</td>				
				<td width="11%">提问时间</td>
				<td width="11%">解决时间</td>
				<td width="11%">操作</td>
			</tr>
			<!--{foreach $list $k $v}-->
			<tr id="item_$v[id]">
				<td><input type="checkbox" name="id[]" value="$v[id]" /></td>					
				<td>$v[id]</td>
				<td>$v[number]</td>
				<td>
					<!--{if $v['status']==0}-->
					{$P8LANG['status_0']}
					<!--{elseif $v['status']==3}-->
					{$P8LANG['status_3']}
					<!--{else}-->
					{$P8LANG['status_1']}
					<!--{/if}-->
				</td>
				<td>{if $v[recommend]}推荐{else}不推荐{/if}</td>
				<td><a href="{$this_module.controller}-view-id-{$v['id']}" target="_blank">$v[title]</a></td>
				<td>{$cates_departments[$v['department']]['name']}/{$cates['type'][$v['type']]['name']}</td>
				<td>{if $v['undisplay']}不显示{else}公开显示{/if}</td>
				<td>{if $v['visual']}公开{else}不公开{/if}</td>				
				<td>
					<!--{php echo date("Y-m-d H:i:s",$v['create_time']);}-->
				</td>
				<td>
					<!--{php  if($v['solve_time']) echo date("Y-m-d H:i:s",$v['solve_time']);}-->
				</td>
				<td>
					<a href="{$this_module.controller}-view-id-{$v['id']}" target="_blank">查看</a> / 
					<a href="{$this_module.controller}-vefify?id={$v['id']}"  target="_blank">审核</a> / 
					<a href="javascript:void(0)" onclick="deleteitem($v[id]);return false">删除</a></td>
			</tr>
			<!--{/foreach}-->
			<tr>
				<td colspan="12" class="pages">{$pages}</td>
			</tr>
		</table>
		<table width="100%" border="0" cellpadding="0" cellspacing="0" class="foot_btn">			
			<tr>
				<td>
					<a href="javascript:void(0)" onclick="check_all(true,'id[]',$('#form'))">全选</a> /
					<a href="javascript:void(0)" onclick="check_all(false,'id[]',$('#form'));">反选</a>
					<input type="button" class="submit_btn" value="删除" onclick="deleteitem()" />
				</td>
			</tr>
		</table>
		</form>
	</div>
</div>
<script type="text/javascript">
function printthis(){
	$('#searchFrom input[name="act"]').val('print');
	$('#searchFrom').attr('target','_blank').submit();
}
function searchthis(){
	$('#searchFrom input[name="act"]').val('search');
	$('#searchFrom').attr('target','_self').submit();
}
function check_ids(){
	var ids=[];
	$.each(checked_values('id[]'), function(k, v){
	ids.push(v.replace(/[^0-9]/g, ''));
	});
	if(ids.length<1)return false;
	return true;	
}
function deleteitem(id){	
	if(id == undefined){	
		if(!check_ids())return;
	}
	
	p8_window.confirm('{$P8LANG['confirm_to_delete']}', function (r) {
		if(r){
			$.ajax({
				url: '$this_router-delete',
				type: 'POST',
				dataType: 'json',
				data: $('#form').serialize()+'&oid='+id,
				beforeSend: function(){
					ajaxing({});
				},
				success: function(json){
					ajaxing({action: 'hide'});
					for(var i in json){
						$('#item_'+json[i]).remove();
					}
				}
			});
		}else{
			return;
		}
	});	
}
</script>
<!--{/php168}-->