<!--{php168}-->
<!--{template $this_module header admin}-->

<script type="text/javascript" src="{$RESOURCE}/js/upload.js"></script>

<script type="text/javascript" src="{$RESOURCE}/js/core/label/label.js"></script>
<script type="text/javascript">

var label_type = 'html';
var action = '$ACTION';

var _system;
var _module;


</script>

<form action="$this_url" method="POST" id="form">
	<div class="mainbox mainborder">
		<div class="section">
			<table class="columntable formtable ">
				<tr class="title fix_head">
					<td colspan="2" class="title">{$P8LANG['label_scope']} 标签类型：<span style="color:blue;font-weight:700;">【公共标签 > {$P8LANG['label_type']['html']}】</span></td>
				</tr>
				<tr>
					<td colspan="2">
						<div id="tabs"  class="tab_box mtop">
							<div class="head">
								<span><a>风格样式</a></span>
								<span><a>其它设置</a></span>
							</div>
							<div class="main">
								
								<div class="content">
									<table width="100%" class="hover_table">
										
										<tr>
											<td width="58%" valign="top" style="padding:10px;">
												<textarea name="content" id="content" style="width: 100%;height:630px;font-size:16px;">{if !empty($data['content'])}{$data['content']}{else}&nbsp;{/if}</textarea>
												<script type="text/javascript">												
												function _mode(){
													P8_UEDITOR({
														id: 'content',
														type:'all',
														config: {
															initialFrameHeight:580,
															sourceEditorFirst:true,
															toolbars : [['fullscreen', 'source',
															'|', 'undo', 'redo',
															'|', 'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', 
															'|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'selectall', 'cleardoc','|','link','attachment','simpleupload', 'insertimage','pdftoimage','pdfupload']],			
														}
													});
												}
												</script>
											</td>
											<td width="42%" valign="top">
												<input type="text" class="txt" name="option[template]" id="template" value="{if !empty($option['template'])}$option[template]{/if}" size="30" />
													<input type="button" value="选择预设代码.." onclick="template_dialog.show()" /><input type="button" class="usethistpl" value="编辑预设代码" onclick="useThisHtml()" ><br />
													<img style="max-height:300px; max-width:500px;display:block; border:1px solid #ff0000; padding:2px; " id="templateshowimg" src="{$RESOURCE}/images/nopic.jpg" onerror="this.src='{$RESOURCE}/images/nopic.jpg'"  />
												<br>
												<div style="font-size:14px;">
												支持的变量：<br/>
												资源地址：{\$RESOURCE}<br/>
												主站域名：{\$core.url}&nbsp;&nbsp;&nbsp;{\$this_system.domain}&nbsp;&nbsp;&nbsp;{\$core.controller}<br/>
												分站域名：{\$this_system.siteurl}<br/>
												移动域名：{\$core.murl}<br/>
												会员中心：{\$core.U_controller}<br/>
												</div>
												<script type="text/javascript">
												$(document).ready(function(){
													$('#templateshowimg').attr('src',function(){
														return P8CONFIG.RESOURCE +'/{$core.CONFIG['template_dir']}label/'+$('#template').val()+'.jpg';
													});
												});
												
												</script>							
											</td>
										</tr>
										<tr>
											<td colspan="2">
												<input type="button" value="编辑器模式" class="submit_btn" onclick="_mode()" />
												<input type="button" value="{$P8LANG['preview']}" class="submit_btn" onclick="preview()" />
												<input type="hidden" name="verify" value="0" />
												{$P8LANG['label_submit_fail_note']}
											</td>											
										</tr>
										<tr>
											<td id="explain"></td>
										</tr>
									</table>
								</div>
								<div class="content">
									<!--{template $this_module other_set admin}-->
								</div>
							</div>
						</div>						
					</td>
				</tr>
				<tr>
					<td align="center">
						<input type="hidden" name="type" value="html" />
						<input type="submit" value="{$P8LANG['submit']}" class="submit_btn"/>
					</td>
				</tr>				
			</table>			
		</div>
	</div>
	
</form>
<div class="mainbox mainborder">
	<div class="section">
		<table class="columntable formtable ">
			<tr class="title fix_head">
				<td class="title">{$P8LANG['help_about']}</td>
			</tr>
			<tr>
				<td class="headerbtn_list">
				1、在此加入的HTML代码必须保证符合W3C标准，最基本的是HTML标签必须要有闭合，如前面有&lt;div&gt;后必有一个&lt;/div&gt;闭合，否则页面会错乱。<br>
				2、在加入视频代码时要注意，&lt;embed&gt;标签中必须加上一个属性 wmode=&quot;transparent&quot; ，否则在页面编辑标签时就会看不到标签的蓝色块。<br>
				3、在加入javascript时必须要闭合，且其语法必须符合ECMA标准<br>
				4、如果创建可供JS调用的标签，则在“其它设置”页的设置如下：<br>
					【{$P8LANG['label_scope_system']}】选项必须为“核心”<br>
					【{$P8LANG['label_scope_module']}】选项必须为“无”<br>
					【{$P8LANG['label_postfix']}】选项必须为空<br/>		
				</td>
			</tr>
		</table>
	</div>
</div>
<script type="text/javascript">
MoveTabs("tabs",0);
$('#content').change(function(){
	$('#form input[name=verify]').val(Math.random());
}).textarea_tab();
	
function preview(){
	$.ajax({
		url: '$this_router-preview',
		type: 'post',
		cache: false,
		data: $('#form').serialize() +'&option[tplcode]='+ encodeURIComponent('<!-'+'-{'+'php168}-'+'->'+ $('#content').val() +'<!-'+'-{/'+'php168}-'+'->'),
		beforeSend: function(){
			ajaxing({});
		},
		success: function(data){
			ajaxing({action: 'hide'});
			$('#explain').html(data);
		}
	});
}
function useThisHtml(){
	var tpl=$('#template').val();
	$.ajax({
		type:'POST',
		url:'{$core.admin_controller}/core/label-edit_template',
		datatype:'html',
		data:'bdir=label/&tpl='+tpl,
		beforeSend: function(){
			ajaxing({});
		},
		success:function(mesg){
			ajaxing({action: 'hide'});
			mesg = mesg.replace('<!-'+'-{'+'php168}-'+'->','');
			mesg = mesg.replace('<!-'+'-{/'+'php168}-'+'->','');
			mesg = mesg.trim();
			$('#content').val(mesg);
		}
	});
	
}
$(function(){
	$('#form input[name=verify]').rules('add', {
		remote: function(){
			
			return {
				url: '$this_router-preview?_verify=1',
				type: 'post',
				cache: false,
				data: $('#form').serialize() +'&option[tplcode]='+ encodeURIComponent('<!-'+'-{'+'php168}-'+'->'+ $('#content').val() +'<!-'+'-{/'+'php168}-'+'->'),
				beforeSend: function(){
					ajaxing({});
				},
				complete: function(){
					ajaxing({action: 'hide'});
				}
			}
		},
		messages: {
			remote: '{$P8LANG['label_template_syntax_error']}'
		}
	});
});
</script>

<!--{template $core footer admin}-->
<!--{/php168}-->