<!--{php168}-->
<!--{template $this_module header admin}-->

<form action="$this_url" method="POST">
<div class="mainbox mainborder">
	<div class="section">
	<table width="100%" border="0"  class="mainbox">
		<tr>
			<td>
				<ul class="boxmenu">
					<li class="btn-color1"><a href="$this_router-statistic_credit"><i class="icon icon-ico20"></i>绩效评分统计</a></li>
					<li class="btn-color2"><a href="$this_router-add"><i class="icon icon-ico20"></i>添加绩效类型</a></li>
					<li class="btn-color3"><a href="$this_router-list"><i class="icon icon-ico20"></i>绩效列表</a></li>
					<li class="btn-color5"><a href="$this_router-add_rule?{if !empty($system)}&system=$system{/if}{if !empty($module)}&module=$module{/if}{if !empty($postfix)}&postfix=$postfix{/if}"><i class="icon icon-ico45"></i>添加绩效规则</a></li>
					<li class="btn-color6"><a href="$this_router-list_rule"><i class="icon icon-ico20"></i>绩效规则列表</a></li>
					<li class="btn-color7"><a href="$this_router-credit_log"><i class="icon icon-ico20"></i>绩效规则记录</a></li>
					<li class="btn-color8"><a href="$this_router-cache"><i class="icon icon-ico43"></i>{$P8LANG['update_cache']}</a></li>
				</ul>
			</td>
		</tr>
	</table>
	<table class="columntable formtable hover_table">
	<tr class="title fix_head">
		<td class="title">按系统或模块查看</td>
	</tr>
	<tr>
	<td class="headerbtn_list">
		<ul>
			<li {if $system == 'core'}class="active"{/if}>
				<a href="$this_url?system=core">
				<!--{if $system == 'core'}-->
				<b><i class="fa fa-university"></i>{$P8LANG['core']}</b>
				<!--{else}-->
				<i class="fa fa-university"></i>{$P8LANG['core']}
				<!--{/if}-->
				</a>
			</li>
			<!--{foreach $systems $k $v}-->
			<!--{if $v['enabled']}-->	
				<li {if $system == $k}class="active"{/if}>
					<a href="$this_url?system=$k">
					<!--{if $system == $k}-->
					<b><i class="fa fa-university"></i>{$v['alias']}</b>
					<!--{else}-->
					<i class="fa fa-university"></i>{$v['alias']}
					<!--{/if}-->
					</a>
				</li>
			<!--{/if}-->
		<!--{/foreach}-->
		</ul>
	</td>
	</tr>
	
	<tr>
	<td class="headerbtn_list">
		<ul>
		<!--{foreach $modules $k $v}-->	
			<li class="crdlist {if $module == $k}active{/if}">
				<a href="$this_url?system=$system&module={$v['name']}">
				<!--{if $module == $k}-->
				<b><i class="fa fa-laptop"></i>{$v['alias']}</b>
				<!--{else}-->
				<i class="fa fa-laptop"></i>{$v['alias']}
				<!--{/if}-->
				</a>
			</li>
		<!--{/foreach}-->
		</ul>
	</td>
	</tr>
	</table>
	
	<table class="columntable formtable hover_table">
	<tr class="title fix_head">
		<td width="5%" align="center" class="title">ID</td>
		<td width="10%" align="center" class="title">{$P8LANG['mcredit']['rule']['action']}</td>
		<td width="10%" align="center" class="title">{$P8LANG['mcredit']['name']}</td>
		<td width="10%" align="center" class="title">{$P8LANG['mcredit']['rule']['credit']}</td>
		<td width="10%" align="center" class="title">{$P8LANG['mcredit']['rule']['role']}</td>
		<td width="10%" align="center" class="title">{$P8LANG['mcredit']['rule']['times']}</td>
		<td width="15%" align="center" class="title">{$P8LANG['mcredit']['rule']['interval']}</td>
		<td width="10%" align="center" class="title">{$P8LANG['mcredit']['rule']['postfix']}</td>
		<td width="*" align="center" class="title">{$P8LANG['operation']}</td>
	</tr>
	
	<!--{foreach $list $value}-->
	<tr>
		<td align="center">{$value['id']}</td>
		<td align="center">{$value['action']}</td>
		<td align="center">{$value['credit_id']}</td>
		<td align="center">{$value['credit']}</td>
		<td align="center"><!--{if isset($core->roles[$value['role_id']])}-->{$core.roles[$value['role_id']]['name']}<!--{else}-->{$P8LANG['default']}<!--{/if}--></td>
		<td align="center">{$value['times']}</td>
		<td align="center">{$value['interval']}</td>
		<td align="center">{$value['postfix']}</td>
		<td align="center">
			<a href="$this_router-update_rule?id={$value['id']}">{$P8LANG['edit']}</a>
			<a href="$this_router-delete_rule?id={$value['id']}" id="{$value['id']}" onclick="return _delete_credit_rule(this)">{$P8LANG['delete']}</a>
		</td>
	</tr>
	<!--{/foreach}-->
	
	</table>
</div></div>
</form>

<script type="text/javascript">
$(".first_level li").removeClass();
$(".first_level li:nth-child(3)").addClass("active");

function _delete_credit_rule(obj){
	//if(!confirm('$P8LANG[confirm_to_delete]')) return false;
	p8_window.confirm('{$P8LANG['confirm_to_delete']}', function (r) {
		if(r){
			var id = $(obj).attr('id').replace(/[^0-9]/g, '');	
			$.ajax({
				url: '$this_router-delete_rule',
				type: 'POST',
				cache: false,
				data: {id: id},
				success: function(status){
					if(status == 0) return false;
					
					$(obj).parent().parent().remove();
				}
			});
			return false;
		}else{
			return false;
		}
	});	
}
</script>

<!--{template $core footer admin}-->
<!--{/php168}-->