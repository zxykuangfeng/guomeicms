<!--{php168}-->
<!--{template $this_system header admin}-->
<link rel="stylesheet" type="text/css" href="{$_SKIN}/style.css" />
<div class="mainbox mainborder">
	<div class="section">
		<table border="0" width="100%" cellpadding="0" cellspacing="0">
			<tr><td>
			<table class="formtable">
				<tr>
					<ul class="sites-top-menu">
						<ul>
							<li><a href="$this_router-ads_list"><i class="fa fa-tencent-weibo"></i>广告类型管理 </a></li>
							<li><a href="$this_router-buy_list{if !empty($aid)}?aid=$aid{/if}"><i class="fa fa-gears"></i>已投放广告管理</a></li>
							<li><a href="javascript:void(0);" onclick="cache()"><i class="fa fa-refresh"></i>更新广告缓存</a></li>
						</ul>
					</td>
				</tr>
			</table>
			</td></tr>
		</table>
	</div>
</div>
<form action="$this_url" method="POST" id="form">
<div class="mainbox mainborder">
	<div class="section">
		<table width="100%" border="0"  class="mainbox">
			<tr>
				<td>
					<ul class="sites-down-menu">
						<li class="btn-color2"><a href="javascript:;" onclick="views_item(checked_values('id[]', $('#form')))"><i class="icon icon-ico5"></i>预览广告</a></li>
						<li class="btn-color3"><a href="javascript:;" onclick="update_item(checked_values('id[]', $('#form')))"><i class="icon icon-ico45" target="_blank"></i>修改</a></li>
						<li class="btn-color5"><a href="javascript:;" onclick="_delete()"><i class="icon icon-ico46" target="_blank"></i>删除</a></li>
					</ul>
				</td>
			</tr>
		</table>
		<table width="100%" cellspacing="0" cellpadding="0" class="zq_list columntable formtable hover_table click_changeable" align="center">
		<tr class="title">
			<td width="5%" class="list_top"><input type="checkbox" onclick="check_all(this, 'id[]'); init_tr($('#form'));" /></td>
			<td width="5%" class="list_top">ID</td>
			<td width="15%" class="list_top">广告名称</td>
			<td width="8%" class="list_top">投放者</td>			
			<td width="12%" class="list_top">投放时间</td>
			<td width="12%" class="list_top">过期时间</td>
			<td width="12%" class="list_top">备注</td>
			<td width="5%" class="list_top">审核</td>
			<td width="5%" class="list_top">展示</td>
			<td width="5%" class="list_top">顺序</td>
			<td class="list_top">{$P8LANG['operation']}</td>
		</tr>
		
		<!--{foreach $list $value}-->
		<tr id="buy_$value[id]">
			<td><input type="checkbox" class="txt" name="id[]" value="$value[id]" /></td>
			<td>{$value['id']}</td>
			<td><a href="$this_url?aid=$value[aid]" title="$value[aid]">{$value['name']}</a></td>
			<td>{$value['username']}</td>
			<td>{date('Y-m-d H:i', $value['timestamp'])}</td>
			<td><!--{if $value['expire']}-->{date('Y-m-d H:i', $value['expire'])}<!--{/if}--></td>
			<td>$value[comment]</td>
			<td class="verify_$value[aid]_$value[postfix]" id="verify_$value[id]">
				<img src="{$SKIN}/{if $value['verified']}check_yes.gif{else}check_no.gif{/if}" />
			</td>
			<td class="show_$value[postfix]" id="show_$value[id]">
				<img src="{$SKIN}/{if $value['showing']}check_yes.gif{else}check_no.gif{/if}" />
			</td>
			<td>
				<input type="text" class="txt" id="order_$value[id]" value="$value[display_order]" size="3" />
			</td>
			<td>
				<a href="{$STATIC_URL}/modules/46/js/0/{$value['aid']}.php" target="_blank">{$P8LANG['preview']}</a>
				<a href="$this_router-update_buy?id={$value['id']}">{$P8LANG['edit']}</a>
			</td>
		</tr>
		<!--{/foreach}-->
		
		</table>
		<table width="100%" class="columntable formtable">
				<tr>
					<td align="center" id="pages" class="pages">$pages</td>
				</tr>
			</table>
		
		<table width="100%" border="0" cellpadding="0" cellspacing="0" class="foot_btn">			
			<tr>
				<td>
					<input type="submit" value="修改顺序" class="edit_btn" />
					<input type="button" value="审核&展示" onclick="verify_and_show('', 1)" class="edit_btn" />
					<input type="button" value="撤销展示" onclick="verify_and_show('', 0)" class="edit_btn" />
					<input type="button" value="删除" onclick="_delete()" class="edit_btn" />
				</td>
			</tr>
		</table>
	</div>
</div>
</form>

<script type="text/javascript">

function verify_and_show(action, value){
	var id = checked_values('id[]', $('#form'));
	if(!id.length) return;
	
	//if(!confirm('$P8LANG[confirm_to_do]')) return;
	p8_window.confirm('{$P8LANG['confirm_to_do']}', function (r) {
		if(r){
			$.ajax({
				url: '$this_router-verify_show',
				type: 'post',
				dataType: 'json',
				cache: false,
				data: ajax_parameters({action: action, id: id, value: value}),
				beforeSend: function(){
					ajaxing({});
				},
				success: function(json){
					ajaxing({action: 'hide'});
					
					var img = value == 1 ? 'check_yes.gif' : 'check_no.gif';
					
					for(var i in json){
						$('#show_'+ json[i]).html('<img src="{$SKIN}/'+ img +'" />');
						$('#verify_'+ json[i]).html('<img src="{$SKIN}/'+ img +'" />');
					}
				}
			});
		}else{
			return;
		}
	});
	
}

function _delete(){
	var id = checked_values('id[]');
	if(!id.length) return;
	
	if(!confirm('{$P8LANG['confirm_to_delete']}')) return;
	
	$.ajax({
		url: '$this_router-delete_buy',
		type: 'post',
		dataType: 'json',
		data: {id: id},
		cache: false,
		beforeSend: function(){
			ajaxing({});
		},
		success: function(json){
			ajaxing({action: 'hide'});
			
			for(var i in json){
				$('#buy_'+ json[i]).remove();
			}
		}
	});
}

$('input[type=text][id^=order_]').change(function(){
	
	this.value = this.value.replace(/[^0-9]/g, '') || 0;
	if(this.value > 255) this.value = 255;
	if(this.value < 0) this.value = 0;
	$('#form').append('<input type="hidden" name="display_order['+ this.id.replace(/[^0-9]/g, '') +']" value="'+ this.value +'" />');
	$(this).css({border: '1px solid #ff0000'});

});
</script>

<!--{template $core footer admin}-->
<!--{/php168}-->