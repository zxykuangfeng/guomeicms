<!--{php168}-->
<!--{template $core header admin}-->
<script type="text/javascript" src="{$RESOURCE}/js/cms/item/admin.js"></script>
<style type="text/css">
body{background:#fff;}
body, html{overflow:inherit;}
.legend{font-size:14px;padding-bottom:5px;}
</style>	
	<div class="mainbox mainborder">		
			<table width="100%" class="columntable formtable hover_table click_changeable">			
				<tr class="title fix_head">
					<td width="8%" align="center" class="title">ID</td>
					<td width="*" class="title">{$P8LANG['title']}</td>
					<td width="12%" align="center" class="title">{$P8LANG['ategory_name']}</td>
					<td width="12%" align="center" class="title">{$P8LANG['model']}</td>
					<td width="16%" align="center" class="title">{$P8LANG['addtime']}</td>						
					<td width="10%" align="center" class="title">{$P8LANG['operation']}</td>
				</tr>
				
				<tbody id="list">
					
				</tbody>
				
			</table>
			<table width="100%" class="columntable formtable">
				<tr>
					<td align="center" id="pages" class="pages"></td>
				</tr>
			</table>	
	</div>
<script type="text/javascript">
var MODEL = '$MODEL',	
	MODEL_JSON = $model_json,
	PAGE;
function request_item(page){
	
	$.ajax({
		url: '$this_url',
		data: $('#request').serialize() +'&page='+ (page === undefined ? 1 : page),
		dataType: 'json',
		cache: false,
		beforeSend: function(){
			ajaxing({});
		},
		success: function(json){
			PAGE = page;
			$('#list').empty();
			for(var i in json.list){
				_list_item(json.list[i]);
			}			
			$('#pages').html(json.pages);			
			ajaxing({action: 'hide'});			
			window.scrollTo(0, 0);			
		}
	});
}

function _list_item(json){
	
	var props = ['id', 'cid', 'attributes', 'title', 'model', 'timestamp', 'username'];
	
	for(var i = 0; i < props.length; i++){
		if(json[props[i]] === undefined) json[props[i]] = '';
	}
	var model = json.model;
	json.otitle = json.title;
	json.title_bold == 1 && (json.title = '<b>'+ json.title +'</b>');
	json.title_color && (json.title = '<font color="'+ json.title_color +'">'+ json.title +'</font>');	
	json.model = MODEL_JSON[json.model] || {id: 0, name: MODEL, alias: ''};	
	
	var tr = 
	'<tr class="list_item">'+
		'<td align="center"><a href="javascript:void(0);" onclick="parent.edit_drafts('+json.id+',\''+model+'\')">'+ json.id +'</a></td>'+
		'<td><span class="item_title" style="max-width: 300px; overflow: hidden; display: inline-block; line-height:26px;height: 20px;">'+
			'<a href="javascript:void(0);" onclick="parent.edit_drafts('+json.id+',\''+model+'\')">'+ json.title +'</a></span>'+
		'</td>'+
		'<td align="center" id="item_cat_'+ json.id +'" title="'+ json.cid +'">'+json.category_name+'</td>'+
		'<td align="center">'+ json.model.alias +'</td>'+
		'<td align="center">'+ date('Y-m-d H:i', json.timestamp) +'</td>'+
		'<td align="center">'+
			'<a href="{$this_module.controller}-view-id-'+ json.id +'?verified=0" target="_balnk">查看</a> '+
			'<a href="javascript:void(0);" onclick="parent.edit_drafts('+json.id+',\''+model+'\')">编辑</a>'+
		'</td>'+
	'</tr>';
	
	$('#list').append($(tr));
}
$(function(){
	request_item(1);	
});
</script>
<!--{template $core footer admin}-->
<!--{/php168}-->