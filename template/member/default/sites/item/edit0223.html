<!--{php168}-->
<!--{template $core panel_header}-->
<!--{template $this_module header}-->
<script type="text/javascript" src="{$RESOURCE}/js/jq_tabs.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/upload.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/jq_validator.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/iColorPicker.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/recursive_selector.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/rcalendar.js"></script>
<script type="text/javascript" src="{$RESOURCE}/js/jquery.nicescroll.min.js"></script>
<link rel="stylesheet" href="{$SKIN}category_selector.css" type="text/css" />
<style type ="text/css">
.columntable td{border:none; border-bottom:1px solid #EFEFEF;padding-top:8px;padding-bottom:8px}
.columntable .tdL{font-weight:bold;}
#iColorPicker{top:260px !important;left: auto !important;right: 40px !important;}
.edui-default .edui-editor,.edui-default .edui-editor-iframeholder{width:auto !important;max-width:1000px !important;}
</style>
<script type="text/javascript">
var form_submit;

window.onbeforeunload = function(){
	P8_Upload.del(form_submit);
};

$(document).ready(function(){
	member_labelshows('header_t');
	$("#tabs").tabs();
	$('#form').validate({
		rules: {
			<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
			title: {
				required: true,
				maxlength: 250
			},
			
			summary: {
				maxlength: 500
			},
			
			cid: {
				required: true
			},
			<!--{if !empty($this_module->CONFIG['source_required'])}-->
			source: {
				required: true,
			},
			<!--{/if}-->
			<!--{if !empty($this_module->CONFIG['author_required'])}-->
			author: {
				required: true,
			},
			<!--{/if}-->
			html_view_url_rule: {
				required: false,
				maxlength: 80
			}
			<!--{/if}-->
		},
		
		messages: {
			<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
			title: {
				required: '{$P8LANG['sites_item']['title_required']}',
				maxlength: '{$P8LANG['sites_item']['title_oversize']}'
			},
			
			summary: {
				maxlength: '{$P8LANG['sites_item']['summary_oversize']}'
			},
			
			cid: {
				required: '{$P8LANG['sites_item']['category_required']}'
			},
			<!--{if !empty($this_module->CONFIG['source_required'])}-->
			source: {
				required: '{$P8LANG['sites_item']['field_required']}'
			},
			<!--{/if}-->
			<!--{if !empty($this_module->CONFIG['author_required'])}-->
			author: {
				required: '{$P8LANG['sites_item']['field_required']}'
			},
			<!--{/if}-->
			html_view_url_rule: {
				maxlength: '{$P8LANG['sites_item']['html_view_url_rule_oversize']}'
			}
			<!--{/if}-->
		},
		
		errorPlacement: function(error, element) {
			if(element.parent().prop('tagName').toLowerCase() == 'td')
				error.wrap('<div></div>').appendTo(element.parent().prev());
			else
				error.wrap('<div></div>').appendTo(element.parent().parent().prev());
		},
		wrapper: 'div',
		ignore: "" ,
		submitHandler: function(){
			form_submit = true;
			
			$('#form').get(0).submit();
		},
		
		onkeyup: false
	});
});
</script>
<div class="editor-main">
	<div class="editor-top">
		<div class="editor-navbar">
			<div class="model-header">
				<div class="model-left-menu">
					模型选择
					<div class="model-nav-menu">
						<div class="main">
							<ul class="model-list">
								<!--{foreach $models $k $v}-->
								<li class="item"><a href="$this_router-add?model=$k&site={$this_system.SITE}">{$v['alias']} <span>>></span></a></li>								
								<!--{/foreach}-->
							</ul>
						</div>
					</div>
				</div>
				<div class="model-left-title">{$models[$MODEL]['alias']}模型</div>
			</div>
			<div class="model-action">
				<div class="nav-tool">
					<a href="{$core.U_controller}/member-xiumi" target="_blank" class="model-fill-btn model-button btn btn-primary"><i class="icon-submit"></i><span>公众号排版</span></a>
				</div>
				<div class="nav-tool">
					<a href="{$core.U_controller}?main_page=/sites/item-my_list?site={$this_system.SITE}" target="_blank" class="model-fill-btn model-button btn btn-content"><i class="icon-content"></i><span>我发布的内容</span></a>
				</div>
				<div class="nav-tool">
					<a href="{$core.U_controller}?site={$this_system.SITE}" target="_blank" class="model-fill-btn model-button btn btn-center"><i class="icon-center"></i></a>
				</div>
				<div class="nav-tool">
					<a href="{$site_domain}" target="_blank" class="model-fill-btn model-button btn btn-home"><i class="icon-home"></i></a>
				</div>
			</div>
		</div>
	</div>
	<div class="editor-container">
		<form action="$this_url" method="post" id="form">
			<div class="editor-left">
				<div class="editor-model">
					<div class="editor-model-tabs">
						<table class="formtable columntable "  width="100%">
							<tbody>
								<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
								<tr>
									<td class="tdL" width="10%">{$P8LANG['sites_item']['category']} <font color="red">*</font></td>
									<td class="tdR" width="90%">
										<span id="cids"></span>
										<input type="button" onclick="dialog.show()" value="选择栏目 >>" class="browse_btn"/>
										<input type="hidden" name="cid" value="{if isset($data['cid'])}$data[cid]{/if}" />
										<input type="hidden" id="cid" value="{if isset($data['cid'])}$data[cid]{/if}"/>
									</td>
								</tr>
								
								<tr>
									<td class="tdL">{$P8LANG['sites_item']['title']} <font color="red">*</font></td>
									<td class="tdR"> 
										<input type="text" name="title" class="txt ruler" value="{if !empty($data['title'])}{$data['title']}{/if}" size="50" /> &nbsp;&nbsp;
										<!--{if $allow_create_time}-->
										&nbsp;&nbsp;修改{$P8LANG['sites_item']['create_time']}:&nbsp;&nbsp;
										<input type="text" name="timestamp" class="txt" value="{if isset($data['timestamp'])}<!--{php echo date('Y-m-d H:i:s',$data['timestamp']);}-->{/if}" autocomplete="off" onclick="rcalendar(this, 'full')" style="font-size:12px;"/>
										<!--{/if}-->
									</td>
								</tr>							
								
								<tr>
									<td class="tdL">{$P8LANG['sites_item']['author']} <!--{if !empty($this_module->CONFIG['author_required'])}--><font color="red">*</font><!--{/if}--></td>
									<td class="tdR">
										<input type="text" name="author" class="txt" value="{if !empty($data['author'])}{$data['author']}{/if}" size="8" />
										<input type="text" class="txt" name="author_x" id="author_x" value="{if !empty($data['author_x'])}$data[author_x]{/if}" size="8" />
										<input type="text" class="txt" name="author_y" id="author_y" value="{if !empty($data['author_y'])}$data[author_y]{/if}" size="8" />
										<input type="text" class="txt" name="author_z" id="author_z" value="{if !empty($data['author_z'])}$data[author_z]{/if}" size="8"/>
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight:bold;">{$P8LANG['sites_item']['editer']}</span>&nbsp;&nbsp;
										<input type="text" class="txt" name="editer" id="editer" value="{if !empty($data['editer'])}$data[editer]{/if}"/>
									</td>
								<tr>
								<tr>
									<td class="tdL">{$P8LANG['sites_item']['source']} <!--{if !empty($this_module->CONFIG['source_required'])}--><font color="red">*</font><!--{/if}--></td>
									<td class="tdR">
										<input type="text" class="txt" name="source" id="source" value="{if !empty($data['source'])}{$data['source']}{/if}" size="60" />							
										<select onchange="$('#source').val(this.value);">
											<option value="">快捷选择出处</option>
											<!--{foreach $item_config['source'] $source_setter}-->
											<option value="{$source_setter['name']}{if $source_setter['url']}|{$source_setter['url']}{/if}">{$source_setter['name']}</option>
											<!--{/foreach}-->									
										</select>
									</td>
								</tr>
								<tr>
									<td class="tdL">{$P8LANG['sites_item']['frame']}</td>
									<td class="tdR">
										<input type="text" class="txt" name="frame" id="frame"  value="{if !empty($data['frame'])}{$data['frame']}{/if}" size="50" />
										<input type="button" onclick="imgdialog.choseup()" value="{$P8LANG['upload']}" />
										<input type="button" id="frame_toggle" onclick="" value="" style="display: none;" />
										<input type="text" name="thumb_width" id="thumb_width" size="3" onblur="chang_w_h()" value="{if !empty($this_model['CONFIG']['frame_thumb_width'])}{$this_model['CONFIG']['frame_thumb_width']}{else}{if $thumb_width}{$thumb_width}{else}100{/if}{/if}" /> X <input type="text" name="thumb_height" id="thumb_height" size="3" onblur="chang_w_h()" value="{if !empty($this_model['CONFIG']['frame_thumb_height'])}{$this_model['CONFIG']['frame_thumb_height']}{else}{if $thumb_height}{$thumb_height}{else}100{/if}{/if}" />
										(先设定再点击上传) <a href="{$core.admin_controller}/sites/model-update?name={$_REQUEST['model']}" target="_blank">[设置默认值]</a>
										<a href="###" onclick="imgdialog.image_cut()">[$P8LANG[image_cut]]</a> <a href="###" onclick="if($('#frame').val()) window.open($('#frame').val());">[$P8LANG[preview]]</a><br />
										<script type="text/javascript">								
										var frame_thumb_width = "{$this_model['CONFIG']['frame_thumb_width']}";
										var frame_thumb_height = "{$this_model['CONFIG']['frame_thumb_height']}";
										var imgdialog = new P8_Upload({
											element: {
												src: $('#frame'),
												attribute: 'value'
											},
											param: {
												return_thumb: true,
												thumb_width: $("#thumb_width").val() ? parseInt($("#thumb_width").val()) : (frame_thumb_width ? parseInt(frame_thumb_width) : 0),
												thumb_height: $("#thumb_height").val() ? parseInt($("#thumb_height").val()) : (frame_thumb_height ? parseInt(frame_thumb_height) : 0)
											}
										});
										function chang_w_h(){
											imgdialog = new P8_Upload({
												element: {
													src: $('#frame'),
													attribute: 'value'
												},
												param: {
													return_thumb: true,
													thumb_width: $("#thumb_width").val() ? parseInt($("#thumb_width").val()) : (frame_thumb_width ? parseInt(frame_thumb_width) : 0),
													thumb_height: $("#thumb_height").val() ? parseInt($("#thumb_height").val()) : (frame_thumb_height ? parseInt(frame_thumb_height) : 0)
												}
											});
										}
										</script>
									</td>
								</tr>
								<tr>
									<td class="tdL">{$P8LANG['sites_item']['summary']}</td>
									<td class="tdR">
										<textarea name="summary" class="txt" style=" width: 80%;height:80px;" cols="90" rows="5">{if !empty($data['summary'])}{$data['summary']}{/if}</textarea>	
									</td>
								</tr>
								<tr>
									<td class="tdL">{$P8LANG['sites_item']['url']}</td>
									<td class="tdR">
										<input type="text" name="url" id="url" class="txt" size="60" value="{if !empty($data['url'])}$data[url]{/if}" />
										<span id="url_holder"></span>
										<script type="text/javascript">
										$(function(){
											var field_url = new P8_Upload({
												element: {
													src: $("#url"),
													attribute: 'value'
												},
												callback: function(json){},
												param: {}
											});

											$('<input type="button" value="{$P8LANG['upload']}" />').click(function(){
												field_url.choseup();
											}).appendTo($('#url_holder'));
										});
										</script>
										<!--{if $allow_set_views}-->
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;">{$P8LANG['sites_item']['views']}</span>&nbsp;&nbsp;
										<input type="text" class="txt" name="views" id="views" value="{if !empty($data['views'])}$data[views]{/if}"/>
										<!--{/if}-->
									</td>
								</tr>
								<tr>
									<td class="tdL">&nbsp;</td>
									<td class="tdR">
										<table class="formtable columntable" width="80%">
											<tbody>
												<tr>
													<td style="border-bottom:0;padding:0;">
														<table class="formtable columntable" width="100%">
															<tbody>
																<!--{if $allow_filter_word}-->
																<tr>
													
																	<td class="tdL" style="border-bottom:0;padding:0 10px 0;font-weight:400;">系统精确敏感词检测：</td>
																	<td class="tdR" style="border-bottom:0;padding:0;">
																		<input type="checkbox" name="filter_word_enable" id="filter_word_enable" value="1" {if !$filter_word_enabled}disabled="disabled"{/if}/><label for="filter_word_enable">忽略不检测</label> {if !$filter_word_enabled}<label style="color:blue">（本账号没开启此权限）</label>{/if}
																	</td>
																</tr>
																<!--{/if}-->
															</tbody>
														</table>
													</td>
													<td style="border-bottom:0;padding:0;">
														<table class="formtable columntable" width="100%">
															<tbody>
																<!--{if $allow_content_censor}-->
																<tr>
																	<td class="tdL" style="border-bottom:0;padding:0 10px 0;font-weight:400;">大数据内容智能检测：</td>
																	<td class="tdR" style="border-bottom:0;padding:0;">
																		<input type="checkbox" name="content_censor_enabled" id="content_censor_enabled" {if $allow_censor_default}checked="true"{/if} value="1" {if !$content_censor_enabled}disabled="disabled"{/if}/><label for="content_censor_enabled">忽略不检测</label> {if !$content_censor_enabled}<label style="color:blue">（本账号没开启此权限）</label>{/if}
																	</td>
																</tr>
																<!--{/if}-->
															</tbody>
														</table>
													</td>
												</tr>
											<tbody>
										</table>
									</td>
								</tr>
							<tbody>								
							<!--{/if}-->
						</table>
					</div>
					<div class="editor-model-tabs">
						<table class="formtable columntable "  width="100%">
							<tbody>
								<tr>
									<td class="tdL">远程附件</td>
									<td class="tdR">
										<input type="checkbox" name="capture_image" id="capture_image" value="1" /><label for="capture_image">保存远程图片</label>
									</td>
								</tr>
								
								<tr>
									<td class="tdL">{$P8LANG['sites_item']['attachment_pdf']}</td>
									<td class="tdR">
										<input type="text" class="txt" name="attachment_pdf" id="attachment_pdf"  value="{if !empty($data['attachment_pdf'])}{$data['attachment_pdf']}{/if}" size="50" />
										<input type="button" onclick="attachment_pdf_uploader.choseup();" value="上传内容页在线PDF" />
										<script type="text/javascript">
											var attachment_pdf_uploader;
											$(function(){
												attachment_pdf_uploader = new P8_Upload({
													element: {
														src: $('#attachment_pdf'),
														attribute: 'value'
													},
													param: {return_thumb: false,filter: {pdf:0}}
												});
											});
										</script>
									</td>
								</tr>
								<!--{if empty($this_model['CONFIG']['parts'])}-->
								<!--简单布局开始-->								
								<!--{foreach $this_model['fields'] $field $field_data}-->
								<tr>
									<td class="tdL" width="8%">{$field_data['alias']} <!--{if $field_data['not_null']}--><font color="red">*</font><!--{/if}--></td>
									<td class="tdR" width="92%">
										<!--{php 
											$__name = '';
											include template($core, 'widget/'. $field_data['widget'], 'default');
											
											switch($field_data['widget']){
											
											case 'checkbox': case 'multi_select':
												$__name = '[]';
											break;
											case 'uploader': case 'image_uploader':
												$__name = '[url]';
											break;
											case 'multi_uploader':
												$__name = '[url][]';
											break;
											
											}
										}-->
										<!--{if !empty($field_data['units'])}-->$field_data[units]<!--{/if}-->
										<!--{if !empty($field_data['description'])}--> <span class="help">$field_data[description]</span><!--{/if}-->
									</td>
								</tr>
								<!--{if $field_data['not_null']}-->
								<script type="text/javascript">
								$(document).ready(function(){
									$('#form *[name="field#[$field]$__name"]').rules('add', {
										required: function(){ return !$('#url').val().length && true},
										messages: { required: '{$P8LANG['sites_item']['field_required']}'}
									});
								});
								</script>
								<!--{/if}-->
								<!--{/foreach}-->
								
								<!--{else}-->
						
								<!--复杂布局开始-->
								<!--{foreach $this_model['CONFIG']['parts'] $pk $pd}-->
								<!--{if empty($pd['hide'])}-->
								<tr>
									<td class="head" colspan="2"><b class="part_name">$pd[name]</b></td>
								</tr>
								<!--{/if}-->
								<tr>
									<td colspan="2" class="parts">
										<table width="100%"  cellpadding="0" cellspacing="0">
											<tr>
												<!--{php $tdwidth = 100/$pd['row'].'%'; for($i=1;$i<=$pd['row'];$i++){ $tdid = "$pk-$i";}-->
												<td id="$pk-$i" width="$tdwidth" valign="top" class="parts">
													<table width="100%" border="0"  cellpadding="0" cellspacing="0">
														<!--{foreach $this_model['parts'][$tdid] $fid $field}-->
														<!--{php
															$field_data = $this_model['fields'][$field];
															
															$__name = '';
															
															switch($field_data['widget']){
															
															case 'checkbox': case 'multi_select':
																$__name = '[]';
															break;
															case 'uploader': case 'image_uploader':
																$__name = '[url]';
															break;
															case 'multi_uploader':
																$__name = '[url][]';
															break;
															
															}
														}-->
														<tr>
															<td class="tdL">{$field_data['alias']} <!--{if $field_data['not_null']}--><font color="red">*</font><!--{/if}--></td>
															<td class="tdR">
																<!--{php include template($core, 'widget/'. $field_data['widget'], 'default');}-->
																<!--{if !empty($field_data['units'])}-->$field_data[units]<!--{/if}-->
																<!--{if !empty($field_data['description'])}--> <span class="help">$field_data[description]</span><!--{/if}-->
															</td>
														</tr>													
														<!--{if $field_data['not_null']}-->
														<script type="text/javascript">
														$(document).ready(function(){
															$('#form *[name="field#[$field]$__name"]').rules('add', {
																required: function(){ return !$('#url').val().length && true;},
																messages: { required: '{$P8LANG['sites_item']['field_required']}'}
															});
														});
														</script>
														<!--{/if}-->
														<!--{/foreach}-->
													</table>
												</td>
												<!--{php }}-->
											</tr>
										</table>
									</td>
								</tr>
								<!--{/foreach}-->
								<!--{/if}-->																											
								<tr>
									<td colspan="2" style="text-align:center;"> <input type="submit" value="提交发布" class="submit-btn"/> </td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="editor-right" style="height: calc(100vh - 111px);">
				<div class="publish-main">
					<div class="publish-tabs" id="tabs">
						<ul>
							<li><a href="#tabs-1"><span>基本设置</span></a></li>
							<li><a href="#tabs-2"><span>浏览权限</span></a></li>
							<li><a href="#tabs-3"><span>标题属性</span></a></li>
						</ul>
						<div id="tabs-1">
							<div class="publish-form">
								<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
								<div class="publish-form-title mb10">
									仅限局域网：
								</div>
								<div class="publish-form-item">
									<input type="checkbox" name="config[allow_ip][enabled]" id="allow_ip_2" value="2" {if !empty($config['allow_ip']['enabled']) && $config['allow_ip']['enabled']==2} checked{/if} /><label for="allow_ip_2">限局域网访问</label>
								</div>
								<!--{if $allow_attribute}-->
								<div class="publish-form-title mb10">
									{$P8LANG['sites_item']['attribute']['']}：
								</div>
								<div class="publish-form-item mb10">
									<!--{foreach $this_module->attributes $aid $v}-->
										<!--{if $aid>=10 && $aid<=13}-->
											<!--{if $ACTION != 'add' && isset($data['attributes'][$aid])}-->
											<input type="hidden" id="attribute_$aid" name="attribute[$aid]" value="$aid" {if isset($data['attributes'][$aid])} checked{/if} />
											<!--{/if}-->
										<!--{else}-->
										<input type="checkbox" id="attribute_$aid" name="attribute[$aid]" value="$aid" {if isset($data['attributes'][$aid])} checked{/if} /><span title="{if !empty($attributes[$aid])}{$attributes[$aid]['last_setter']} 于 {date('Y-m-d H:i', $attributes[$aid]['timestamp'])}设置{/if}"><label for="attribute_$aid">{if $this_module->CONFIG['attributes'][$aid]}{$this_module->CONFIG['attributes'][$aid]}{else}{$P8LANG['sites_item']['attribute'][$aid]}{/if}</label></span>&nbsp;
										<!--{/if}-->									
									<!--{/foreach}-->
								</div>
								<!--{/if}-->
								
								<!--{if $allow_level}-->
								<div class="publish-form-title mb10">
									{$P8LANG['sites_item']['level']}：
								</div>
								<div class="publish-form-item" style="margin-bottom:30px;">
									<div class="slider-info">
										<div class="publish-form-item2 mb10">
											<label>时效：</label>
											<input type="text" class="txt-inner3" name="level_time" value="{if isset($data['level_date']) && $data['level_date']}$data[level_date]{else}不选则永久有效{/if}" onfocus="if (value =='不选则永久有效'){value =''}" onblur="if (value ==''){value='不选则永久有效'}" autocomplete="off" onclick="rcalendar(this, 'full')" />	
										</div>
										<p>
											内容排名：
											<select id="level" onchange="set_levels(this.value)">
												<option value="">快捷设置权重值</option>
												<!--{foreach $P8LANG['sites_item']['level_rank'] $k=>$v}-->
												<!--{if $k}-->
												<option value="{$k}" {if $data['level']==$k}selected{/if}>设置为：第{$v}名</option>
												<!--{else}-->
												<option value="{$k}" {if $data['level']==$k}selected{/if}>设置为：{$v}</option>
												<!--{/if}-->
												<!--{/foreach}-->
											</select>
										</p>
									</div>
									<div class="input-group clearfix" style="margin:10px 0;display:block;">								
										<div class="slider-info" style="width:50%;float:left;">
											权重值: <span class="slider-info" id="sort-min-amount">{if !empty($data['level'])}$data[level]{/if}</span>（选项优先）
											<input name="level" id="sort-name" value="{if !empty($data['level'])}$data[level]{/if}" type="hidden">
										</div>
										<div id="sort" class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false" style="width:50%;float:left;margin-top:7px;">
											<div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: <!--{php echo !empty($data['level'])?$data[level]/2.55:0;}-->%;"></div>
											<a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="left: <!--{php echo !empty($data['level'])?$data['level']/2.55:0;}-->%;"></a>
											<div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: <!--{php echo !empty($data['level'])?$data['level']/2.55:0;}-->%;"></div>
										</div>
										<script type="text/javascript">										
											$(function() {
												$("#sort").slider({
													range: "min",value: {if !empty($data['level'])}$data[level]{else}0{/if},
													min: 0,
													max: 250,
													step:1,
													slide: function (event, ui) {
														$("#sort-min-amount").text("" + ui.value);
														$("#sort-name").val(ui.value);
													}
												});
												$("#sort-min-amount").text("" + $("#sort").slider("value"));										
											});										
										</script>
										<span class="tablewarnings"></span>
									</div>
								</div>
								<!--{/if}-->
								<!--{if $this_model['CONFIG']['allow_custom']}-->
								<div class="publish-form-title mb10">
									{$P8LANG['custom_name']}：
								</div>
								<div class="publish-form-item3">
									<!--{foreach $custom $custom_item}-->
									<!--{php $custom_enable = $custom_item.'_enabled';}-->
									<!--{if $this_model['CONFIG'][$custom_enable]}-->
									<div class="publish-form-title"><!--{if $this_model[CONFIG][$custom_item]}-->{$this_model['CONFIG'][$custom_item]}<!--{else}-->{$P8LANG[$custom_item]}<!--{/if}--></div>
									<div class="publish-form-item"><input type="text" name="{$custom_item}" size="60" class="txt-inner" id="{$custom_item}" value="{if !empty($data[$custom_item])}$data[$custom_item]{/if}"/></div>
									<!--{/if}-->
									<!--{/foreach}-->
								</div>
								<!--{/if}-->

								<div class="publish-form-title">
									{$P8LANG['sites_item']['verify_frame']}（手工审核证据图）：
								</div>
								<div class="publish-form-item">
									<input type="text" class="txt-inner" name="verify_frame" id="verify_frame"  value="{if !empty($data['verify_frame'])}{$data['verify_frame']}{/if}" size="50" />
								</div>
								<div class="publish-form-item2 mb20">
									<input type="button" onclick="verify_frame_uploader.choseup();" value="上传审核图 " />
									<input type="button" id="verify_frame_toggle" onclick="" value="" style="display: none;" />								
									<script type="text/javascript">
									var verify_frame_uploader;
									$(function(){
										verify_frame_uploader = new P8_Upload({
											element: {
												src: $('#verify_frame'),
												attribute: 'value'
											},
											param: {
												return_thumb: true<!--{if !empty($this_model['CONFIG']['frame_thumb_width']) && !empty($this_model['CONFIG']['frame_thumb_height'])}-->,
												thumb_width: {$this_model['CONFIG']['frame_thumb_width']},
												thumb_height: {$this_model['CONFIG']['frame_thumb_height']}
												<!--{/if}-->
											}
										});
									});
									</script>
								</div>
								<!--{/if}-->
							</div>
						</div>
						<div id="tabs-2">
							<div class="publish-form">
								<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
								<div class="publish-form-title mb10">
									是否启用IP允许：
								</div>
								<div class="publish-form-item">
									<input type="radio" name="config[allow_ip][enabled]" value="0" id="allow_ip_0" {if empty($config['allow_ip']['enabled'])} checked{/if}/ onclick="allow_ip_local(0)"><label for="allow_ip_0" onclick="allow_ip_local(0)">不开启</label>
									<input type="radio" name="config[allow_ip][enabled]" value="2" id="allow_ip_3" {if !empty($config['allow_ip']['enabled']) && $config['allow_ip']['enabled']==2} checked{/if} onclick="allow_ip_local(3)"/><label for="allow_ip_3" onclick="allow_ip_local(2)">仅限局域网访问</label>
									<input type="radio" name="config[allow_ip][enabled]" value="1" id="allow_ip_1" {if !empty($config['allow_ip']['enabled']) && $config['allow_ip']['enabled']==1} checked{/if}/ onclick="allow_ip_local(1)"><label for="allow_ip_1" onclick="allow_ip_local(1)">开启</label>
									<p>（选开启时下面的IP设置才有效，IP检测顺序：全站IP->栏目IP）</p>
								</div>
								
								
								
								<div class="publish-form-title mb10">
									允许IP：
								</div>
								<div class="publish-form-item">
									<textarea cols="30" rows="8" name="config[allow_ip][collectip]" style="width:100%">
									<!-- {if !empty($config['allow_ip']['collectip'])} -->
										<!-- {foreach $config['allow_ip']['collectip'] $key $value} -->
											{$value}
										<!-- {/foreach} -->
										<!-- {/if} -->
									</textarea><p>访问的客户端必须是固定IP或者在固定的IP段内<br/>
									否则很有可能导致客户端无法正常访问<br/>
									书写格式每行一个IP，示例如下：<br/>
									12.*.*.*<br/>
									12.34.56.79</p>
								</div>
								
								<div class="publish-form-title mb10">
									允许IP段：
								</div>
								<div class="publish-form-item">
									<textarea cols="30" rows="8" name="config[allow_ip][area_ip]" style="width:100%">
									<!-- {if !empty($config['allow_ip']['area_ip'])} -->
										<!-- {foreach $config['allow_ip']['area_ip'] $key $value} -->
											$key
										<!-- {/foreach} -->
									<!-- {/if} -->
									</textarea>
								   <p>例如：<br/>
											192.168.0.2-192.168.0.255<br/>
											192.168.1.0-192.168.254.255</p>
								</div>
								<div class="publish-form-title mb10">
									允许IP段内例外IP：
								</div>
								<div class="publish-form-item">
									<textarea cols="30" rows="6" name="config[allow_ip][ruleoutip]" style="width:100%">
									<!-- {if !empty($config['allow_ip']['ruleoutip'])} -->
										<!-- {foreach $config['allow_ip']['ruleoutip'] $key $value} -->
											{$value}
										<!-- {/foreach} -->
										<!-- {/if} -->
									</textarea>
									<p>在允许IP段内，可以限制例外的IP地址<br/>
										书写格式每行一个IP，示例如下：<br/>
										12.*.*.*<br/>
										12.34.56.79</p>
								</div>					
								
								<!--{if $ACTION == 'update'}-->
								<div class="publish-form-title mb10">
									{$P8LANG['sites_item']['ip']}：
								</div>
								<div class="publish-form-item">
									$data[ip]
								</div>
								<div class="publish-form-title mb10">
									{$P8LANG['sites_item']['last_update_ip']}：
								</div>
								<div class="publish-form-item">
									$data[last_update_ip]
								</div>
								<!--{/if}-->
								
								<div class="publish-form-title mb10">
									此内容{$P8LANG['sites_item']['authority_viewer']}：
								</div>
								<div class="publish-form-item">
									<ul id="authority_viewer" class="manager_ids">
										<!--{foreach $authority_viewer $user}-->
										<li>{$user['username']}<input type="hidden" name="config[authority_viewer][]" value="{$user['id']}"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>
										<!--{/foreach}-->
									</ul><input type="button" value="{$P8LANG['sites_item']['authority_select']}" onclick="show_role_dialog()"/>
									<br>功能状态：{if $authority_enable}开启{else}关闭{/if}，<a href="{$core.admin_controller}/sites/item-config#authority" target="_blank">[设置角色浏览控制]</a>
								</div>
								<div class="publish-form-title mb10">
									此内容{$P8LANG['sites_item']['authority']}：
								</div>
								<div class="publish-form-item">
									<input type="checkbox" name="authority[]" value="0" {if in_array('0',$authority)}checked="checked"{/if} />
									<label for="authority0">不限</label>
									<!--{foreach $core->roles $yid $v}-->
									<!--{if $v['gid'] != 1}-->
									<input type="checkbox" name="authority[]" value="{$yid}" {if in_array($yid,$authority)}checked="checked"{/if} />
									<label for="authority{$id}">{$v['name']}</label>
									<!--{/if}-->
									<!--{/foreach}-->
									<span class="help">全选和不选都表示不限制</span>
									<br>功能状态：{if $authority_enable}开启{else}关闭{/if}，<a href="{$core.admin_controller}/sites/item-config#authority" target="_blank">[设置角色浏览控制]</a>
								</div>
								<script type="text/javascript">							
									function delete_manager(obj){
										$(obj).parent().remove();	
									}
									function member_single_select_callback(checked, json){
										$('#authority_viewer').find("input[value="+json.id+"]").parent().remove();
										if(checked)	$('#authority_viewer').append('<li>'+json.username+'<input type="hidden" name="config[authority_viewer][]" value="'+json.id+'"/><span onclick="delete_manager(this)" class="delete_link">[X]</span></li>');
									}
									var role_dialog = new P8_Dialog({
										title_text:'选择查看人',
										width: 550,
										height: 420,
										button: true
									});
									role_dialog.content.append($('<iframe width="100%" height="360" frameborder="0" border="0" marginwidth="0" marginheight="0"></iframe>'));

									function show_role_dialog(){
										role_dialog.show();
										var ifr = role_dialog.content.find('iframe');
										var check_uids = {};
										$('#authority_viewer').find('input').each( function(){ check_uids[$(this).val()]=$(this).val(); } );
										ifr.attr('src', '{$core.U_controller}/core/member-selectuser?'+ajax_parameters({'checked_ids': check_uids}));
									}
								</script>
								<div class="publish-form-title">
									内容页模板选择：
								</div>
								<div class="publish-form-item">
									<input type="text" class="txt-inner" name="template" id="template" value="{if !empty($data['template'])}$data[template]{/if}" size="30" />
								</div>
								<div class="publish-form-item2 mb10">
									<input type="button" value="选择内容页模板" onclick="template_dialog.show();" />
								</div>
								
								<div class="publish-form-title mb10">
									静态化内容：
								</div>
								<div class="publish-form-item">
									<input type="checkbox" name="html" id="html_view" value="1" {if $this_module->CONFIG['htmlize']} checked{/if} /><label for="html_view">静态化内容</label>
								</div>
								<!--{/if}-->
							</div>
						</div>
						<div id="tabs-3">
							<div class="publish-form">
								<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
								<div class="publish-form-title">
									标题颜色：
								</div>
								<div class="publish-form-item">
									<input type="text"  name="title_color" size="7" id="titlecolor" class="txt-inner iColorPicker" value="{if !empty($data['title_color'])}$data[title_color]{/if}" onclick="iColorShow('titlecolor','titlecolor', function(v){ $('#titlecolor').val(v);})" autocomplete="off" />
								</div>
								<div class="publish-form-title mb10">
									标题加粗：
								</div>
								<div class="publish-form-item">
									<input type="checkbox" name="title_bold" id="title_bold" value="1"{if !empty($data['title_bold'])} checked{/if} /><label for="title_bold">{$P8LANG['sites_item']['title_bold']}</label>
								</div>
								<div class="publish-form-title publish-form-title2">
									{$P8LANG['sites_item']['sub_title']}：
								</div>
								<div class="publish-form-item">
									<input type="text" class="txt-inner" name="sub_title"  value="{if !empty($data['sub_title'])}{$data['sub_title']}{/if}" />
								</div>
								<div class="publish-form-title publish-form-title3">
									{$P8LANG['keyword']}：
								</div>
								<div class="publish-form-item" style="margin-bottom:10px;">
									<input name="keywords" id="keywords" type="text" class="txt-inner" value="{if !empty($data['keywords'])}$data[keywords]{/if}" />
								</div>		
								<div class="publish-form-item2 mb10">
									解释说明：{$P8LANG['sites_item']['keyword_hint']}
								</div>
								<!--{/if}-->
							</div>
						</div>
					</div>
				</div>
			</div>
			<input type="hidden" name="model" value="$MODEL" />
			<input type="hidden" name="verified" value="{if isset($verified)}$verified{/if}" />
			<input type="hidden" name="action" value="$ACTION" />				
			<input type="hidden" name="id" value="{if !empty($data['id'])}{$data['id']}{/if}" />
			<input type="hidden" name="iid" value="{if !empty($data['iid'])}{$data['iid']}{/if}" />
			<input type="hidden" name="attachment_hash" value="<!--{php echo $attachment_hash = unique_id(16);}-->" />
			<!--{if $ACTION == 'update'}-->
			<input type="hidden" name="verifier" value="{if !empty($data['verifier'])}{$data['verifier']}{/if}" />
			<!--{/if}-->
		</form>
	</div>
</div>
<script type="text/javascript">
var attachment_hash = '$attachment_hash';

<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
var P8_ROOT = '$P8_ROOT';
var template_dialog = new P8_Dialog({
	title_text: '{$P8LANG['select_template']}',
	button: true,
	width: 700,
	height: 350,
	ok: function(){
		$('#template').val(template_selector.value);
	},
	show: function(){
		template_selector.init();
	}
});
template_dialog.content.height(300);

var template_selector = new Template_Selector({
	base_dir: '{$this_system.name}/{$this_system.site['template']}/{$this_system.name}/item/',
	template_dir: '{if !empty($data['model'])}$data[model]{/if}',
	selected: '{if !empty($data['template'])}$data[template]{/if}',
	dialog: template_dialog
});

function Template_Selector(options){

this.dialog = options.dialog;

this.base_dir = options.base_dir || '';
this.selected = options.selected || '';
this.template_dir = options.template_dir || 'template/';
this.last_ul = null;
this.last_dir = null;
this.last_file = null;
this.value = '';

this.menu_bar = $('<div>\
	<input type="button" value="'+ P8LANG.refresh +'" class="refresh" />\
</div>').appendTo(this.dialog.content);
this.content = $('<div></div>').appendTo(this.dialog.content);
this.previewer = $('<div style="position: absolute; z-index: 200001;"><img src="" onerror="this.src=\'{$RESOURCE}/skin/admin/nopic.jpg\'" /></div>').hide().appendTo(document.body);

this.inited = false;
this.init_data = [];

var _this = this;

$('.refresh', this.menu_bar).click(function(){
	_this.refresh();
});

this.fetch = function(select, dir){
	
	if(select === null){
		dir = '';
	}
	
	if(this.last_dir == dir) return;
	
	$(select).nextAll('ul').remove();
	
	$.ajax({
		url: P8CONFIG.U_controller +'/member-template_json?base_dir='+ encodeURIComponent(this.base_dir) +'&dir='+ encodeURIComponent(dir),
		dataType: 'json',
		cache: false,
		async: false,
		beforeSend: function(){
			ajaxing({zIndex: _this.dialog.zIndex +1});
		},
		success: function(json){
			ajaxing({action: 'hide'});
			
			var ul = $('<ul class="template_selector"></ul>');
			
			var init_length = _this.init_data.length;
			var last_dir = _this.init_data.shift();
			
			for(var i = 0; i < json.length; i++){
				var name = basename(json[i].name.replace(/\/$/, ''));
				var li = $('<li title="'+ name +'">'+ name +'</li>');
				ul.append(li);
				
				li.data('data', json[i].name);
				li.data('type', json[i].type);
				li.addClass(json[i].type == 'dir' ? 'dir' : 'html');
				if(!_this.inited && _this.selected == json[i].name){
					li.addClass('selected');
					_this.last_file = json[i].name;
				}
				
				if(json[i].type == 'file'){
					li.mouseover(function(){
						var position = $(this).offset();
						_this.previewer.show().
						css({
							left: $(this).width() + position.left +'px',
							top: position.top +'px'
						}).
						find('img').attr('src', P8_ROOT + _this.template_dir + _this.base_dir + $(this).data('data') +'.jpg');
					}).mouseout(function(){
						_this.previewer.hide();
					});
					
					if(_this.inited && _this.selected == name){
						li.addClass('selected');
					}
				}else{
					if(!_this.inited && last_dir == name){
						li.addClass('selected');
					}
				}
				
				li.click(function(){
					var type = $(this).data('type');
					var data = $(this).data('data');
					
					if(type == 'dir'){
						_this.fetch($(this).parent(), data);
						_this.last_dir = data;
						_this.last_ul = li.parent();
						_this.last_file = null;
					}else{
						_this.value = data;
						$(this).parent().nextAll('ul').find('.selected').removeClass('selected');
						_this.last_file = data;
					}
					
					$(this).parent().find('.selected').removeClass('selected');
					$(this).addClass('selected');
				});
				
				
			}
			
			_this.last_dir = dir;
			
			_this.content.append(ul);
			
			if(init_length){
				_this.last_ul = ul;
				_this.fetch(ul, dir +'/'+ last_dir);
			}else{
				_this.inited = true;
			}
		}
	});
};

this.refresh = function(){
	if(this.last_ul === null){
		this.content.find('ul').remove();
	}
	
	var last_dir = this.last_dir;
	this.last_dir = null;
	this.fetch(this.last_ul, last_dir);
};

this.init = function(){
	
	if(this.inited) return;
	
	this.init_data = this.selected.split('/');
	this.init_data.pop();
	
	this.fetch(null, '');
	
};

}

var my_addible_category = $my_addible_category;

var dialog = new P8_Dialog({
	title_text: '请选择栏目',
	button: true,
	width: 900,
	height: 500,
	ok: function(){
		var id = cs.get_value();
		var selected_cat = cs.get_by_id(id);
		if(selected_cat.type == 1){
			p8_window.alert('你选了一个不可发内容的大分类，请重新选择！');
			return false;
		}
		$('#form input[name=cid]').val(id);
		category_path(id);
	},
	show: function(){
		cs.init();
	}
});

var cs = new Recursive_Selector({
	input: $('#cid'),
	dialog: dialog,
	sub_property: 'categories',
	url: '{$this_system.controller}/category-json',
	value: $('#form input[name=cid]').val(),
	filter: function(cat){
		if(!my_addible_category || my_addible_category[0] || my_addible_category[cat.id]){
			return true;
		}
	},
	item_callback: function(cat, item){
		if(cat.model != '$MODEL' && $.inArray('$MODEL',cat.models) == -1)
			item.css({display:'none',opacity: '0.3', alpha: '(opacity=30)'});
		
		if(cat.type == 1)
			item.find('span').addClass('frame_category');
		
		if(cat.categories)
			item.addClass('sub_category');
	},
	init_callback: function(){
		category_path(this.get_value());
	},
	change: function(select){
		var cat = cs.get_by_id(select.data('value'));
		if(cat.model == 'page' && !cat.categories){
			ajaxing({'text':'正在转向中……'});
			window.location.href="{$this_router}-add?model="+cat.model+"&cid="+cat.id+"&type="+cat.type;
		}else{
			if(cat.model != '$MODEL' && !cat.categories){
				p8_window.alert('你选了一个非本模型的分类');
				return false;
			}
		}		
	}
});

function set_levels(level){
	$("#sort-min-amount").text(level);
	$("#sort-name").val(level);
	$("#sort").slider({
		range: "min",value: level,
		min: 0,
		max: 250,
		step:1,
		slide: function (event, ui) {
			$("#sort-name").val(level);
		}
	});
}

function category_path(cid){
	if(cid == 0){
		$('#cids').html('');
		return;
	}
	
	var tmp = cs.get_by_id(cid);
	var html = '';
	
	while(true){
		html = tmp.name +' &gt; '+ html;
		if(tmp.parent == 0) break;
		
		tmp = cs.get_by_id(tmp.parent);
	}
	
	$('#cids').html(html);
}
<!--{/if}-->


$(function(){
	<!--{if $ACTION == 'add'}-->
	$('#form input[name=title]').focus();
	<!--{/if}-->
	
	<!--{if $ACTION == 'add' || $ACTION == 'update'}-->
	cs.init();
	<!--{/if}-->
});

function showmorebox(){
	var stype = $("#morechose").css('display');
	if(stype == 'none' ){
		$("#morechose:hidden").show();
		$("#more_text").html('&#8743; 更多选项 &#8743;');
	}else{
		$("#morechose").hide();
		$("#more_text").html('&#8744; 更多选项 &#8744;');
	}
}
$(".publish-main").niceScroll({  
	cursorcolor:"#CAD3D5",  
	cursoropacitymax:1,  
	touchbehavior:false,  
	cursorwidth:"2px",  
	cursorborder:"0",  
	cursorborderradius:"5px"  
});
$('.model-left-menu').hover(function() {
	//鼠标移入
	$('.model-nav-menu').stop().slideDown()
},function() {
	//鼠标移出
	$('.model-nav-menu').stop().slideUp()
});
function open_xiumi(){	
	var dialog_xiumi = new P8_Dialog({
		title_text:'公众号排版',
		width: 1050,
		height: 500,
		button: false
	});
	dialog_xiumi.content.append($('<iframe width="100%" height="500" frameborder="0" border="0" marginwidth="0" marginheight="0"></iframe>'));
	dialog_xiumi.show();
	var ifr = dialog_xiumi.content.find('iframe');
	ifr.attr('src', '{$core->U_controller}/member-xiumi');
}
</script>
<!--{template $core panel_footer}-->
<!--{/php168}-->