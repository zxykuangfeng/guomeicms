<!--{php168}-->
<div id="confirm_form">
  <table width="100%" cellspacing="0" cellpadding="0" border="none" style="border:#f0f0f0 1px solid">
    <tr class="tt">
      <td colspan="4"><span style="color:#ff0000;"><b>手机验证</b></td>

    </tr>
    <tr>
      <td class="grey" width="85">手机号:</td>
      <td class="white" width="250"><input type="text" name="mc_mobile" id="mc_mobile" value="" />
        <button type="button" id="mobile_confirm_btn">获取短信</button></td>
    </tr>
    <tr>
      <td class="grey" width="103">验证码:</td>
      <td class="white">
        <input type="text" name="mc_code" id="mc_code" value="" />
        <button type="button" id="mobile_confirm_check">提交验证</button>
      </td>
    </tr>  
    </table>
</div>    
<script type="text/javascript">
$(function(){
    $('#form').before($('#confirm_form'));
    var wait=60;
    function timewait(obj) {
      if (wait == 0) {
       obj.removeAttr("disabled").html("重新获取验证码");
       wait = 60;
       
      } else { 

       obj.attr("disabled", true).html("重新发送(" + wait + ")");
       wait--;
       setTimeout(function() {
        timewait(obj)
       },
       1000)
      }
     }
     var mchash='<!--{php echo p8_code((string)P8_TIME);}-->';
    $('#mobile_confirm_btn').click(function(){
        var mcmobile = $('#mc_mobile').val();
        if(mcmobile=='' || /^1\d{10}$/.test(mcmobile)==false){
            alert('请填写有效手机号');return false;
        }
        timewait($('#mobile_confirm_btn'));
        $.post('{$core.url}/api/mobilecheck.php',{'do':'send',mobile:mcmobile,hash:mchash},function(data){ 
            if(data.status==1){
                 alert('发送成功，请查收短信');
            }else{
                alert(data.msg);
            }
        },'json');
        
    });
    $('#mobile_confirm_check').click(function(){
        var mcmobile = $('#mc_mobile').val();
        if(mcmobile=='' || /^1\d{10}$/.test(mcmobile)==false){
            alert('请填写有效手机号');return false;
        }
        var mc_code = $('#mc_code').val();
        if(mc_code=='' || /^\d{4}$/.test(mc_code)==false){
            alert('请填写有验证码');return false;
        }
        $.post('{$core.url}/api/mobilecheck.php',{'do':'check',mobile:mcmobile,code:mc_code,hash:mchash},function(data){ 
            //if(data.status==1){
                $('input,textarea,select',$('#form')).removeAttr('disabled');
                $('#confirm_form').hide();
                $('#form input[name=phone]').val(mcmobile).attr('readonly','readonly');
                $('<input type="hidden" name="mobolecheck" value="'+data.hash+'">').appendTo($('#form'));
                alert('验证成功，请继续填写');
            //}else{
              //  alert('验证失败');
            //}
        },'json');
    })
    $('input,textarea,select',$('#form')).attr('disabled','disabled');
});
</script>
</form>

<!--{/php168}-->